



















                            ADRII GED

                            June 15, 1987



                            Richard Teng



                            Tymnet
                            Network Technology Development

                            McDonnell Douglas Network Systems Company












        ******************************************************************
        **                  PROPRIETARY INFORMATION                     **
        **                                                              **
        **  MDC-TYMNET's  proprietary  rights  are  included  in  the   **
        **  information disclosed herein.  The recipient, by receiving  **
        **  this document,  agrees that neither this document nor  the  **
        **  information disclosed herein nor any part thereof shall be  **
        **  reproduced  or  transferred to other documents or used  or  **
        **  disclosed  to  others for manufacturing or for  any  other  **
        **  purpose  except as specifically authorized in  writing  by  **
        **  MDC-TYMNET.                                                 **
        ******************************************************************














                                 TABLE OF CONTENTS


   Section                                                              Page


   1.  OBJECTIVES                                                          1

   2.  OVERVIEW                                                            2
      2.1  New Features                                                    2
      2.2  Document organization                                           4

   3.  LOGIN DIALOGUE                                                      5
      3.1  LOGII Normal Circuit Requests                                   6
      3.2  LOGII Aux-Circuit Requests                                      9
      3.3  LOGI Normal Circuit Requests                                    9
      3.4  LOGI Aux-Circuit Requests                                      10

   4.  ADRII MESSAGE PROCESSING                                           11
      4.1  LOGII Normal Circuit Requests                                  13
         4.1.1  State 1 - Waiting for initial login string                13
         4.1.2  State 2 - Waiting for login string                        15
         4.1.3  State 3 - Waiting for password                            17
      4.2  LOGII Aux-Circuit Requests                                     20
      4.3  LOGI Normal Circuit Requests                                   21
         4.3.1  State 1 - Waiting for initial login string                21
         4.3.2  State 2 - Waiting for login string                        22
         4.3.3  State 3 - Waiting for password                            24
         4.3.4  State 4 - Waiting for login zapper                        26
      4.4  LOGI Aux-Circuit Requests                                      27
         4.4.1  State 1 - Waiting for initial request                     27
         4.4.2  State 2 - Waiting for login string                        28

   5.  LOGIN STRING FORMAT AND FUNCTION                                   29
      5.1  Basic Layout                                                   30
      5.2  User Interpretation                                            32
      5.3  Supervisor Interpretation                                      33
      5.4  Login String Fields                                            35
         5.4.1  Option field                                              35
         5.4.2  User field                                                36
         5.4.3  Destination List                                          37
            5.4.3.1  Host/Subhost List                                    38
            5.4.3.2  Active Supervisor identifier                         39
            5.4.3.3  Kernel Host identifier                               39
            5.4.3.4  Hostname                                             39
            5.4.3.5  X.121 destination                                    40
            5.4.3.6  Derivation of the resultant target specification     40
         5.4.4  Extension field                                           41
         5.4.5  Password field                                            42
      5.5  LOGI vs. LOGII login strings                                   43

   6.  OPTION PROCESSING                                                  45
      6.1  Reverse Charge                                                 45
      6.2  Half-duplex                                                    46












      6.3  Interactive/batch                                              46
      6.4  Throughput class                                               46

   7.  TARGET SELECTION                                                   47
      7.1  MUD entry layout                                               47
      7.2  Case 1 - host list                                             48
         7.2.1  All APE flags are valid                                   49
         7.2.2  The APE origination set is valid                          49
         7.2.3  At least one host in the intersection is valid            50
      7.3  Case 2 - MUD entry                                             50
      7.4  Case 3 - null specification                                    51

   8.  X.121 ADDRESS INTERPRETATION                                       53
      8.1  Default case                                                   53
         8.1.1  Case 1 - native, shared, synonymous DNIC                  54
         8.1.2  Case 2 - native, shared, non-synonymous DNIC              54
         8.1.3  Case 3 - native, non-shared, synonymous DNIC              55
         8.1.4  Case 4 - native, non-shared, non-synonymous DNIC          55
         8.1.5  Case 5 - non-native DNIC                                  56
         8.1.6  Case 6 - unknown DNIC                                     56
      8.2  Special Tymnet addressing                                      56

   9.  RESPONSE/REJECT MESSAGES                                           59

   10.  NEEDLE INFORMATION                                                65
      10.1  Circuit cost                                                  65
      10.2  Cost table                                                    65
      10.3  Destination host                                              66
      10.4  Destination subhost                                           66
      10.5  Extension                                                     67
      10.6  Half-duplex flag                                              67
      10.7  IIX capable origination flag                                  67
      10.8  Internal circuit flag                                         67
      10.9  Invoice number                                                67
      10.10  IRC                                                          68
      10.11  Multiple targets flag                                        68
      10.12  Needle node list                                             68
      10.13  Reverse charge flag                                          68
      10.14  SDL (Specified destination list)                             68
      10.15  Shut override flag                                           69
      10.16  Target selection and qualification flags                     69
      10.17  Throughput class                                             70
      10.18  Transparent login flag                                       70
      10.19  Username                                                     70
      10.20  UUN                                                          71

   11.  ERROR LOG MESSAGES                                                72

   12.  TARGET PROFILES                                                   73

   13.  ADRI/ADRII INCOMPATIBILITY                                        75

   14.  EXTERNAL REQUIREMENTS                                             77













   A.  STATE DIAGRAMS                                                     78
         A.1  State diagram for LOGII normal circuit requests             78
         A.2  State diagram for LOGI normal circuit requests              79
         A.3  State diagram for LOGII aux-circuit requests                80
         A.4  State diagram for LOGI aux-circuit requests                 80

   B.  LOGIN STRING SYNTAX                                                81

   C.  SWBT ADDRESSING                                                    88

























































   1.  OBJECTIVES


   The purpose of ADRII, as well as the related projects LOGII and MUDII, is
   to improve the login capabilities of the Supervisor.  This is in part to
   satisfy the requirements for the Southwestern Bell Telephone (SWBT) private
   network, but also to enhance all Tymnet-technology networks.

   The main thrust of ADRII is to make logins more flexible by allowing

        (1) Symbolic destination names and X.121 destination addresses
            in addition to explicit host numbers
        (2) X.121 usernames in addition to "regular" usernames
        (3) New login options, such as reverse charge (collect call)

   ADRII refers to the processing of the login request message contents, the
   most important of which is the login string (which includes the username
   and various optional fields).  The ADRII specification deals with "logical"
   data which has been extracted from the circuit request message.  The main
   results of login processing will be Supervisor-to-Node messages, either
   needles or response/reject messages.  Here too, the ADRII specification
   refers to logical data.  The actual formats of both input and output
   messages are documented in the LOGII GED, and it is the LOGII code in the
   Supervisor that translates between the network messages and the internal
   format used by ADRII.

   However, ADRII does not cover all phases of internal processing.  Certain
   processes are not described in detail simply because they are not being
   changed.  A prime example is the path-finding algorithm.  Other major
   components not covered include the procedures needed to locate the MUD
   entry associated with a given MUD name, MUD maintenance, and the
   maintenance of auxiliary tables (DNIC, Class/Group).  These topics are
   covered in the MUDII GED.
























   ADRII GED                        Objectives                               -1-








   2.  OVERVIEW


   This document describes the Supervisor processing of incoming circuit
   request messages according to the new addressing design, ADRII.  For
   reference purposes, the term "ADRI" is used to indicate the design
   specifications prior to ADRII.  Likewise, "LOGI" refers to the login
   message formats and handling prior to LOGII.

   The most important component of the circuit request message is the login
   string, which is roughly what a user types in response to the Consat prompt
   "Please log in".  The syntax has been expanded to allow for new fields and
   for new addressing schemes within the old fields.  The new way of
   interpreting login strings is, for all practical purposes, compatible with
   the old way, meaning that users can continue to build circuits as before
   without being aware of any change.  However, users requiring more
   flexibility or convenience can take advantage of the new design.

   It must be stressed that the Supervisor handling of the circuit request is
   just one part of the entire login process.  The user's interpretation of
   the login string will depend also upon how the originating interface
   filters user input, how the Master User Directory (MUD) is administered,
   and how the destination interface interprets data passed to it in the
   needle.  These are all factors which must be considered when designing the
   addressing plan for a given network.  The purpose of this document is to
   fully delineate the Supervisor's contribution to the entire process,
   namely, its output in response to login request input.




   2.1  New Features


   The ADRII design encompasses a great many changes to the current login
   processing design.  However, from a network user's point of view, the most
   important are those related to login string format and interpretation.  The
   following is a list of the major changes to the login string.

   (1) HOSTNAMES.  A symbolic name can be used in place of a host number to
       specify the destination of the circuit.  The Supervisor uses this
       "hostname" to locate an entry in the Master User Directory (MUD) which
       specifies a set of destination hosts.  A circuit is then built to one
       of these hosts, depending upon availability, cost, and various other
       factors.  For example, the name "XPCBOSTON" might refer to a MUD entry
       which lists all the X.PC hosts in Boston.  The login string
       "JSMITH:XPCBOSTON" would log user JSMITH into one of these hosts.

       There are several advantages to hostnames over numeric host numbers.
       Besides being easier to remember, a hostname can be used to refer to a
       service without reference to the particular host or hosts which provide
       the service.  New hosts can then be added or removed without users
       having to know.  Another advantage is that the MUD entry structure
       allows for intelligent routing of circuits to different hosts depending



   ADRII GED                         Overview                                -2-








       upon the user's origination and other factors.

   (2) X.121 NAMES.  Symbolic names which conform to the Tymnet version of
       CCITT X.121 syntax can be used both as usernames and destination
       addresses.  As usernames they function in a similar manner as regular
       usernames and serve to identify the user to the network.  As a
       destination addresses, they function in most cases similarly to the
       hostnames described above.  The difference, however, is that the
       Supervisor does not treat X.121 names as strings of arbitrary
       characters.  Rather, it interprets the first portion of an X.121 name
       as the Data Network Identifier Code (DNIC), and the second as the
       Network Terminal Number (NTN).  A MUD entry will still be associated
       with the X.121 name (in most cases), but there may be several X.121
       names which share the same MUD entry.  This allows the Supervisor to
       route calls based upon the significant digits of the NTN while ignoring
       the others.

   (3) HOST LISTS.  A list of destination hosts can be specified instead of
       just a single one.  The Supervisor will choose among them based upon
       availability, host cost, circuit cost, and other factors.  For example,
       "JSMITH:300,301,302" will cause a circuit to be built to one of the
       three hosts, assuming at least one of them is available, is permitted
       by the user's access profile, and so on.

   (4) KERNEL HOST IDENTIFIER.  In order to log into the kernel host for a
       particular node, the user can specify the host number prefixed by a
       percent sign.  (Previously, the user had to know the host number and
       specify it in the login string.)  For example, "JSMITH:%4000" will log
       JSMITH into the kernel host for node 4000.

   (5) MULTIPLE DESTINATIONS.  The login string syntax allows for multiple
       destination fields.  For example, "JSMITH:300:400" and
       "JSMITH:-3106:-31135555" are both valid.  In general, the first
       destination indicates the destination within the local network, whereas
       subsequent fields may indicate transit networks, gateways, or hosts in
       other networks.  The multiple destinations fields can have various
       interpretations depending upon the numbering plan for the given
       network.

   (6) PRINTABLE OPTIONS.  Login options can be specified by means of
       printable option keywords in the login string.  For example, instead of
       specifying half-duplex mode by typing ctrl-H, the user can now type
       "(HDX)" prior to the username.  Several options can be specified in
       sequence.  For example, "(HDX,TC=A,BATCH)JSMITH" indicates that JSMITH
       requests half-duplex, throughput class A, and a batch circuit.

   (7) REVERSE CHARGE OPTION.  Users can specify the reverse charge (i.e.,
       collect call) option by typing "(RC)" before the username.  If the
       destination host accepts reverse charge calls, the user will not be
       billed for the connect time.

   (8) EXTENSION FIELD.  Arbitrary data can be passed to the destination host
       by means of a new "extension" field.  This data might be routing
       information for a gateway, X.25 Call User Data, or anything else which



   ADRII GED                         Overview                                -3-








       is appropriate for the particular host.  For example,
       "JSMITH:300[hello]" logs JSMITH into host 300 and passes it the string
       "hello".




   2.2  Document organization


   The purpose of this document is to delineate the Supervisor's logical
   output in response to login request input.  A top-down approach has been
   taken.  Section 3 describes the login dialogue protocol used for the
   various kinds of logins.  This provides the context necessary to understand
   the interpretation of a single input message.  Section 4 explains how a
   single input message is processed in each o possible states of the
   dialogue.  However, due to the complexity, many of the details are given in
   following sections.

   Sections 5 though 8 provide further depth.  Section 5 explains the login
   string syntax and how it functions within the entire session.  Section 6
   describes how various login options are interpreted.  Section 7 describes
   how the target host is selected.  And section 8 describes how X.121
   addresses are interpreted.

   Section 9 through 11 provide more detail regarding ADRII output.  Section 9
   describes the response/reject message output.  Section 10 describes the
   needle output.  And section 11 describes the Probe error log messages
   created during the login process.

   Sections 12 through 14 deal with miscellaneous issues, namely, target
   profile addressing, ADRI/ADRII incompatibilities, and external
   requirements.  The appendix includes supplementary information: Appendix A
   contains state diagrams for the various types of logins.  Appendix B
   contains login string syntax diagrams.  Appendix C describes the customized
   syntax for the Southwestern Bell Telephone network (SWBT).





















   ADRII GED                         Overview                                -4-








   3.  LOGIN DIALOGUE


   From the Supervisor's point of view, a login session begins when it
   receives a circuit request message from a node.  This message includes the
   login string, which consists of a username and possibly other items such as
   a destination field, a password, and so on.  In many cases, the Supervisor
   does not complete the login immediately.  Rather, a dialogue takes place
   where the Supervisor requests more information from the node, which in turn
   gets the information from the requesting host.  At some point in the
   dialogue, the Supervisor will either send a needle to the requesting host,
   or else the dialogue will be terminated according to one of several
   protocols (explained in following sections).  In either case, the
   Supervisor is finished with the login request and the session is therefore
   said to be terminated.  (Consequently, in this document the term "session
   terminated" refers to the end of the Supervisor/node dialogue.  It does not
   refer to the time when the user logs out from the destination host.)

   For example, if a circuit request message contains an unrecognized
   username, the Supervisor sends a message to the node prompting for another
   username.  If the node then sends a valid one, the Supervisor checks the
   MUD entry for this username to determine if a password is required.  If one
   is required and not already provided, the Supervisor sends a message to the
   node prompting for a password.  Several messages might be sent back and
   forth before the login is completed.

   Therefore, the same circuit request message will contain different
   information at different stages of the dialogue.  In many cases, this
   information is sent to the Supervisor merely as undifferentiated "logon
   characters" and it is left to the Supervisor to interpret these depending
   upon the current state.  For example, logon characters in the first circuit
   request message are assumed to contain a username (and perhaps other things
   as well).  However, after the Supervisor sends a prompt for a password, it
   assumes that subsequent logon characters form a password.

   Note that even when the logon characters are identified (which is now
   possible with LOGII messages), the login session is still state-dependent,
   since the Supervisor requires specific information at specific times.  The
   point is that Supervisor processing of a login request can only be
   understood in the context of the entire dialogue.

   The situation is complicated by the fact that logins differ depending upon
   whether the request is for a normal or aux-circuit.  Furthermore, it is
   possible to use ADRII login strings even when logging in from LOGI
   interfaces and nodes.  For backward compatibility, the Supervisor must in
   those cases use the old LOGI protocol.  Therefore, there are four basic
   types of logins:

        (1) Normal circuit requests from LOGII nodes
        (2) Aux-circuit requests from LOGII nodes
        (3) Normal circuit requests from LOGI nodes
        (4) Aux-circuit requests from LOGI nodes

   The login dialogues for each of the four login types is discussed in the



   ADRII GED                      Login Dialogue                             -5-








   following sections.




   3.1  LOGII Normal Circuit Requests


   A session begins with a circuit request from a particular node and port.
   Thereafter, the node only sends further messages in response to Supervisor
   prompting.  Once the Supervisor has received the initial circuit request,
   it either replies with a needle, a reject message, or a response message.
   Both the needle and reject messages terminate the session.  The response
   message provides information about the request but also serves the dual
   function of prompting for further information.  For example, the response
   which indicates "error, type password" informs the originating host (and
   the user) that the previously-entered password was invalid.  It also
   clearly serves to prompt for a new password.  The response "host down", on
   the other hand, informs the originating host why the request could not be
   satisfied, but also implicitly prompts for another login string.  Response
   messages can indicate a wide variety of reasons for failure, but can only
   prompt (explicitly or implicitly) for a login string or a password.

   In reply to the Supervisor's prompt, the node sends another circuit request
   message which either provides further login information or else zaps the
   session.  If it provides login information, the Supervisor again tries to
   satisfy the request and outputs a needle, a reject message, or a response
   message.  If the node zaps the session, the Supervisor clears away all
   information it has concerning the login, and sends a message indicating
   zapper acknowledgement, thereby terminating the session.

   The Supervisor might send several response messages before the session is
   completed.  However, at some point, the Supervisor will either satisfy the
   request and send a needle, receive a login zapper from the node and
   acknowledge it, or else send a reject message to prevent the prompt/reply
   loop from continuing indefinitely.

   The Supervisor can be thought of starting any login session by waiting for
   the initial circuit request message, which includes a login string.  Since
   all Supervisor response messages serve to prompt either for another login
   string or a password, the login dialogue has three possible states, from
   the Supervisor's point of view.  Namely,

        (1) Waiting for initial login string
        (2) Waiting for (subsequent) login string
        (3) Waiting for password

   A state diagram is included in appendix A.  Although the Supervisor is
   waiting for the same data in both states 1 and 2, the states are distinct.
   Strictly speaking, the dialogue has not started in state 1, whereas in
   state 2 it is in progress.  Some examples might clarify the protocol.

   Example 1: The Supervisor starts out in state 1, waiting for the login
   string.  It receives the initial circuit request message, but does not



   ADRII GED                      Login Dialogue                             -6-








   recognize the username and therefore sends a message prompting for the
   username again.  It puts itself into state 2. The node then sends a second
   circuit request message, this time with a valid username.  The Supervisor
   determines that a password is required and prompts for one, thereby
   entering state 3. The node sends a message with a password, and after
   determining that it is valid, the Supervisor responds with a needle.  The
   dialogue is now complete.

   Example 2:  The Supervisor starts in state 1 and receives a login string
   with a valid username.  The Supervisor determines that a password is
   required for that username, and prompts for one, putting itself into state
   3.  However, while in state 3, it receives a circuit request message which
   indicates a login zapper.  The Supervisor replies with a zapper
   acknowledgement, terminating the session.

   Example 3:  The Supervisor receives a login string with an unknown
   username.  It puts itself into state 2 and prompts for another login
   string.  The node sends another login string with another unknown username.
   The process is repeated several times with the Supervisor remaining in
   state 2.  Finally, after receiving yet another unknown username, the
   Supervisor simply sends a reject message indicating "please see your
   representative".  The session is terminated.

   A successful dialogue can be summarized in this way:


   Node message                 Supervisor message
   -------------------          -------------------------
   initial request       ===>
   (with login string)

                          <===  response (and prompt for    ]
                                login string or password)   ] Zero or more
   reply to prompt       ===>                               ] pairs of
                          <===  response (and prompt for    ] responses and
                                login string or password)   ] replies
                          ...                               ]
   reply to prompt       ===>                               ]

                          <===  needle

















   ADRII GED                      Login Dialogue                             -7-








   An unsuccessful dialogue terminated by the node can be summarized in this
   way:


   Node message                 Supervisor message
   -------------------          -------------------------
   initial request       ===>
   (with login string)

                          <===  response (and prompt for    ]
                                login string or password)   ]
   reply to prompt       ===>                               ] Zero or more
                          <===  response (and prompt for    ] pairs of
                                login string or password)   ] responses and
                          ...                               ] replies
                          <===  response (and prompt for    ]
                                login string or password)   ]

   reply indicating      ===>
   login zapper
                          <===  response acknowledging
                                login zapper


   An unsuccessful dialogue terminated by the Supervisor can be summarized in
   this way:


   Node message                 Supervisor message
   -------------------          -------------------------
   initial request       ===>
   (with login string)

                          <===  response (and prompt for    ]
                                login string or password)   ]
   reply to prompt       ===>                               ] Zero or more
                          <===  response (and prompt for    ] pairs of
                                login string or password)   ] responses and
                          ...                               ] replies
                          <===  response (and prompt for    ]
                                login string or password)   ]

   reply to prompt       ===>
                          <===  reject













   ADRII GED                      Login Dialogue                             -8-








   3.2  LOGII Aux-Circuit Requests


   The login dialogue for an aux-circuit request is a shortened version of the
   normal circuit dialogue.  The Supervisor receives an initial login request
   which is flagged as being a request for an aux-circuit.  If the request can
   be satisfied, the Supervisor replies with a needle, thereby terminating the
   login session.  Otherwise, the Supervisor sends a reject message which
   indicates the reason why the request could not be completed.  This also
   terminates the login session.  Therefore, with aux-circuit logins, the
   Supervisor really has only one state - waiting for initial request.  The
   corresponding state diagram is shown in appendix A.  The login dialogue
   can be summarized in this way:


   Node message                 Supervisor message
   -------------------          -------------------------
   initial request       ===>
   (with login string)

                          <===  needle or reject message
                                indicating the reason for
                                failure




   3.3  LOGI Normal Circuit Requests


   The login dialogue for a normal circuit request follows the same basic
   sequence whether the originating node is a LOGII node or not.  However, in
   the case of LOGI, the Supervisor can only send needles or response
   messages.  In order to effectively reject (and abort) a login session, the
   Supervisor must send a response message to hang the user port.  This does
   not immediately terminate the session, as in LOGII, but acts as an implicit
   prompt for a login zapper.  The node sends the login zapper indication (a
   hex 03 character embedded in the logon characters field), and the
   Supervisor replies with a zapper acknowledgement message.  The session is
   finally terminated.  Consequently, there are 4 possible login states for a
   LOGI dialogue.  These are:

        (1) Waiting for initial login string
        (2) Waiting for (subsequent) login string
        (3) Waiting for password
        (4) Waiting for login zapper

   In all other respects, the LOGI dialogue follows the pattern of the LOGII
   dialogue.  A state diagram is provided in appendix A.








   ADRII GED                      Login Dialogue                             -9-








   3.4  LOGI Aux-Circuit Requests


   A session begins when a node sends an initial login request for an
   aux-circuit.  This request contains only the port number, and possibly the
   requesting host number and IIX flag.  In response, the Supervisor might
   send a reject message indicating that it cannot process the login (as when
   it is low on internal storage).  This terminates the sessions.  However, in
   most cases the Supervisor sends a "continue" message, which tells the node
   to send the login string.  After receiving the login string, the Supervisor
   has all the information it needs and either returns a needle, or else a
   reject message indicating why the request could not be satisfied.  In both
   cases, the session is terminated.  In short, the LOGI dialogue is the same
   as with LOGII, except that the former requires an initial handshake to get
   started.  The state diagram for this dialogue is shown in appendix A.

   A typical dialogue can be summarized in this way:


   Node message                 Supervisor message
   -------------------          -------------------------
   initial request       ===>
   (without login
   string)
                          <===  response indicating
                                "continue"
   login request with    ===>
   login string
                          <===  needle or reject message
                                indicating reason for
                                failure


   A dialogue prematurely aborted can be summarized in this way:


   Node message                 Supervisor message
   -------------------          -------------------------
   initial request       ===>
   (without login
   string)
                          <===  reject message indicating
                                reason for failure














   ADRII GED                      Login Dialogue                            -10-








   4.  ADRII MESSAGE PROCESSING


   Given that a login session requires a dialogue, the best way to describe
   Supervisor processing is by state tables.  That is, the processing of a
   given message is described in terms of the current state.

   The input to ADRII consists of the following.  (Other tables may be used
   during login processing, but these are not relevant to ADRII.)

        (1) The contents of the circuit request message put in an internal
            format by LOGII subroutines.  This contains the login string and
            possibly the password (although not usually in the same message),
            as well as other data.

        (2) Results from processing previous messages for this login session.
            For example, in state 3, the Supervisor must have already found a
            username in the MUD and set various flags accordingly (such as the
            need for a password).  Of course in state 1 there will have been
            no previous processing.

        (3) The Master User Directory (MUD).  This is used, for example, to
            determine which destination hosts the user is allowed to log in
            to.

        (4) The Class and Group tables.  These are needed in order to
            interpret the user entry in the MUD (and also the destination
            entry, if there is one.)

        (5) The DNIC table.  This is used to interpret X.121 addresses which
            may appear as usernames or destination addresses.


   The output from ADRII can be one or more of the following:

        (1) A needle, or more precisely, the information needed to create a
            needle.  LOGII subroutines use this information to construct the
            actual needle, using the LOGI or LOGII message format as required.

        (2) A response/reject message, or more precisely, a condition code and
            flag which are used to create the actual response message.  The
            condition code indicates the reason for sending the message (such
            as "invalid password") and the flag indicates whether the failure
            limit has been exceeded.  Again, LOGII takes this information and
            creates the actual message.

        (3) Internal data needed later in the session.  For example, if a
            valid username has been received, the Supervisor cannot forge
            ahead and build a needle until it has received a valid password
            (assuming one is required for this user).  In such a case, the
            Access Profile from the user entry must be preserved so that it
            can be processed later.  Processing it immediately could be
            wasteful, since a valid password might never be received.




   ADRII GED                    Message Processing                          -11-








        (4) Error log messages.  These will be generated either as part of
            routine statistics gathering, or to signal an anomaly.  For
            example, an error message is created if the Supervisor detects an
            improper field in the MUD.

        (5) Accounting information.  Accounting records will be created
            whenever a needle is sent out.  Some new information is available
            with ADRII and LOGII.  (This is described in the LOGII GED.)

   The login dialogue differs depending upon the circuit type and message
   format.  The same is true for the interpretation of an individual request
   message.  Consequently, each of the four types of logins - LOGII normal
   circuit, LOGII aux-circuit, LOGI normal circuit, and LOGI aux-circuit - are
   described in separate sections.











































   ADRII GED                    Message Processing                          -12-








   4.1  LOGII Normal Circuit Requests


   As described earlier, a LOGII message requesting a normal circuit can be
   received by the Supervisor in any of three possible states:

        (1) Waiting for initial login string
        (2) Waiting for (subsequent) login string
        (3) Waiting for password




   4.1.1  State 1 - Waiting for initial login string


   The input to state 1 is the initial circuit request message, the MUD,
   Class/Group tables, and DNIC table.  Obviously no information will have
   been saved from previous processing.

   The circuit request message contains a number of fields, called Message
   Objects (MOs).  LOGII subroutines in the Supervisor translate these into an
   internal format for use by ADRII.  The logical contents of the relevant MOs
   are given in the table.  Not all MOs will be present, and some are mutually
   incompatible, as explained later.


   Message Object               Description and use
   -------------------------    ---------------------------------------------
   Originating node number      The number of the node sending the login
                                request.  This, along with the originating
                                port number, serves to uniquely identify the
                                login session.
   Originating port number      The port number associated with request.
   Originating host number      The number of the host requesting the circuit.
                                This MO is optional.
   Originating address          This identifies the origination of the circuit
                                and is used in lieu of a username if one is
                                not given in a MO or within the unparsed
                                logon characters.  This MO is optional.
   CCT                          This is the Circuit Characteristic Type.
   IIX capable origination      If present, this indicates that the originating
                                host is capable of using the IIX protocol.
   UUN requested                If present, this indicates that the user's UUN
                                should be passed to the originating host in
                                the needle.
   Reverse charge requested     If present, this indicates that the user has
                                requested the call to be charged to the
                                destination host (i.e., a collect call).
   Half-duplex                  If present, this indicates that the requesting
                                terminal is half-duplex.
   Batch circuit request        If present, this indicates that the circuit is a
                                batch circuit.
   Throughput class             This indicates the throughput class of the



   ADRII GED                    Message Processing                          -13-








                                circuit, namely, class A, B, C, or D.
   Logon session reset          If present, this indicates that the login
                                should be restarted.  It is equivalent to an
                                escape character appearing in the LOGI logon
                                character field.
   Unparsed logon characters    If present, this is assumed to contain a login
                                string, possibly with a password.  (In other
                                states it might contain just a password.)
   Option list                  This is one of the components of the login
                                string.  It specifies various login options,
                                such as half-duplex or reverse-charge.
   Username                     This is one of the components of the login
                                string and serves to identify the user.
   Destination list             This is one of the components of the login
                                string and specifies where the circuit should
                                be routed.
   Extension                    This is one of the components of the login
                                string.  It is data which the user wishes to
                                pass to the destination host, such as X.25
                                Call User Data.
   Password                     This is one of the components of the login
                                string, and is the only component which may
                                appear separately from the others.  It serves
                                to validate the login request.

   The login string must be given in one form only, that is, either as
   unparsed logon characters, or as parsed components.  However, if the login
   session is being reset, then it makes no sense to include any login string
   information whatsoever.

   If the login string is given as parsed components, these are processed just
   as if they had been encountered among the unparsed logon characters.
   However, since they are already presented as isolated components, there is
   no need for initial delimiter characters.  That is, the option list is not
   enclosed within parentheses, the destination list is not started with a
   colon, the extension is not enclosed within square brackets, and the
   password is not preceded by a semicolon.  See section 5 for details of the
   login string syntax.

   The following table shows the output from state 1 and the associated state
   transitions.  A transition to back to state 1 means that the login session
   is complete and the Supervisor can now handle a new session for this
   node/port.

                                                                      Next
   Condition                             Output                       State
   -----------------------------------   --------------------------   -----
   Some unusual condition exists which   (1) reject code for "Sup       1
   prevents the Supervisor from              not able to process
   continuing (lack of bufferlets,           logins"
   Probe NETLOG command, etc.).          (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)




   ADRII GED                    Message Processing                          -14-








   The host reset the login session,     (1) response code for          2
   and the failure limit has not been        "session reset"
   exceeded.  (In state 1, the failure   (2) minimal internal data
   limit cannot possibly be exceeded.)   (3) possibly error log
                                             messages (statistics)

   There was some error detected         (1) response code              2
   (invalid syntax, unknown username,        indicating the error
   etc.)                                 (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)

   The specified username is valid.      (1) response code for          3
   However, the MUD entry indicates          "password required",
   that a password is required, and          "null password", or
   either no password is given in the        "invalid password"
   circuit request, or else the one      (2) internal data needed to
   provided is not valid.                    create the needle once
                                             a valid password is
                                             received
                                         (3) possibly error log
                                             messages (statistics)

   The login string is valid, a path     (1) needle                     1
   was found to one of the allowed       (2) accounting record
   destinations, and no other errors     (3) possibly error log
   were encountered.  Either the             messages (statistics)
   username MUD entry indicated that
   no password was required, or else a
   password was supplied in the
   circuit request message.

   The possible response/reject conditions are listed in section 9. The needle
   contents is described in section 10.  The error log messages are described
   in section 11.  Details regarding new accounting data are found in the
   LOGII GED.  The internal data saved depends entirely upon the next login
   state and is described in the section for that particular login state.





   4.1.2  State 2 - Waiting for login string


   State 2 processing is very similar to state 1 processing.  However, some
   data will have been saved from the previous message or messages.  If there
   is no equivalent data from the current message, then the previously saved
   data is used.  However, some data which could conceivably be used is
   deliberately discarded.  This allows the user to specify different options,
   destinations, etc., if the first attempt failed.






   ADRII GED                    Message Processing                          -15-








   The data saved from the previous messages is:

        () Session failure count
        () Session starting time
        () Circuit type
        () Originating node
        () Originating port
        () Originating host
        () Originating address
        () CCT
        () IIX capable origination flag
        () UUN requested flag

   The following data is discarded before entering this state:

        () All options.  The Half-duplex, Reverse charge, Interactive/batch,
           and Throughput class settings are discarded.
        () Login string.  Any information captured as a result of previous
           login string processing is discarded.

   This means that the login session is effectively reset whenever the
   Supervisor prompts for a subsequent login string.  This is the same
   information that is cleared as when the Logon Session Reset MO is received
   in the circuit request message.

   The output and transitions from state 2 are the same as from state 1,
   except that there are the following additional situations:

                                                                      Next
   Condition                             Output                       State
   -----------------------------------   --------------------------   -----
   The session timed out before the      (1) reject code for            1
   node responded to the Supervisor's        "timeout"
   last message.                         (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)

   The host zapped the login session.    (1) reject code for "login     1
                                             zapper received"
                                         (2) possibly error log
                                             messages (statistics)

   The host reset the login session,     (1) reject code for            1
   and the failure limit has now been        "session reset".  The
   exceeded (e.g., too many resets,          terminate flag is set.
   invalid passwords, etc.)              (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)

   There was some error detected         (1) reject code for the        1
   and the failure limit has now been        error.  The terminate
   exceeded (e.g., too many resets,          flag is set.
   too many invalid passwords, etc.)     (2) minimal internal data
                                         (3) possibly error log



   ADRII GED                    Message Processing                          -16-








                                             messages (statistics)




   4.1.3  State 3 - Waiting for password


   The input to state 3 is the current circuit request message, data retained
   from processing of previous messages, the MUD, Class/Group tables, DNIC
   table.  The relevant logical fields of the circuit request message are
   shown below.

   Message Object               Description and use
   -------------------------    ---------------------------------------------
   Originating node number      The number of the node sending the login
                                request.  This, along with the originating
                                port number, serves to uniquely identify the
                                login session.
   Originating port number      The port number associated with request.
   Logon session zapper         If present, this indicates that the node has
                                zapped the login request.  (It is equivalent
                                to a hex 03 login zapper appearing in the LOGI
                                logon character field.)
   Logon session reset          If present, this indicates that the login
                                should be restarted.  (It is equivalent to an
                                escape character appearing in the LOGI logon
                                character field.)
   Unparsed logon characters    If present, this is assumed to contain a
                                password.
   Password                     This is one of the components of the login
                                string, and is the only component which may
                                appear separately from the others.

   The password must be given in one format only, that is, either as unparsed
   logon characters, or in the password field.  It is processed the same way
   in either case.  However, if the login session is being reset or zapped,
   then it makes no sense to include any password at all.

   The internal data saved from previous processing can consist of:

        () Session starting time
        () Session failure count
        () Circuit type
        () Originating node
        () Originating port
        () Originating host
        () Originating address
        () CCT
        () IIX capable origination
        () UUN requested flag
        () Half-duplex flag
        () Reverse charge flag
        () Interactive/batch flag



   ADRII GED                    Message Processing                          -17-








        () Throughput class
        () Login string components
        () Access Profile Entry for the username
        () Access Profile Entry for the destination name
        () Various flags and fields from the MUD user entry

   The options (Half-duplex, Reverse charge, Interactive/batch, throughput
   class) might have been given in previous message fields.  Alternatively,
   they might have been set as a result of processing the login string.

   The possible output and transitions from state 3 are:

                                                                      Next
   Condition                             Output                       State
   -----------------------------------   --------------------------   -----
   The session timed out before the      (1) reject code for            1
   node responded to the Supervisor's        "timeout"
   last message.                         (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)

   The host zapped the login session.    (1) reject code for "login     1
                                             zapper received"
                                         (2) possibly error log
                                             messages (statistics)

   The host reset the login session      (1) response code for          1
   and the failure limit has now been        "session reset".  The
   exceeded (e.g., too many resets,          terminate flag is set.
   invalid passwords, etc.)              (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)

   The host reset the login session      (1) response code for          2
   and the failure limit has not yet         "session reset".
   been exceeded.                        (2) possibly error log
                                             messages (statistics)

   The password is invalid and the       (1) reject code for            1
   failure limit has now been                "null password" or
   exceeded.                                 "invalid password".
                                             The terminate flag
                                             is set.
                                         (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)

   The password is invalid and the       (1) response code for          3
   failure limit has not yet been            "null password", or
   exceeded.                                 "invalid password"
                                         (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)




   ADRII GED                    Message Processing                          -18-








   The password is valid, but some       (1) reject code for the        1
   error was encountered further             error.  The terminate
   along in processing and the               flag is set.
   failure limit has now been            (2) minimal internal data
   exceeded.                             (3) possibly error log
                                             messages (statistics
                                             or anomaly)

   The password is valid, but some       (1) response code for the      2
   error was encountered further             error
   along in processing and the           (2) internal data for later
   failure limit has not been            (3) possibly error log
   exceeded.                                 messages (statistics
                                             or anomaly)

   The password is valid, and no other   (1) needle                     1
   errors were encountered during the    (2) accounting record
   rest of the processing (Access        (3) possibly error log
   Profile analysis, path-finding,           messages (statistics)
   etc.)





































   ADRII GED                    Message Processing                          -19-








   4.2  LOGII Aux-Circuit Requests


   With LOGII aux-circuit requests, there is only one possible Supervisor
   state - waiting for the initial request message.  The input is the request
   message, the MUD, Class/Group tables, and DNIC table.  Obviously no
   information will have been saved from previous processing and none will be
   saved for later.  The aux-circuit request message has the same contents as
   a normal circuit request message, except that

        (1) The Circuit type field indicates an aux-circuit.
        (2) The CCT, Logon session zapper, and Logon session reset MOs are not
            allowed.  (If they appear, LOGII will reject the message as being
            in bad form.)

   The following table shows the output and state transitions.  In all cases,
   the login session is terminated and the Supervisor can handle a new session
   for this node/port.

   Condition                             Output                       State
   -----------------------------------   --------------------------   -----
   Some unusual condition exists which   (1) reject code for            1
   prevents the Supervisor from              "Sup not able to
   continuing (lack of bufferlets,           process logins"
   Probe NETLOG command, etc.).          (2) possibly error log
                                             messages (statistics)

   There was some error detected         (1) reject code indicating     1
   (invalid syntax, unknown username,        the error
   etc.)                                 (2) possibly error log
                                             messages (statistics
                                             or anomaly)

   The login string is valid, a path     (1) needle                     1
   was found to one of the allowed       (2) accounting record
   destinations, and no other errors     (3) possibly error log
   were encountered.                         messages (statistics)




















   ADRII GED                    Message Processing                          -20-








   4.3  LOGI Normal Circuit Requests


   As described earlier, a LOGI message requesting a normal circuit can be
   received by the Supervisor in any of four possible states:

        (1) Initial wait for login string
        (2) Wait for login string
        (3) Wait for password
        (4) Wait for login zapper

   Although the processing is very similar to the LOGII case, there are a
   number of minor differences which would be difficult to enumerate.
   Therefore, the LOGI processing is shown in detail.




   4.3.1  State 1 - Waiting for initial login string


   The input to state 1 is the initial circuit request message, the MUD,
   Class/Group tables, and DNIC table.  Obviously no information will have
   been saved from previous processing.

   The circuit request message contains a number of fields in the old LOGI
   format.  LOGII subroutines in the Supervisor translate these into an
   internal format for use by ADRII.  The logical contents of the relevant
   fields are given in the table.

   Message Object               Description and use
   -------------------------    ---------------------------------------------
   Originating node number      The number of the node sending the login
                                request.  This, along with the originating
                                port number, serves to uniquely identify the
                                login session.
   Originating port number      The port number associated with request.
   Originating host number      The number of the host requesting the circuit.
                                This field is optional.
   CCT                          This is the Circuit Characteristic Type.
   IIX capable origination      If present, this indicates that the originating
                                host is capable of using the IIX protocol.
   UUN requested                If present, this indicates that the user's UUN
                                should be passed to the originating host in
                                the needle.
   Unparsed logon characters    This is assumed to contain a login string.
                                (In other states it might contain just a
                                password.)

   The following table shows the output from state 1 and the associated state
   transitions.  A transition to back to state 1 means that the login session
   is complete and the Supervisor can now handle a new session for this
   node/port.




   ADRII GED                    Message Processing                          -21-








                                                                      Next
   Condition                             Output                       State
   -----------------------------------   --------------------------   -----
   Some unusual condition exists which   (1) reject code for "Sup       4
   prevents the Supervisor from              not able to process
   continuing (lack of bufferlets,           logins"
   Probe NETLOG command, etc.).          (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)

   The host zapped the login session     (1) reject code for "login     4
   (by embedding a hex 03 login zapper       zapper received"
   character in the login string).       (2) possibly error log
                                             messages (statistics)

   The host reset the login session      (1) response code for          2
   (via an escape in the login string)       "session reset"
   and the failure limit has not been    (2) minimal internal data
   exceeded.  (In state 1, the failure   (3) possibly error log
   limit cannot possibly be exceeded.)       messages (statistics)

   There was some error detected         (1) response code              2
   (invalid syntax, unknown username,        indicating the error
   etc.)                                 (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)

   The specified username is valid.      (1) response code for          3
   However, the MUD entry indicates          "password required"
   that a password is required.          (2) internal data needed to
                                             create the needle once
                                             a valid password is
                                             received
                                         (3) possibly error log
                                             messages (statistics)

   The login string is valid, a path     (1) needle                     1
   was found to one of the allowed       (2) accounting record
   destinations, and no other errors     (3) possibly error log
   were encountered.  Furthermore,           messages (statistics)
   the username MUD entry indicated
   that no password was required.




   4.3.2  State 2 - Waiting for login string


   State 2 processing is very similar to state 1 processing.  However, some
   data will have been saved from the previous message or messages.  If there
   is no equivalent data from the current message, then the previously saved
   data is used.  However, some data which could conceivably be used is
   deliberately discarded.  This allows the user to specify different options,



   ADRII GED                    Message Processing                          -22-








   destinations, etc., if the first attempt failed.  The following data is
   saved prior to entering state 2:

        () Session failure count
        () Session starting time
        () Circuit type
        () Originating node
        () Originating port
        () Originating host
        () CCT
        () IIX capable origination flag
        () UUN requested flag
        () Half-duplex flag (if set via ctrl-H)
        () Interactive/batch flag (if set via control characters)
        () Throughput class (if set via control characters)

   The data which not retained is:

        () Options which were specified in the login string option field.
        () Login string.  Any information captured as a result of previous
           login string processing is discarded.

   For backward compatibility, the Supervisor retains all options which were
   set via control characters in the login string.  This is in accordance with
   the expectations of LOGI interfaces.  However, all options set by using
   symbolic keywords in the login string are cleared.  This is to allow login
   strings with the new ADRII features to have the same results (as far as
   possible) on both LOGI and LOGII hosts.  This unfortunate and confusing
   situation will eventually disappear as nodes and hosts are converted to
   LOGII.

   The output and transitions from state 2 are the same as from state 1,
   except that there are the following additional situations:

                                                                      Next
   Condition                             Output                       State
   -----------------------------------   --------------------------   -----
   The session timed out before the      (1) reject code for            4
   node responded to the Supervisor's        "timeout"
   last message.                         (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)

   The host reset the login session      (1) reject code for            4
   (via an escape in the login string)       "session reset".  The
   and the failure limit has now been        terminate flag is set.
   exceeded (e.g., too many resets,      (2) minimal internal data
   invalid passwords, etc.)              (3) possibly error log
                                             messages (statistics)

   There was some error detected         (1) reject code for the        4
   and the failure limit has now been        error.  The terminate
   exceeded (e.g., too many resets,          flag is set.
   too many invalid passwords, etc.)     (2) minimal internal data



   ADRII GED                    Message Processing                          -23-








                                         (3) possibly error log
                                             messages (statistics)




   4.3.3  State 3 - Waiting for password


   The input to state 3 is the current circuit request message, data retained
   from processing of previous messages, the MUD, Class/Group tables, DNIC
   table.  The relevant logical fields of the circuit request message are
   shown below.

   Message Object               Description and use
   -------------------------    ---------------------------------------------
   Originating node number      The number of the node sending the login
                                request.  This, along with the originating
                                port number, serves to uniquely identify the
                                login session.
   Originating port number      The port number associated with request.
   Unparsed logon characters    This is assumed to contain a password.

   The internal data saved from previous processing can consist of:

        () Session starting time
        () Session failure count
        () Circuit type
        () Originating node
        () Originating port
        () Originating host
        () CCT
        () IIX capable origination
        () UUN requested flag
        () Half-duplex flag
        () Reverse charge flag
        () Interactive/batch flag
        () Throughput class
        () Login string components
        () Access Profile Entry for the username
        () Access Profile Entry for the destination name
        () Various flags and fields from the MUD user entry

   The possible output and transitions from state 3 are:

                                                                      Next
   Condition                             Output                       State
   -----------------------------------   --------------------------   -----
   The session timed out before the      (1) reject code for            4
   node responded to the Supervisor's        "timeout"
   last message.                         (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)




   ADRII GED                    Message Processing                          -24-








   The host zapped the login session     (1) reject code for login      1
   (by means of a hex 03 character in        zapper received"
   the login string).                    (2) possibly error log
                                             messages (statistics)

   The host reset the login session      (1) response code for          4
   (via an escape in the login string)       "session reset".  The
   and the failure limit has now been        terminate flag is set.
   exceeded (e.g., too many resets,      (2) minimal internal data
   invalid passwords, etc.)              (3) possibly error log
                                             messages (statistics)

   The host reset the login session      (1) response code for          2
   (via an escape in the login string)       "session reset".
   and the failure limit has not yet     (2) possibly error log
   been exceeded.                            messages (statistics)

   The password is invalid and the       (1) reject code for            4
   failure limit has now been                "null password" or
   exceeded.                                 "invalid password".
                                             The terminate flag
                                             is set.
                                         (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)

   The password is invalid and the       (1) response code for          3
   failure limit has not yet been            "null password", or
   exceeded.                                 "invalid password"
                                         (2) minimal internal data
                                         (3) possibly error log
                                             messages (statistics)

   The password is valid, but some       (1) reject code for the        4
   error was encountered further             error.  The terminate
   along in processing and the               flag is set.
   failure limit has now been            (2) minimal internal data
   exceeded.                             (3) possibly error log
                                             messages (statistics
                                             or anomaly)

   The password is valid, but some       (1) response code for the      2
   error was encountered further             error
   along in processing and the           (2) internal data for later
   failure limit has not been            (3) possibly error log
   exceeded.                                 messages (statistics
                                             or anomaly)

   The password is valid, and no other   (1) needle                     1
   errors were encountered during the    (2) accounting record
   rest of the processing (Access        (3) possibly error log
   Profile analysis, path-finding,           messages (statistics)
   etc.)




   ADRII GED                    Message Processing                          -25-








   4.3.4  State 4 - Waiting for login zapper


   The input to state 4 is the current circuit request message, and a small
   amount of data retained from processing previous messages.  The relevant
   logical fields of the circuit request message are given below.


   Message Object               Description and use
   -------------------------    ---------------------------------------------
   Originating node number      The number of the node sending the login
                                request.  This, along with the originating
                                port number, serves to uniquely identify the
                                login session.
   Originating port number      The port number associated with request.
   Unparsed logon characters    This should contain a login zapper character
                                (hex 03).


   The internal data saved from previous processing consists of:

        () Session starting time
        () Session failure count

   The possible output and transitions from state 4 are:

                                                                      Next
   Condition                             Output                       State
   -----------------------------------   --------------------------   -----
   The login session timed out.          (1) possibly error log         1
                                             messages (No response
                                             or reject code.)

   A login zapper character was found    (1) reject code for "login     1
   in the logon characters field.            zapper received"
                                         (2) possibly error log
                                             messages (statistics)

   A login zapper character was not          None                       4
   found in the logon characters field.

















   ADRII GED                    Message Processing                          -26-








   4.4  LOGI Aux-Circuit Requests


   With LOGI aux-circuit requests, there are two possible Supervisor states -
   waiting for the initial request message and waiting for the second request
   message.




   4.4.1  State 1 - Waiting for initial request


   The input to state 1 is simply the request message.  The circuit request
   message will have some of the following logical fields.  The Requesting
   Host field is optional.

   Message Object               Description and use
   -------------------------    ---------------------------------------------
   Originating node number      The number of the node sending the login
                                request.  This, along with the originating
                                port number, serves to uniquely identify the
                                login session.
   Originating port number      The port number associated with request.
   Originating host number      The number of the host requesting the circuit.
   IIX capable origination      If present, this indicates that the
                                originating host is capable of using the IIX
                                protocol.


   The following table shows the possible output and state transitions.

                                                                      Next
   Condition                             Output                       State
   -----------------------------------   --------------------------   -----
   Some unusual condition exists which   (1) reject code for            1
   prevents the Supervisor from              "Sup not able to
   continuing (lack of bufferlets,           process logins"
   Probe NETLOG command, etc.).          (2) possibly error log
                                             messages

   The Supervisor is able to process     (1) response code for          2
   the login request.                        "login string
                                             required"













   ADRII GED                    Message Processing                          -27-








   4.4.2  State 2 - Waiting for login string


   State 2 processing of LOGI aux-circuit requests is basically the same as
   the state 1 processing of LOGII aux-circuit requests.  (With LOGII, there
   is only one state.)  However, the following fields are not present in the
   login request message: in the login request message: Originating Address,
   Reverse charge, Half-duplex, Interactive/batch, Throughput class, Logon
   session zapper, Logon session reset, and the parsed login string
   components.  Consequently, some of this information is passed within the
   login string itself, as was done in ADRI.  This is described in section
   5.5.













































   ADRII GED                    Message Processing                          -28-








   5.  LOGIN STRING FORMAT AND FUNCTION


   The login string is a sequence of characters that is sent in the circuit
   request message and consists of a username and various optional fields.  It
   may be sent in a field labelled as such, or in a general-purpose "logon
   characters" field.  (The logon characters field has different uses
   depending upon the current login state.)

   The login string is roughly what a Consat user types in response to the
   "please log in" prompt.  However, it must be emphasized that the Consat, as
   well as other interfaces, may filter or interpret the user input before
   sending it along to the Supervisor.  For example, the Consat removes
   certain control characters (such as ctrl-X) from the user input before
   sending it along to the Supervisor.  The format and functions described in
   this section refers only to login strings actually sent in login request
   messages, independent of the user input.

   The description that follows applies to login strings received in LOGII
   circuit request messages - whether for normal or aux-circuit requests.  It
   is possible for users of LOGI interfaces (on a LOGI node) to send ADRII
   login strings in which case the login string has a slightly different
   interpretation.  The differences between LOGI and LOGII login strings are
   given in section 5.5.

































   ADRII GED             Login String Format and Function                   -29-








   5.1  Basic Layout


   The new login string consists of the following:

        (1) option field
        (2) user field
        (3) destination list
        (4) extension field
        (5) password field

   The option and extension fields are new to ADRII.  The destination list,
   which consists of one or two destinations, replaces the single destination
   field of the ADRI login string.  The password field, which was previously
   sent separately from the rest of the login string, is now allowed in the
   login string itself, although it may still be sent separately.  Notice that
   an ADRII login string received in a LOGII message does not end with a
   terminator character (carriage-return or semicolon).  This is because of
   the new field structures in LOGII messages.

   The Option field consists of one or more options enclosed within
   parentheses and separated by commas.  The user field consists of a
   username.  The destination list consists of one or two destination fields,
   each one preceded by a colon.  The extension field consists of an extension
   (a sequence of characters) enclosed within square brackets.  The password
   field consists of a password preceded by a semicolon.  Therefore, a useful
   shorthand for the login string is:

   (OPTION,OPTION,...) USERNAME :DESTINATION :DESTINATION [EXTENSION] ;PASSWORD

   The spaces are shown only to improve readability and are not actually part
   of the login string.  Also, "..." indicates ellipsis, in this case
   indicating that there may be an arbitrary number of OPTIONs (or none at
   all).  All of the fields are optional, except the username.  Even the
   username can be omitted in one special case, as explained later.

   The options are printable keywords which represent various login options.
   For example, "RC" indicates a reverse-charge call.  Login parameters which
   were formerly requested by embedding control characters in the user field,
   are now represented via option keywords.  (Alternatively, they may be
   specified outside of the login string entirely by means of option MOs in
   the LOGII message.)

   The username is a string of characters that identify the user to the
   network.  The username can be a "regular" username, such as "JSMITH", or an
   X.121 username, such as "-3106(408)446-6000".

   The destination list, if present, specifies where the circuit should be
   routed.  If none is given, the circuit is routed to the default (home) host
   specified in the MUD user entry.  If the list contains only one destination
   field, that field specifies the ultimate destination of the circuit.  If
   two destination fields are present, the second one identifies the ultimate
   destination and the first may be used to force the circuit through an
   intermediate network.  (Other uses are possible but are not yet defined.)



   ADRII GED             Login String Format and Function                   -30-








   Each destination can be a list of one or more host numbers, a symbolic host
   name, an X.121 address, a kernel host identifier, or an active Supervisor
   identifier.

   The extension is data that the user wants to pass to the destination host,
   such as X.25 Call User Data.  Almost any character, printable or not, is
   allowed in this field.

   The password is required for some usernames in order to guarantee that the
   user is authorized to login with that username.  Almost any character is
   permitted in this field.

   The syntax for the entire login string is given in appendix B.  This shows
   how the string must appear if it is received in the unparsed logon
   characters MO.  The parsed login string component MOs correspond to the
   syntactical units shown in the appendix.  For example, the Option List MO
   corresponds to the Option list shown in the diagram, and does not contain
   parentheses.  The only exception is the Destination List MO, which consists
   of separate items, each corresponding to a Destination shown in the
   diagram.  The Destination List MO does not contain colons, but uses the
   X.409 structure to differentiate the different destinations within the list.




































   ADRII GED             Login String Format and Function                   -31-








   5.2  User Interpretation


   From the user's point of view, the main purpose of the login string is to
   specify the final destination of the circuit and various options (such as
   reverse charge).  When the destination is in another network, the user
   might also want to direct the path across specific intermediate networks.
   However, the Supervisor processing of the login string is only one part of
   the picture.  In order to determine what the actual result of the request
   will be, it is also necessary to know how the DNIC tables and MUD are set
   up for the network, and also how the specific interfaces (X.25, T-II
   gateway, etc.) are configured.  The effect of the login string depends upon
   all these factors.

   The point is that the Supervisor interpretation of the login string does
   not by itself determine the addressing policy of the network.  Several
   different policies are possible, meaning that the login string can have
   several distinct user interpretations.  Some examples of possible
   addressing schemes are:

        (1) "-3106234:-4444:-5555345" might build a circuit to terminal number
            345 in the network identified by DNIC 5555.  Furthermore, the
            circuit might be forced across the network identified by DNIC
            4444.

        (2) "JSMITH:NETX:39" might build a circuit first to the network
            "NETX", and then to the host 39 within this network.  In other
            words, the first destination might be a network name, and the
            second a destination local to this network.

        (3) "JSMITH:NETX[@39]" might build a circuit first to the network
            "NETX", and then to the host 39 within this network.  The "@39"
            might be the NETX designation for host 39.

   Nothing more will be said about possible addressing schemes, since this is
   beyond the scope of this GED.





















   ADRII GED             Login String Format and Function                   -32-








   5.3  Supervisor Interpretation


   The login string can be used with many different network addressing plans,
   and the user's interpretation of it will vary accordingly.  However, the
   Supervisor interpretation is fixed no matter what the addressing scheme.
   The remainder of this section concerns how the login string functions with
   regard to Supervisor processing.

   The login string provides information needed to

        (1) Identify the user
        (2) Select a target (destination host) within the local network
        (3) Set parameters for login processing
        (4) Validate the login request

   In addition, some information in the login string will not be used by the
   Supervisor at all, but will be passed to the destination host in the local
   network.  If this host is a gateway to another network, the information
   passed might be used to continue routing the circuit.  For other types of
   hosts, this information might be used to select a port or a particular
   service.

   To understand how the login string functions in this way, it is necessary
   to understand the function of each component (field) of the login string.
   This is summarized below.  The details of how each field serves its
   function are given in section 5.4.

   FIELD              FUNCTION
   ----------------   ---------------------------------------------------
   Option             Sets various internal flags.
   User               Identifies a MUD user entry.
   Destination list   Identifies a host list or MUD destination entry.
   Extension          Represents data to be passed to the destination.
   Password           Validates the login request.

   These fields contribute to the functioning of the entire login string as
   follows:

   Login String
   Function           How the components contribute
   ----------------   --------------------------------------------------------
   Identify user      The MUD user entry serves to identify the user to the
                      network and validate the login.  (If no user entry is
                      found, the login request is rejected.) The user entry
                      contains the Universal User Number (UUN) which is used
                      to identify the user in the accounting record for the
                      login.

   Select target      If no destination list is present, the MUD user entry is
                      used to determine the home (default) destination.  If a
                      destination list is present, then the host list, or MUD
                      entry that it represents is "intersected" with the set
                      of destinations allowed by the user entry.  Some of the



   ADRII GED             Login String Format and Function                   -33-








                      flags set as a result of the option field also affect
                      the choice of the destination host.  Target selection is
                      described in section 7.

   Set parameters     Some of the flags set as a result of the option field
                      are used as parameters for later processing.  (Other
                      flags are merely passed on to the destination host as
                      part of the needle.)

   Validate login     For a login request to be valid, the user field must
                      identify an entry in the MUD.  Otherwise the request is
                      immediately rejected.  Furthermore, some user entries
                      specify that a password is required.  In such cases, the
                      requesting node must send a password, either as part of
                      the login string, or in a separate message.










































   ADRII GED             Login String Format and Function                   -34-








   5.4  Login String Fields


   As mentioned earlier, the login string consists of these fields: option,
   user, destination list, extension, and password.  Their syntax and
   interpretation are given in the following sections.




   5.4.1  Option field


   The option field is a new field which allows the user to specify login
   options by means of printable keywords, such as "HDX" and "RC".  This field
   serves the same basic function as the control characters in the LOGI login
   string.  However, the advantages of this field are: (1) keywords are more
   easily remembered than control characters, (2) keywords are printable,
   allowing the user to see which options are requested, and (3) in the future
   it will be easier to add new keywords than new control character flags,
   since control characters often have special meanings to interfaces.

   All options which could previously be specified via control characters can
   be specified by means of keywords.  In addition, the reverse charge option
   has been added.

   The entire options field, if present, must be enclosed in parentheses, and
   each individual option must be separated by a comma.  The format is:

      (<option1>,<option2>, ... <option3>)

   where each option has one of the following formats:

        (1) <keyword>
        (2) <keyword>=<value>

   In general, there is no limit to the length of a keyword.  However, only
   the first eight characters of a keyword are significant; remaining
   characters are ignored, although they must be valid option characters.  The
   first character must be a letter and the remaining ones must be
   alphanumerics or one of the following: pound sign, dollar sign, asterisk,
   ampersand, period, dash, and forward slash ("/").  Certain other characters
   are allowed, but ignored, as explained below.

   Before the option field is actually interpreted, some translations are
   done, namely:

        (1) The high order bit of each character is stripped off.
        (2) All characters preceding a ctrl-W are deleted, along with the
            ctrl-W itself.  In other words, the ctrl-W is interpreted as an
            "erase field" character.
        (3) The following characters are removed: null (hex 0), rubout (hex
            7F), all control characters (hex 01 through hex 1A), escape (hex
            1B), FS (hex 1C), GS (hex 1D), RS (hex 1E), US (hex 1F).



   ADRII GED             Login String Format and Function                   -35-








        (4) Lower case letters are translated to upper case.

   The currently defined keywords are listed below.  The keyword letters shown
   in upper case are required (although they are not required to be in upper
   case).  The remaining letters are not required, but are acceptable.  Thus,
   "tclass=a" and "tc=a" are both acceptable, whereas "t=a" and "tclassxyz=a"
   are not.  Note that several keywords are synonymous.

   Option
   keyword        Meaning
   -----------    -----------------------
   Batch          Batch circuit
   Halfdupl       Half-duplex
   Hdx            Half-duplex
   Interact       Interactive circuit
   Reverse        Reverse charge
   Rc             Reverse charge
   TClass=A       Throughput class A
   TClass=B       Throughput class B
   TClass=C       Throughput class C
   TClass=D       Throughput class D
   Volume         Batch (volume) circuit

   Some of the options are mutually exclusive.  A circuit can only have one
   throughput class.  Likewise, it cannot be both a batch and interactive
   circuit.  If two mutually exclusive options appear in the same login
   string, the last one takes effect.  Therefore, the option field
   "(tclass=c,batch,tclass=a,interactive)" has the same effect as
   "(tclass=a,interactive)".  If one of the options has already been specified
   via a MO in the login request message, the option field takes precedence.

   The result of initial processing of the option field is to set the
   appropriate flags.  These flags may be used later in Supervisor processing
   or may simply be passed to the destination in the needle.  The effect of
   each option flag is described in section 6.




   5.4.2  User field


   The user field serves to identify the person requesting the login.  It can
   contain two kinds of usernames: "regular" usernames, such as "JSMITH" or
   "BUBB", and X.121 usernames, such as "-3106(408)446-6000".

   This field is required in the login string unless the Originating Address
   field (OADR) is provided in the circuit request message.  If no username is
   given, the Supervisor will use the OADR in its place.  However, if neither
   username nor OADR is present, the login request will be rejected.

   Before the username is interpreted, the same translation is done as in the
   option field.  That is,




   ADRII GED             Login String Format and Function                   -36-








        (1) The high order bit of each character is stripped off.
        (2) All characters in the user field preceding a ctrl-W are deleted,
            along with the ctrl-W itself.  In other words, the ctrl-W is
            interpreted as an "erase field" character.
        (3) The following characters are removed: null (hex 0), rubout (hex
            7F), all control characters (hex 01 through hex 1A), escape (hex
            1B), FS (hex 1C), GS (hex 1D), RS (hex 1E), US (hex 1F).
        (4) Lower case letters are translated to upper case.

   Regular usernames must begin with a letter, digit, asterisk, pound-sign, or
   dollar-sign.  Thereafter, they can also contain ampersands, periods,
   dashes, and forward slashes ("/").  The maximum length is 20 characters
   (after the translation mentioned above).

   X.121 usernames consist of a dash, a Data Network Identifier Code (DNIC),
   and a Network Terminal Number (NTN).  The DNIC consists of exactly four
   decimal digits, and the NTN consists of zero to ten decimal digits.  In
   order to aid readability, X.121 usernames can also include parentheses,
   dashes, pluses, minuses, and blanks.  However, these cannot precede the
   initial dash, nor appear within the DNIC.  The Supervisor simply removes
   these characters before interpreting the X.121 destination or passing it in
   the needle.  Examples of syntactically valid X.121 usernames are "-3106",
   "-31060123456789", "-3106(408)446-6000", and even "-+3106((-408 446+6000".

   The purpose of the username is to identify an entry in the MUD.  In the
   case of regular usernames, the entire username is used to locate the MUD
   entry.  However, with X.121 usernames, it is possible that only a part of
   the username will be used.  For example, with username
   "-3106(408)446-6000", the string "-3106408446" might be used to locate the
   MUD entry.  This is explained in detail in section 8.




   5.4.3  Destination List


   This field serves to specify either a list of one or more destination
   hosts, or a MUD entry which abstractly specifies a set of destination
   hosts.  This host list or MUD entry, referred to as the "resultant target
   specification", is used to determine the actual host within the local
   network to which the Supervisor builds a circuit.  Note that this host may
   be a gateway to another network and the circuit may continue through it.
   However, the Supervisor is only responsible for the circuit to the local
   host.

   If there is no destination list at all, the resultant target specification
   is said to be null and the MUD user entry determines the default target
   hosts.  If there are one or two fields, then in most cases only the first
   one is used to derive the resultant target specification and the second one
   is merely passed along in the needle.  However, there are some cases in
   which both fields jointly define the resultant target specification.  The
   derivation of the specification is given in section 5.4.3.6.  However, it
   is first necessary to describe the types of destinations allowed in the



   ADRII GED             Login String Format and Function                   -37-








   list.

   Each destination in the destination list, whether used or merely passed in
   the needle, must begin with a colon and can consist of one of the
   following:

        (1) host/subhost list
        (2) active Supervisor identifier
        (3) kernel host identifier
        (4) symbolic hostname
        (5) X.121 destination

   Before the field is interpreted, the same translations are done as with the
   username and option field.  That is,

        (1) The high order bit of each character is stripped off.
        (2) All characters in the destination field preceding a ctrl-W are
            deleted, along with the ctrl-W itself.  In other words, the ctrl-W
            is interpreted as an "erase field" character.  Note that a ctrl-W
            in the second of two destination fields will only result in the
            second one being cleared.
        (3) The following characters are removed: null (hex 0), rubout (hex
            7F), all control characters (hex 01 through hex 1A), escape (hex
            1B), FS (hex 1C), GS (hex 1D), RS (hex 1E), US (hex 1F).
        (4) Lower case letters are translated to upper case.

   The various types of destinations are described below.




   5.4.3.1  Host/Subhost List


   The user can explicitly specify a single host/subhost, or else a list of
   hosts/subhosts, as follows:

      <host#>.<subhost#>,<host#>.<subhost#>, ...

   where <host#> consists of zero to five decimal digits, and <subhost#>
   consists of zero to four decimal digits.  Examples: "39", "39.12",
   "39,217,36", "39.12,217,36.24".

   The host numbers define the potential targets for the circuit.  The subhost
   numbers are not used by the Supervisor at all but simply passed on to the
   destination host in the needle.  If a single host/subhost is specified, and
   if the circuit is successful, that host receives the subhost number in the
   needle.  This number can be used, for example, to identify a port or an
   application on the destination host.  If several hosts/subhosts are
   specified, then only the relevant subhost number is passed to the
   destination in the needle.  For example, if the field is "39.12,36.24" and
   if the circuit is eventually routed to host 36, then subhost number 24 is
   passed in the needle.




   ADRII GED             Login String Format and Function                   -38-








   A single subhost number without any preceding host number is permitted.  In
   this case, the resultant target specification is null (which means the MUD
   user entry determines the destination), but the specified subhost is
   nevertheless passed in the needle.




   5.4.3.2  Active Supervisor identifier


   A single asterisk ("*") in the destination field indicates the host number
   of the currently active Supervisor.  This method of addressing is used
   primarily when logging into PROBE.  For example, "PROBE:*" logs the user
   into the PROBE slave of the active Supervisor.  In other words, if the
   active Supervisor is host 123, "PROBE:*" and "PROBE:123" have the same
   results.




   5.4.3.3  Kernel Host identifier


   In order to log into the kernel host of a given node, the user can specify
   the node number proceeded by a percent sign ("%").  That is, if node 2067
   has kernel host number 575, then the login string "JSMITH:%2067" is
   equivalent to the string "JSMITH:575" with regard to routing.




   5.4.3.4  Hostname


   Instead of using an explicit host number to specify a host or a service,
   the user can use a symbolic name - a "hostname".  Thus, "XPC" might be
   used to refer to the set of X.PC interfaces in the network.  The advantages
   of this type of addressing are: (1) well-chosen names are easier to
   remember than numbers, and (2) there is an opportunity for much more
   flexible targeting.

   A hostname must begin with a letter, but thereafter may contain any
   character allowed in a username.  The maximum length is 20 characters.













   ADRII GED             Login String Format and Function                   -39-








   5.4.3.5  X.121 destination


   X.121 destinations consist of a dash, a Data Network Identifier Code (DNIC),
   and a Network Terminal Number (NTN).  The DNIC consists of exactly four
   decimal digits, and the NTN consists of zero to ten decimal digits.  In
   order to aid readability, X.121 destinations can also include parentheses,
   dashes, pluses, minuses, and blanks.  However, these cannot precede the
   initial dash, nor appear within the DNIC.  The Supervisor simply removes
   these characters before interpreting the X.121 destination or passing it in
   the needle.  Examples of syntactically valid X.121 destinations are
   "-3106", "-31060123456789", "-3106(408)446-6000", and even "-+3106((-408
   446+6000".

   X.121 addresses that appear in the destination field therefore have the
   same syntax as those that appear in the user field.  However, the
   interpretation is slightly different, since the former can refer to either
   a MUD entry or an explicit host/subhost, whereas the latter must always
   refer to a MUD entry.  Section 8 explains how a MUD entry or host/subhost
   is derived from the X.121 destination.




   5.4.3.6  Derivation of the resultant target specification


   In most cases, the resultant target specification is derived from the first
   destination field in the list.  The second field, if present, will be
   passed in the needle, but is not used to select the target.  However, there
   is one case in which both fields contribute to the resultant target
   specification.  The table below lists the various cases.


   Condition                                  Resultant Target Specification
   ----------------------------------------   ------------------------------
   There is no destination list, or the       Null.  (The MUD user entry
   MUD user entry has the "ignore host" or    will be used to derive
   "transparent" flags set.                   default target hosts.)

   The first destination field is a host/     The list of specified hosts.
   subhost list.  (The second destination     (Subhosts are ignored for
   field, if any, is ignored for targeting    targeting purposes.)
   purposes.)

   The first destination field is an          The active Supervisor host
   active Supervisor identifier.  (The        number.
   second destination field, if any, is
   ignored for targeting purposes.)

   The first destination field is a kernel    The kernel host associated
   host identifier.  (The second              with the specified node.
   destination field, if any, is ignored
   for targeting purposes.)



   ADRII GED             Login String Format and Function                   -40-








   The first destination field is a           The MUD entry associated
   hostname.  (The second destination         with the hostname.  (The
   field, if any, is ignored for targeting    entire hostname is used to
   purposes.)                                 locate the MUD entry.)

   The first destination field is an X.121    The host or MUD entry
   destination which has one or more digits   associated with the X.121
   of NTN.  (The second destination field,    destination.  This is
   if any, is ignored for targeting           explained in section 8.
   purposes.)

   The first destination field is an X.121    The host or MUD entry
   destination which has no NTN.  Also,       associated with the X.121
   there is either (1) no second              destination.  This is
   destination field, or (2) the second       explained in section 8.
   field does not contain an X.121
   destination.

   The first destination field is an X.121    The MUD entry associated
   destination which has no NTN, and the      with the MUD name
   second destination is an X.121             -<DNIC1>-<DNIC2>.  <DNIC1>
   destination.                               is the DNIC given in the
                                              first field, and <DNIC2>
                                              is the DNIC given in the
                                              second field.  Normally, if
                                              there is no such entry, the
                                              Supervisor prompts for another
                                              login string.  However, the
                                              Supervisor can be configured to
                                              use the MUD entry -<DNIC1>
                                              whenever the entry
                                              -<DNIC1>-<DNIC2> is not found.
                                              This is a Tymfile option.




   5.4.4  Extension field


   The extension field allows the user to pass arbitrary data to the
   destination, such as X.25 Call User Data.  The only translation done on
   this field is to strip off the high-order bit of each character, and to
   interpret quotes, as explained below.  The Supervisor does not interpret
   the control-W as an erase character, remove nulls or other non-printable
   characters, or translate to upper case.

   The field must begin with a left square bracket ("[") and end with a right
   square bracket ("]").  Any character is allowed in the field except for the
   right square bracket ("]").  However, any character whatsoever - including
   the right square bracket - can be passed in this field by specifying its
   ASCII hex value proceeded by a double-quote character.  For example,

      one"5Dtwo



   ADRII GED             Login String Format and Function                   -41-








   in the extension field will be translated by the Supervisor to

      one]two

   since 5D is the ASCII hex value for the right square bracket.  In order to
   pass the double-quote character itself, the user must include two in
   sequence.  That is,

      one""two

   will be translated to

      one"two

   before being sent to the destination in the needle.  Note that the delimiting
   brackets are not sent in the needle.




   5.4.5  Password field


   The password field begins with a semicolon and is followed by the password
   itself.  The password can contain almost any character, printable or not.
   The Supervisor does the following translations before checking the validity
   of the password.

        (1) The high-order bit of each character is set to 0.
        (2) All null and rubout characters (hex 00 and 7F) are removed.
        (3) Lower case letters are translated to upper case.

   Note that all control characters - including control-W - are treated as
   part of the password.  Likewise with carriage-returns and semicolons.

   The password is required unless the MUD user entry specifies otherwise.
   This holds for both normal and aux circuits, although for the latter the
   default condition is no password required.  In order to validate the
   password, the Supervisor applies an encryption algorithm to it and derives
   the password "cipher".  This cipher is then compared to the one in the MUD
   user entry.  If the two match, the password is valid and login processing
   can continue.  Otherwise, the login request is rejected.















   ADRII GED             Login String Format and Function                   -42-








   5.5  LOGI vs. LOGII login strings


   Users can take full advantage of ADRII features even when logging in from
   LOGI nodes.  However, in a few regards the login strings from LOGI nodes
   must be interpreted like ADRI login strings.  Namely,

        (1) In ADRI or ADRII/LOGI login strings, a username can contain
            embedded control characters which are interpreted as option flags.
            The allowed characters are:

            Control
            Character      Meaning
            ---------      ----------------------
            ctrl-A         Throughput class A
            ctrl-B         Throughput class B
            ctrl-C         Throughput class C
            ctrl-D         Throughput class D
            ctrl-H         Half-duplex mode
            ctrl-I         Interactive circuit
            ctrl-V         Volume (batch) circuit

            In ADRII/LOGII, these options must be specified with printable
            keywords in the option field, or else outside the login string
            entirely in LOGII option MOs.  All control characters (except
            control-W) are ignored.

        (2) In ADRI or ADRII/LOGI login strings, any of the following
            characters can cause the reset condition: escape (hex 1B), curly
            braces ("{}"), vertical bar ("|"), tilde ("~"), and the four ASCII
            separator characters (hex 1C, 1D, 1E, 1F).  In ADRII/LOGII, these
            characters are simply ignored.  In order to cause a reset, the
            login request message must contain a Logon Session Reset MO.

        (3) In ADRI or ADRII/LOGI, the reset condition forces the Supervisor
            to discard any username or destination received in a previous
            login string (for the current login session).  However, the
            options set via control characters are cleared.  (Options set via
            the option field ARE cleared.)  On the other hand, an ADRII/LOGII
            Logon Session Reset MO resets all options (whether they were
            specified in the option field or with LOGII MOs) as well as all
            other information gleaned from previous login strings.

        (4) A login session zapper (hex 03) can appear in an ADRI or
            ADRII/LOGI login string to zap the login session.  (The Supervisor
            responds with a zapper acknowledgement, and the session is thereby
            terminated.)  In ADRII/LOGII, a Logon Session Zapper MO is
            required to zap the session and a hex 03 in the login string is
            ignored.

        (5) An ADRI or ADRII/LOGI login string must end with a terminator
            character, that is, either a carriage-return or a semicolon.  An
            ADRII/LOGII login string does not include any terminator at all.
            Carriage-returns are ignored and the first semicolon encountered



   ADRII GED             Login String Format and Function                   -43-








            (if any) is interpreted as the start of the password field.  A
            password (perhaps null) is assumed to follow, and may even include
            semicolons.






















































   ADRII GED             Login String Format and Function                   -44-








   6.  OPTION PROCESSING


   A login option can be specified by an option keyword in the option field,
   or an option MO.  If the login string is from a LOGI node, then all of the
   options except "reverse charge" can also be specified by means of control
   character flags.  This section describes the effect of each option on
   processing, regardless of how the option was originally specified.




   6.1  Reverse Charge


   If this option is set, the user can only log into hosts which have reported
   themselves as accepting reverse-charge circuits.  Consequently, if the
   login string specifies a single target, and that target does not accept
   reverse-charge circuits, the Supervisor rejects the login.  However, if the
   login string specifies several targets (for example, when the destination
   field contains a list of hosts) then only those which accept reverse-charge
   circuits are considered as potential targets.  (Of course, they may be
   down, out of ports, etc.)

   Furthermore, in target selection processing, only Access Profile Entries
   (APEs) which have the reverse-charge-ok bit set are used - the others are
   simply ignored.  This holds for both MUD user entries and MUD destination
   entries.  For example, the first APE in the MUD entry might permit logins
   from the requesting node, and it might even specify destination hosts which
   are all available.  But if the APE is not flagged for reverse charges, it
   is skipped over.

   If the login is successful, the Supervisor passes a reverse charge
   indication in the needle.

   It should be noted that the same situation applies to caller-charged logins
   (sent paid calls).  That is, these can only target to hosts which have
   reported their willingness to accept caller-charged circuits.  (This is the
   default case.)  Also, user and destination APEs can be flagged as
   permitting reverse-charge circuits only, in which case they are ignored
   when processing caller-charged circuits.

   By default, login requests are for caller-charged circuits.














   ADRII GED                     Option Processing                          -45-








   6.2  Half-duplex


   If this option is set, the Supervisor returns a half-duplex indication in
   the needle.  This informs both the requesting host and destination host to
   put the user into half-duplex mode.  Also, if the Supervisor must send a
   response/reject message (for example, requesting a password), then this
   message also indicates half-duplex mode.  This is needed by some
   originating interfaces, such as the Consat, in order to know how to handle
   the echoing or masking of passwords.

   Unless specified otherwise, login requests are for full-duplex circuits.




   6.3  Interactive/batch


   The interactive/batch flag, along with the throughput class, determine
   which cost table is used during path-finding.  By default, all circuits are
   interactive.  The following table shows the cost table used as a function
   of these two parameters.

   Throughput     Circuit         Cost table
   class          Type            used
   ----------     -----------     ----------
      A           Batch               0
      B           Batch               1
      C           Batch               2
      D           Batch               3
      A           Interactive         4
      B           Interactive         5
      C           Interactive         6
      D           Interactive         7

   The cost table code is passed in the needle.  However, the
   interactive/batch flag is not.




   6.4  Throughput class


   The throughput class, along with the interactive/batch flag, determine the
   cost table used for path-finding.  The throughput class is also passed in
   the needle.  The throughput class, if not specified via a LOGII MO or the
   login string option field, takes on a default value which is a function of
   the CCT.







   ADRII GED                     Option Processing                          -46-








   7.  TARGET SELECTION


   The login string may specify a destination within the local network, in
   which case the Supervisor is responsible for building the entire circuit.
   However, if the destination is in a foreign network, the Supervisor can
   only build the circuit up to the appropriate gateway interface and must
   then rely upon that gateway to complete it.  In either case, the Supervisor
   must find an appropriate target within the local network.  In this
   discussion, "target" and "destination host" both refer the host within the
   local network, even if the final destination is in a foreign network.

   The two main items needed to select a target are the MUD user entry and the
   resultant target specification.  Target selection depends upon whether the
   resultant target specification is

        (1) a list of one or more hosts
        (2) a MUD entry
        (3) null (i.e., there is no destination list in the login string)

   The three possible cases are described in the following sections.  However,
   first it is necessary briefly describe the layout and meaning of the MUD
   entries.  More detail is provided in the GED for the MUDII project.




   7.1  MUD entry layout


   A MUD entry consists of a Header and an Access Profile.  The Header
   contains various fields such as the user's Universal User Name (UUN) and
   the password cipher.  It also contains a set of flags, such as the
   username-ok flag (which indicates that the MUD entry may be used as a
   username) and the destination-ok flag (which indicates that it may be used
   as a destination name).

   The Access Profile contains one or more Access Profile Entries (APEs).
   Each APE contains a set of flags, an Origination Specification, a
   Destination Specification, a Home Specification, and a Local Sets
   Specification.  The flags indicate the circumstances under which the APE
   can be used.  Therefore, even if the MUD entry as a whole is applicable, a
   given APE might not be usable.  An example is when the login request is for
   an aux-circuit, but the APE is flagged as being for normal circuits only.
   This does not mean that the login request is aborted (at least, not yet).
   Rather, this particular APE is skipped and the next one is examined.  (If
   there is no next APE, the login request will indeed be rejected.)  The
   flags might also affect how the APE is processed.  An example is the
   shut-override flag, which is described in section 7.2.3.

   The Origination Specification represents a set of hosts and/or nodes from
   which the user can build a circuit.  This set is referred to as the
   "origination set" for this APE.  It might include just a few host or nodes,
   or it might include every host/node in the network except certain ones.  As



   ADRII GED                     Target Selection                           -47-








   with the APE flags, the origination set serves to determine if the APE can
   be used for the particular login request.  If neither the requesting host
   nor requesting node is in this set, then the APE is skipped.

   The Destination Specification represents a set of hosts which the user is
   allowed to log in to.  This set is referred to as the "destination set" for
   this APE.  The APE can be used for the particular login request only if the
   destination set includes the host or hosts specified in the login string.
   If not, the APE is skipped.

   The Home Specification represents a set of hosts which the user is targeted
   to when he has not specified any destination in the login string (i.e.,
   when the destination list field is empty).  This is referred to as the
   "home set" for this APE.

   The Local Sets Specification is used to by the Supervisor to interpret the
   various other specifications.  The details are not relevant here.




   7.2  Case 1 - host list


   If the resultant target specification is a list of one or more hosts, then
   the destination host (if any) will naturally be one of these.  The
   following procedure is used to select the destination host from this list:
   Find the first APE in the MUD user entry such that

        (1) All APE flags are valid,
        (2) The APE origination set is valid,
        (3) The intersection between the host list and the APE destination set
            is not empty.  (That is, at least one host in the host list is
            included in the destination set.)
        (4) At least one host in the intersection is valid

   Of the valid hosts in the intersection, the one with the least-cost path to
   the requesting host is taken as the destination host.  Note that although
   there may be several APEs which satisfy these requirements, only the first
   one is used to select the destination host.  Naturally, if no APE meets
   these requirements, the login request is rejected.

   There is an obscure exception to this, namely when the number of hosts in
   the intersection exceeds the multi-target limit.  The multi-target limit is
   the maximum number of hosts which the Supervisor will consider at one time
   when using its path-finding algorithm.  If this limit is 6, for example,
   the Supervisor first considers only the 6 lowest-numbered hosts.  If no
   path is found, the next 6 hosts are considered, and so on until a path is
   found to one of them, or until the entire list of host is exhausted.  With
   this algorithm, the host eventually selected will have the lowest cost path
   of all hosts considered at the same time, but not necessarily the lowest
   cost of all hosts.

   Requirements 1, 2, and 4 are explained below.  The concept behind



   ADRII GED                     Target Selection                           -48-








   requirement 3 should be clear, even though the representation of the
   destination set has not been explained.




   7.2.1  All APE flags are valid


   The following table shows the relevant APE flags and the values they must
   have.

   APE flag                 When the flag is valid
   -------------------      --------------------------------------------
   username ok              This flag must be set when the MUD entry is
                            being used as a user entry.
   destination ok           This flag must be set when the MUD entry is
                            being used as a destination entry.
   normal circuit ok        This must be set if the circuit is a normal
                            one (as specified by the circuit request
                            message).
   aux circuit ok           This must be set if the circuit is an
                            aux-circuit (as specified by the circuit
                            request message).
   reverse charge ok        This must be set if the reverse charge option
                            was specified in the circuit request message.
   non-reverse charge ok    This must be set unless the reverse charge
                            option was specified in the circuit request
                            message.
   require hostname         This must be off except when the resultant target
                            specification is a MUD entry (case 2).




   7.2.2  The APE origination set is valid


   The origination set is the one represented by the APE Origination
   Specification field.  It is valid for the particular login request if it
   contains either the requesting node or requesting host.  The requesting
   node is always given, and the requesting host may be given, in the login
   request message.














   ADRII GED                     Target Selection                           -49-








   7.2.3  At least one host in the intersection is valid


   A host is considered valid if it meets these requirements:

        (1) it is currently answered
        (2) it currently has available ports
        (3) there is a path to its base node

   There is one tricky special case, however.  If none of the hosts in the
   intersection are answered, but

        (4) one or more hosts are shut
        (5) the shut-override flag is set in this APE
        (6) there is a path to the highest-numbered shut host

   then this highest-number shut host, and only this host, is considered
   valid.  In most cases where shut-override is relevant, the user explicitly
   specifies a single host which he knows to be shut.




   7.3  Case 2 - MUD entry


   If the resultant target specification is a MUD destination entry, then the
   destination host must be a host which is allowed both by this MUD entry and
   the MUD user entry.  The destination host is determined as follows:  Find
   the first pair of APEs, one from the user entry and one from the
   destination entry, such that:

        (1) All APE flags (in both APEs) are valid.
        (2) The APE origination set (in both APEs) is valid.
        (3) The intersection between the destination sets of the MUD entries
            is not empty.  (That is, there is at least one host in the user
            entry's destination set which is also in the destination entry's
            destination set.)
        (4) At least one host in the intersection is valid

   The APE pairs are considered to be ordered as follows, "1,1" (first user
   APE, first destination APE), "1,2" (first user APE, second destination APE
   - assuming there is one), "1,3", and so forth.  Further down in the
   ordering will be "2,1", "2,2", "2,3", and so on.  In other words, one pair
   of APEs is said to precede another if the user APE of the first pair
   precedes the user APE of the second pair, or alternatively, if the user
   APEs in both pairs are the same, but the destination APE of the first pair
   precedes the destination APE of the second.  Thus, the term "first" pair is
   well-defined.

   Of the valid hosts in the intersection, the one with the least-cost path to
   the requesting host is taken as the destination host.  Note that although
   there may be several APE pairs which satisfy these requirements, only the
   first one is used to select the destination host.  Naturally, if no APE



   ADRII GED                     Target Selection                           -50-








   pair meets these requirements, the login request is rejected.

   There is an obscure exception to this, namely when the number of hosts in
   the intersection exceeds the multi-target limit.  The multi-target limit is
   the maximum number of hosts which the Supervisor will consider at one time
   when using its path-finding algorithm.  If this limit is 6, for example,
   the Supervisor first considers only the 6 lowest-numbered hosts.  If no
   path is found, the next 6 hosts are considered, and so on until a path is
   found to one of them, or until the entire list of host is exhausted.  With
   this algorithm, the host eventually selected will have the lowest cost path
   of all hosts considered at the same time, but not necessarily the lowest
   cost of all hosts.

   Requirements 1, 2, and 4 are basically the same as when the resultant
   target specification is a host list (case 1).  They are explained in
   sections 7.2.1 through 7.2.3 above.  The concept behind requirement 3
   should be clear, even though the representation of the destination set has
   not been explained.




   7.4  Case 3 - null specification


   If there is no resultant target specification at all, that is, if the login
   string does not contain a destination list, then the user must be targeted
   to a default host specified in the MUD user entry.  This host is determined
   as follows:

   Find the first APE in the user entry such that

        (1) All APE flags are valid.
        (2) The APE origination set is valid.
        (3) At least one host in the APE home set is valid.

   Then the valid host in the Home Set which has the least-cost path to the
   requesting node is the destination host.  Note that although there may be
   several APEs which satisfy these requirements, only the first one is used
   to select the destination host.  Naturally, if no APE meets these
   requirements - meaning that there are no valid hosts at all - the login
   request is rejected.

   There is an obscure exception to this, namely when the number of hosts in
   the intersection exceeds the multi-target limit.  The multi-target limit is
   the maximum number of hosts which the Supervisor will consider at one time
   when using its path-finding algorithm.  If this limit is 6, for example,
   the Supervisor first considers only the 6 lowest-numbered hosts.  If no
   path is found, the next 6 hosts are considered, and so on until a path is
   found to one of them, or until the entire list of host is exhausted.  With
   this algorithm, the host eventually selected will have the lowest cost path
   of all hosts considered at the same time, but not necessarily the lowest
   cost of all hosts.




   ADRII GED                     Target Selection                           -51-








   Requirements 1 and 2 are the same as in case 1.  The last requirement is
   analogous to requirement 4 of case 1.  That is, hosts in the APE home set
   are valid under the same conditions as hosts in the
   host-list/destination-set intersection.





















































   ADRII GED                     Target Selection                           -52-








   8.  X.121 ADDRESS INTERPRETATION


   X.121 style addresses can appear in both the username and destination list
   fields.  The interpretation is similar in either case, except that an X.121
   username must ultimately refer to an entry in the MUD, whereas an X.121
   destination name may refer either to a MUD entry or a host.  Also, an X.121
   username must refer to a MUD entry that has the username-ok bit set
   (meaning that the entry can be used as a username).  On the other hand, an
   X.121 destination name - if it refers to a MUD entry at all - must refer to
   one with the destination-ok bit set.

   There is a default way of interpreting an X.121 address, that is, by using
   the DNIC table to derive a MUD name.  However, in Tymnet, there are certain
   classes of X.121 addresses which get special treatment.  The default case
   is considered first.




   8.1  Default case


   The DNIC table is used when an X.121 address is specified in the user field
   or destination field of the login string.  It specifies how to derive a MUD
   name from an X.121 address.  The table contains an entry for each DNIC the
   Supervisor has knowledge of.  Each entry contains a "shared" flag, a
   "native" flag, a "synonymous" flag, and two byte counts.  Both the shared
   and synonymous attributes are relevant only for native DNICs and are
   ignored otherwise.

   If the "native" flag is set, the DNIC is within the local network (i.e.,
   the one controlled by the Supervisor).  The Tymnet Supervisor controls DNIC
   3106, but also various others.

   If the "shared" flag is set, the DNIC is shared between two or more
   networks.  For example, some of the nodes for RCA's DNIC 3113 are part of
   Tymnet, whereas others are part of other networks not controlled by the
   Tymnet Supervisor.

   If the "synonymous" flag is set, then the DNIC follows the same numbering
   plan as the default DNIC.  For example, if DNIC 3113 is synonymous to
   Tymnet's default DNIC 3106, then the address -3113555 refers to the same
   entity as -3106555.

   The primary byte count specifies how many digits of the NTN should be used
   determine the MUD name.  This allows several X.121 addresses which share
   high-order NTN digits to refer to the same MUD entry.  The secondary byte
   count is used when two MUD lookups are necessary (which can only occur in
   cases 1 and 2 below).







   ADRII GED               X.121 Address Interpretation                     -53-








   8.1.1  Case 1 - native, shared, synonymous DNIC


   This means that part of the DNIC is controlled by the Supervisor's network,
   and part of it is controlled by a foreign network.  Furthermore, the
   numbering plan for the DNIC must be consistent with the default (i.e.,
   Supervisor's DNIC).  The MUD name consists of

        (1) a dash, followed by
        (2) the default DNIC for the network, followed by
        (3) n digits of the NTN, where n is the primary byte count for this
            DNIC

   However, if this MUD entry does not exist, or if the NTN has fewer than n
   digits, then the MUD name is

        (1) a dash, followed by
        (2) the default DNIC for the network, followed by
        (3) m digits of the NTN, where m is the secondary byte count for this
            DNIC

   If the NTN has fewer than m digits, there is simply no MUD name associated
   with this X.121 address.

   If the DNIC had been non-shared, then the lack of a MUD entry would
   indicate that the X.121 address is invalid - since presumably all valid
   addresses would be accounted for in the MUD.  However, with a shared DNIC,
   an address not known to the Supervisor might still be valid in another
   network.  Yet the Supervisor cannot maintain a MUD entry for all valid
   addresses in the other networks.  Consequently, the Supervisor can only
   route the call to the appropriate gateway and assume that the other network
   will validate the call.  The secondary count is therefore used to derive a
   MUD name for a set of gateways.  (At least, this would be the expected
   situation.  However, the Supervisor does not check the reasonableness of
   the MUD entries.)  The secondary count will probably be 0 in most cases,
   meaning that the resultant MUD name will contain only a dash followed by
   the default DNIC.




   8.1.2  Case 2 - native, shared, non-synonymous DNIC


   This means that part of the DNIC is controlled by the Supervisor's network,
   and part of it is controlled by a foreign network.  However, the numbering
   plan for the DNIC is independent of the default DNIC's numbering plan.  The
   MUD name is the same as in case 1, except that the specified DNIC is used
   rather than the default DNIC.  That is, the MUD name is

        (1) a dash, followed by
        (2) the DNIC, followed by
        (3) n digits of the NTN, where n is the primary byte count for this
            DNIC



   ADRII GED               X.121 Address Interpretation                     -54-








   However, if this MUD entry does not exist, or if the NTN has fewer than n
   digits, then the MUD name is

        (1) a dash, followed by
        (2) the DNIC, followed by
        (3) m digits of the NTN, where m is the secondary byte count for this
            DNIC

   If the NTN has fewer than m digits, there is simply no MUD name associated
   with this X.121 address.




   8.1.3  Case 3 - native, non-shared, synonymous DNIC


   This means that the entire DNIC is contained by the Supervisor's network
   and that it uses the same numbering plan as the default DNIC.  Since all
   valid X.121 addresses with this DNIC must be validated in the MUD, there is
   no reason for a double look-up.  The MUD name is

        (1) a dash, followed by
        (2) the default DNIC for the network, followed by
        (3) n digits of the NTN, where n is the primary byte count for this
            DNIC

   If the NTN has fewer than n digits, there is simply no MUD name associated
   with this X.121 address.




   8.1.4  Case 4 - native, non-shared, non-synonymous DNIC


   This means that the entire DNIC is contained by the Supervisor's network
   but that it uses an independent numbering plan from the default DNIC's
   numbering plan.  Since all valid X.121 addresses with this DNIC must be
   validated in the MUD, there is no reason for a double look-up.  The MUD
   name is

        (1) a dash, followed by
        (2) the DNIC, followed by
        (3) n digits of the NTN, where n is the primary byte count for this
            DNIC

   If the NTN has fewer than n digits, there is simply no MUD name associated
   with this X.121 address.








   ADRII GED               X.121 Address Interpretation                     -55-








   8.1.5  Case 5 - non-native DNIC


   The DNIC is entirely controlled by one or more foreign networks.  The
   shared and synonymous bits are simply ignored.  The MUD name is the same as
   in case 4, namely

        (1) a dash, followed by
        (2) the DNIC, followed by
        (3) n digits of the NTN, where n is the primary byte count for this
            DNIC

   If the NTN has fewer than n digits, there is simply no MUD name associated
   with this X.121 address.




   8.1.6  Case 6 - unknown DNIC


   The DNIC is not in the Supervisor's DNIC table, and is therefore unknown.
   There is simply no MUD name corresponding to the X.121 address.




   8.2  Special Tymnet addressing


   If the Supervisor Tymfile indicates that the Tymnet numbering plan is in
   effect, then the X.121 addresses are given special interpretations in some
   cases.  When an X.121 address appears in the destination list of the login
   string, the special interpretation only takes place when

        (1) the DNIC in the X.121 address is the default DNIC, and
        (2) the first digit of the NTN is 0, 8, or 9

   In all other cases, the default interpretation takes effect.

   If the NTN starts with 0, the X.121 address is interpreted as specifying a
   host number and (possibly) a subhost number.  The five digits following the
   0 are taken as the host number, and the subsequent digits (up to four) are
   taken as the subhost number.  The full five digits of host number are
   required, but the subhost number can be anywhere from zero to four digits
   long.  For example, the following NTNs are valid: 000039 (host 39, no
   subhost), 0000391 (host 39, subhost 1), 00003912 (host 39, subhost 12),
   000039123 (host 39 subhost 123), 0000391234 (host 39, subhost 1234).  The
   host number is used as the destination host.  The subhost number is simply
   passed to the destination as part of the needle.  It is not used by the
   Supervisor at all

   If the NTN starts with an 8, the X.121 address is interpreted as specifying
   a MUD name which consists of the first six digits of the NTN (that is,



   ADRII GED               X.121 Address Interpretation                     -56-








   including the digit 8).  Any remaining digits (up to four) are taken as the
   subhost number.  For example, an X.121 address with an NTN of 800039123
   refers to MUD name 800039 and to subhost 123.  The MUD name is used for
   target selection, as described in section 7.  The subhost number is simply
   passed to the destination as part of the needle.

   If the NTN starts with a 9, the X.121 address is interpreted as specifying
   a MUD name which consists of the entire NTN, including the digit 9.  For
   example, an X.121 address with an NTN of 900039123 refers to the MUD name
   900039123.  No subhost number will be passed in the needle.

   When an X.121 address appears in the user field of a login string, the
   interpretation is the same as above, except that addresses with NTNs
   starting with 0 are treated as in the default case.  That is, the NTN is
   not interpreted as a host/subhost number.  Rather, the DNIC table is used
   to construct a MUD name from the X.121 address.  The reason is that it does
   not make sense for an X.121 username to refer to a host number.  A username
   of any sort must always identify a MUD entry.

   In the following summary, "<username>" represents an arbitrary username,
   "<destination>" represents an arbitrary destination, and "h", "s", and "x"
   represent decimal digits.


   Login string                     Supervisor interpretation
   -----------------------------    ------------------------------------------
   -31060x:<destination>            Default interpretation (Section 8.1)
   -31060xx:<destination>           Default interpretation (Section 8.1)
   -31060xxx:<destination>          Default interpretation (Section 8.1)
     . . .                              . . .
   -31060xxxxxxxxx:<destination>    Default interpretation (Section 8.1)

   -31068hhhhh:<destination>        MUD username: 8hhhhh
   -31068hhhhhs:<destination>       MUD username: 8hhhhh  Subhost: s
   -31068hhhhhss:<destination>      MUD username: 8hhhhh  Subhost: ss
   -31068hhhhhsss:<destination>     MUD username: 8hhhhh  Subhost: sss
   -31068hhhhhssss:<destination>    MUD username: 8hhhhh  Subhost: ssss

   -31069x:<destination>            MUD username: 9x
   -31069xx:<destination>           MUD username: 9xx
   -31069xxx:<destination>          MUD username: 9xxx
     . . .                              . . .
   -31069xxxxxxxxx:<destination>    MUD username: 9xxxxxxxxx

   <username>:-31060hhhhh           Destination host: hhhhh
   <username>:-31060hhhhhs          Destination host: hhhhh  Subhost: s
   <username>:-31060hhhhhss         Destination host: hhhhh  Subhost: ss
   <username>:-31060hhhhhsss        Destination host: hhhhh  Subhost: sss
   <username>:-31060hhhhhssss       Destination host: hhhhh  Subhost: ssss

   <username>:-31068hhhhh           MUD destination name: 8hhhhh
   <username>:-31068hhhhhs          MUD destination name: 8hhhhh  Subhost: s
   <username>:-31068hhhhhss         MUD destination name: 8hhhhh  Subhost: ss
   <username>:-31068hhhhhsss        MUD destination name: 8hhhhh  Subhost: sss



   ADRII GED               X.121 Address Interpretation                     -57-








   <username>:-31068hhhhhssss       MUD destination name: 8hhhhh  Subhost: ssss

   <username>:-31069x               MUD destination name: 9x
   <username>:-31069xx              MUD destination name: 9xx
   <username>:-31069xxx             MUD destination name: 9xxx
     . . .                              . . .
   <username>:-31069xxxxxxxxx       MUD destination name: 9xxxxxxxxx


















































   ADRII GED               X.121 Address Interpretation                     -58-








   9.  RESPONSE/REJECT MESSAGES


   The following table lists the conditions under which ADRII sends a response
   or reject message rather than a needle to the requesting node.  They are
   presented here out of context, and are best understood in terms of the
   login states, which are described in sections 3 and 4.

   Most of these conditions indicate some sort of failure, such as a syntax
   error or a bad password.  Some failures cause a reject message to be sent
   and the session to be immediately terminated.  Others cause response
   messages to be sent which provide information to the node/host, and also
   prompt for more information.  However, a few conditions are simply part of
   the login dialogue, such as the request for a password.  Note that there
   may be other failure conditions detected by the LOGII or MUDII code which
   are not listed below.

   The numbers on the left of the table are merely for reference purposes and
   are not sent in the message.  The "message sent" column gives a rough idea
   of what response or reject message is sent as a result of the condition.
   The exact contents of the message will depend upon whether the current
   login dialogue uses LOGI or LOGII messages, and whether the request is for
   a normal or aux circuit.  This information is provided in the LOGII GED,
   since it is the LOGII portion of the Supervisor code which actually sends
   the messages.  ADRII merely informs the LOGII code of the condition.

   The table is arranged to indicate roughly the order in which the conditions
   are encountered, with higher-numbered conditions being in some sense
   "closer" to success.  If several failures occur before ADRII stops
   processing the login, it is the failure closest to success that is reported
   to the LOGII code.  For example, the first APE in the user entry might not
   have a valid origination, the second might yield a set of hosts which are
   available but not reachable (i.e., no path is available), and the third APE
   might yield a set of target hosts which are unknown.  ADRII will report the
   second condition.

   When ADRII encounters a condition that requires it to send a response or
   reject message to the node, it calls the appropriate LOGII subroutine and
   passes it (1) a condition code which indicates the reason why a message
   should be sent, (2) a flag which indicates whether the login session must
   be terminated due to an excess of failures (too many invalid passwords, too
   many resets, and so on).  For example, if an invalid password is received
   and the failure limit has not yet been exceeded, then LOGII is called with
   a code indicating condition 19 and with the terminate flag off.  LOGII will
   send a response/reject message indicating "error, type password", and the
   dialogue continues.  However, if an invalid password is received after the
   failure limit has been exceeded, then ADRII calls LOGII indicating the same
   condition code, but with the terminate flag on.  LOGII sends one or more
   response/reject messages which indicate "please see your representative"
   and also hang the port.

   Note that some conditions, such as timeout, necessarily require the session
   to be terminated.  In such cases, the terminate flag is not necessary and
   is ignored by LOGII.



   ADRII GED                 Response/Reject Messages                       -59-








   #   Response/reject condition                    Possible message sent
   --  -------------------------------------------  ---------------------
   1   Login string required for aux-circuit.  A    (continue)
       LOGI aux-circuit request has been received
       and the Supervisor is ready to proceed.

   2   Timeout.  The requesting node did not        please see your
       reply to a Supervisor message within the     representative...
       time allowed.

   3   Login zapper received.  In a LOGII message,  (zapper ack)
       a login zapper is indicated by the Logon
       Session Zapper MO.  In a LOGI message, it
       appears in the logon characters field as a
       hex 03.

   4   Supervisor not able to process logins.       try again in two
       This might be due to a lack of internal      minutes
       storage, the Probe NETLOG command, or
       some other condition.

   5   Session reset.  In a LOGII message, the      please log in:
       reset condition is indicated by the Logon
       Session Reset MO.  In a LOGI message, it
       appears in the logon characters field as
       an ASCII escape.

   6   Missing username in login string.  Neither   username:
       a username nor an originating address was
       given in the login string.  (If the latter
       had been present, it would have been used
       in lieu of the username.)

   7   Field size too long in login string.         error, type username:

   8   Invalid character in login string.           error, type username:

   9   No user entry.  There is no MUD user         error, type username:
       entry corresponding to the username in
       the login string.  Note: it is possible
       that there is a MUD entry, but that it is
       flagged as a destination entry only.

   10  DNIC in X.121 username unknown.  The DNIC    error, type username:
       is not in the DNIC table.

   11  NTN in X.121 username too short for          error, type username:
       specified DNIC.  (The DNIC table
       indicates the minimum number of digits
       allowed in an NTN.)

   12  DNIC in X.121 destination name unknown.      error, type username:
       The DNIC is not in the DNIC table.




   ADRII GED                 Response/Reject Messages                       -60-








   13  NTN in X.121 destination name too short      error, type username:
       for specified DNIC.  (The DNIC table
       indicates the minimum number of digits
       allowed in an NTN.)

   14  No destination entry for hostname or         error, type username:
       X.121 address.  Either there is no MUD
       entry corresponding to the hostname or
       X.121 address, or else it is flagged as
       a username-only entry.

   15  Specified Node unknown.  The destination     error, type username:
       field contained a "%" followed by a node
       number, but the node is not in the
       network.

   16  Password required and already buffered in    (continue)
       the requesting node.  This can only occur
       when the circuit request is in the LOGI
       format.  The Supervisor detects that the
       password is buffered whenever the login
       string ends with a semicolon.  It
       therefore requests the node to send the
       password without prompting the user.
       (Note: in a LOGII login string, the
       presence of a semicolon means that the
       password is included in the login string
       itself - after the semicolon.  If the
       semicolon is the last character in the
       login string, a null password is assumed
       rather than the lack of one.)

   17  Password required.  The MUD entry for the    password:
       user specifies that a password is
       required.  However, the login string did
       not contain a password, nor did it end
       with a semicolon.  (A final semicolon
       indicates, in LOGI, that the requesting
       node has buffered the password.  In LOGII,
       it indicates that a password is included
       in the login string -  a null password.)

   18  Null password.  The login string ends        password:
       with a semicolon and the circuit request
       is in the LOGII format.  This indicates
       that a null password is included in the
       login string.  (If the message had been
       in LOGI format, the semicolon would
       indicate that the requesting node has
       buffered the password.)  This condition
       is distinguished from "invalid password"
       and "password required", because some
       interfaces may (now or in the future)
       handle it differently.  Currently, the



   ADRII GED                 Response/Reject Messages                       -61-








       Consat treats null passwords like
       missing passwords rather than like
       invalid ones.

   19  Invalid password.  The password sent in      error, type password:
       the login request message, after being
       ciphered, did not match the password
       cipher in the MUD user entry.

   20  No user APE with valid flags (ignoring       access denied
       the reverse charge flags).  All of the
       user APEs failed because of invalid flags
       other than the reverse charge flags.
       (Therefore, adding or dropping the
       reverse charge option would not make any
       difference.)

   21  Reverse charge or non-reverse charge         access denied
       barred by user entry.  One or more APEs
       in the MUD user entry had valid flags
       except for the reverse charge flags.
       (Therefore, dropping or adding the
       reverse charge option might make a
       difference.)

   22  No user APE with valid origin.  One or       access denied
       more APEs were found with valid flags,
       but none of these included the requesting
       node or requesting host in their
       Origination Specification fields.

   23  No destination APE with valid flags          access denied
       (ignoring the reverse charge flags).  All
       of the destination APEs failed because of
       invalid flags other than the reverse
       charge flags.  (Therefore, adding or
       dropping the reverse charge option would
       not make any difference.)

   24  Reverse charge or non-reverse charge         access denied
       barred by destination entry.  One or more
       APEs in the MUD destination entry had
       valid flags except for the reverse charge
       flags.  (Therefore, dropping or adding
       the reverse charge option might make a
       difference.)

   25  No destination APE with valid origin.        access denied
       One or more APEs were found which had
       valid flags.  However, none of them
       included the requesting node or host
       in their Origination Specifications.

   26  Null intersection between user Access        access denied



   ADRII GED                 Response/Reject Messages                       -62-








       Profile and specified host(s).  There is
       no valid user APE which contains any of
       the hosts specified in the login string.

   27  Null intersection between user Access        access denied
       Profile and destination Access Profile.
       There is no host which appears in both a
       valid user APE and a valid destination
       APE.

   28  No home hosts.  The user did not specify     access denied
       any destination in the login string.  One
       or more APEs were found with a valid
       origination and valid flags, but none of
       these contained a Home Specification
       Field.

   29  Host unknown.  One or more target hosts      host not available
       were allowed by the user entry and           thru net
       resultant target specification, but none
       were known to the Supervisor.

   30  Host is originate-only.  One or more         access denied
       target hosts were allowed by the user
       entry and the resultant target
       specification, but none of them allowed
       for terminations.

   31  Host does not accept reverse charging.       access denied
       One or more target hosts were allowed by
       the user entry and the resultant target
       specification, but none allowed reverse
       charging (and this option was specified).

   32  Host accepts only reverse charging.  One     access denied
       or more target hosts were allowed by the
       user entry and the resultant target
       specification, but all required reverse
       charging (and this option was not
       specified).

   33  Host down.  One or more target hosts were    host down
       found which were known to the Supervisor,
       but none were up.

   34  Host shut.  One or more target hosts were    host shut
       found which were up, but they were all
       shut and the user did not have
       shut-override license.

   35  Host out of ports.  One or more target       host out of ports
       hosts were found which were answered, but
       none had any ports.




   ADRII GED                 Response/Reject Messages                       -63-








   36  No path to host.  One or more target         circuits busy
       hosts were found which were answered and
       had ports.  However, the Supervisor could
       not find a path from the requesting node
       to any of the hosts.

   37  Invalid MUD format detected.                 bad mud


















































   ADRII GED                 Response/Reject Messages                       -64-








   10.  NEEDLE INFORMATION


   If ADRII has enough information to process the login request, and if none
   of the conditions mentioned in section 9 occur, then it sends a needle to
   the requesting host.  The needle contains data needed build the circuit,
   such as the list of nodes in the circuit path, and other data intended for
   use by the destination host, such as a flag indicating an IIX circuit.

   The exact contents of the message will depend upon whether the current
   login dialogue uses LOGI or LOGII messages.  This information is provided
   in the LOGII GED, since it is the LOGII portion of the Supervisor code
   which actually sends all login related messages.  ADRII provides LOGII with
   most of the information it needs to construct the appropriate needle
   message.

   The following sections describe the data which ADRII passes to LOGII and
   how this data is derived.  Note that flags set by ADRII are not necessarily
   passed in the needle as bit flags, but might instead be LOGII MOs.




   10.1  Circuit cost


   This is the cost of the circuit as calculated by the Supervisor
   path-finding routine.  It is derived by adding the costs of each link in
   the needle node list of the path.




   10.2  Cost table


   The Supervisor chooses the appropriate cost table for path-finding based
   upon the user's throughput class and whether the circuit is interactive or
   batch.  These parameters may be set by the user, or else take on default
   values, as explained in section 6.  The following table shows the cost
   table codes sent in the needle.

   Throughput     Circuit         Cost table
   class          Type            code
   ----------     -----------     ----------
      A           Batch               0
      B           Batch               1
      C           Batch               2
      D           Batch               3
      A           Interactive         4
      B           Interactive         5
      C           Interactive         6
      D           Interactive         7




   ADRII GED                    Needle Information                          -65-








   10.3  Destination host


   This is the destination within the Supervisor-controlled network regardless
   of whether the circuit eventually terminates in some foreign network.  The
   criteria for selecting the destination host is explained in section 7.




   10.4  Destination subhost


   This is a number which the user can specify in various ways in the login
   string.  The Supervisor does not use it during the login process, but
   simply passes it on to the destination in the needle.  The destination host
   may interpret this, for example, as a port number or (if it is a gateway to
   a local network) a terminal number.

   The subhost number is derived from the login string as follows:

   Case 1:  The first destination field of the login string consists of a
            single subhost.  (That is, ".ssss", where ssss represents one
            to four decimal digits.)  This number is the subhost sent in
            the needle.  For example, if the login string is "JSMITH:.123",
            then the circuit will be built to a home host specified in the
            MUD user entry, and the subhost sent in the needle will be "123".

   Case 2:  The first destination field of the login string consists of a
            host/subhost list.  The destination host will be one of the hosts
            specified in the list and the subhost associated with this host
            (if any) is sent in the needle.  For example, if the login string
            is "JSMITH:100.1,200.2,300.3", and if host 200 is selected as the
            destination, then the subhost sent in the needle will be "2".

   Case 3:  In cases other than the ones mentioned above, there is no subhost.

   However, if the Tymnet Numbering Plan is in effect, there is one more case,
   namely:

   Case 4:  The first destination field in the login string consists of an
            X.121 address whose NTN starts with the digit 0 or 8.  In this
            case, the seventh through tenth digits of the NTN (if present) are
            taken as the subhost.  That is, if the NTN is either 0hhhhhssss or
            8hhhhhssss, the digits ssss are interpreted as the subhost.












   ADRII GED                    Needle Information                          -66-








   10.5  Extension


   This is the extension from the login string, as described in section 5.4.4.




   10.6  Half-duplex flag


   This indicates that the requesting terminal is in half-duplex mode.  This
   flag is set if the user requested the half-duplex option in the option
   field of the login string.  For LOGII login requests, this option might
   also have been specified in a LOGII MO.  For LOGI login requests, this
   might have been specified by a control-H in the user field of the login
   string.




   10.7  IIX capable origination flag


   This flag indicates to the destination host that it should follow the IIX
   protocol.  The flag is sent in the needle if all of these conditions hold:

        (1) The circuit request message specified that the originating host can
            follow the IIX protocol.
        (2) The destination host is capable of using the IIX protocol.  (The
            Supervisor keeps track of which hosts report themselves as IIX
            hosts and which do not.)




   10.8  Internal circuit flag


   This flag is set if the requesting host and destination host are on the
   same base node.




   10.9  Invoice number


   This is a number which the Supervisor generates for accounting purposes.
   The number itself is not in any way derived from the login string or login
   process.






   ADRII GED                    Needle Information                          -67-








   10.10  IRC


   This is the International Record Carrier number which is specified in the
   MUD user entry.  Not all users have an IRC.




   10.11  Multiple targets flag


   This flag is set if login processing resulted in more than one prospective
   target host - that is, more than one host which was answered and had ports
   available.




   10.12  Needle node list


   This is the list of nodes in the path to be built.  The list is the result
   of the Supervisor path-finding algorithm which takes as input (among other
   things) the requesting node number, the prospective target hosts, the cost
   table to be used, and the IRC (if any).




   10.13  Reverse charge flag


   This indicates that the destination host is charged for the circuit.  The
   Supervisor sets this flag if (1) the reverse charge option was specified in
   the login request message, and (2) the destination host accepts reverse
   charge calls, as indicated by flags in the host table.  Note also that
   several APEs in the user or destination MUD entries may have been skipped
   if they did not have the reverse-charge-ok bit set.  In other words, the
   fact that the option was chosen might have affected the target selection.




   10.14  SDL (Specified destination list)


   This consists of all the destination fields in the login string (if any).
   These are passed in the needle exactly as they appear in the login string,
   except that

        (1) The high-order bit of each character has been set to 0.
        (2) All characters in a destination field preceding a ctrl-W are
            deleted, along with the ctrl-W itself.  In other words, the ctrl-W



   ADRII GED                    Needle Information                          -68-








            is interpreted as an "erase field" character.
        (3) The following characters are removed: null (hex 0), rubout (hex
            7F), all control characters (hex 01 through hex 1A), escape (hex
            1B), FS (hex 1C), GS (hex 1D), RS (hex 1E), US (hex 1F).
        (4) Lower case letters are translated to upper case.
        (5) In X.121 destination addresses, these characters are also removed:
            dash (except for the initial one), plus, minus, parentheses, and
            blank.
        (6) Any customized syntax, such as the special SWBT syntax described
            in the appendix, is translated to standard Tymnet format.

   However, if the user entry specifies the ignore-host option or that the
   username is transparent, then the destination fields of the login string
   are ignored completely.  That is, they are not used for target selection
   (the user is targeted to home hosts), and they are not passed in the SDL.
   In this case, the SDL will be null, just as though no destinations had been
   specified at all.




   10.15  Shut override flag


   This flag is set if the destination host is shut and the user has
   shut-override license.  The user has shut-override license if the user
   entry APE used for target selection has the shut-override bit set.

   Note: In the LOGI needle, the shut-override bit is set whenever the user
   has shut-override license - regardless of whether the destination host is
   shut.




   10.16  Target selection and qualification flags


   These flags provide information regarding target selection and
   qualification.  There are ten flags in total, and any or all of them are
   set whenever the corresponding condition is encountered.  The bits are
   interpreted as follows:

   Bit       Meaning
   ---       -----------------------------------------------------------------
    0        Redirection due to host down.
    1        Redirection due to host shut.
    2        Redirection due to no such host.
    3        Redirection due to no host ports.
    4        Redirection due to reverse charges barred.
    5        Redirection due to caller charges barred.
    6        Redirection due to origination-only host.
    7        Redirection due to no network path to host.
    8        Redirection due to systematic redirection.  (The first APE with a



   ADRII GED                    Needle Information                          -69-








             valid origin and valid flags had no intersection with the
             resultant target specification.)
    9        Multiple target hosts were considered during path-finding.




   10.17  Throughput class


   This is the throughput class specified in the login string option field.
   For LOGII requests, it might also have been specified by a LOGII MO.  For
   LOGI requests, it might have been specified by a control character in the
   user field.  If it is not set in either way, it defaults to a value which
   is a function of the CCT.




   10.18  Transparent login flag


   This flag is set if the corresponding transparent login flag is set in the
   MUD user entry.

   To the Supervisor, this flag means that any destination field in the login
   string is ignored - that is, not used for target selection nor sent in the
   SDL.  To the destination T-II gateway, this flag indicates that the
   username is also valid in the other network, and that the gateway should
   send it in a login request to that network's Supervisor.  Usernames which
   have the transparent bit set should only have T-II gateways specified as
   home hosts.  The result of passing this flag to another type of interface
   is undefined.




   10.19  Username


   The username passed in the needle is identical to the one in the login
   string, except that

        (1) The high-order bit of each character is set to 0.
        (2) All characters preceding a ctrl-W are deleted, along with the
            ctrl-W itself.  In other words, the ctrl-W is interpreted as an
            "erase field" character.
        (3) The following characters are removed: null (hex 0), rubout (hex
            7F), all control characters (hex 01 through hex 1A), escape (hex
            1B), FS (hex 1C), GS (hex 1D), RS (hex 1E), US (hex 1F).
        (4) Lower case letters are translated to upper case.
        (5) In X.121 usernames, these characters are also removed: dash
            (except for the initial one), plus, minus, parentheses, and blank.




   ADRII GED                    Needle Information                          -70-








   However, if no username is provided, the OADR (Origination Address) field
   from the login request is used instead.




   10.20  UUN


   This is the Universal User Name which is specified in the MUD user entry.















































   ADRII GED                    Needle Information                          -71-








   11.  ERROR LOG MESSAGES


   During login processing, the Supervisor may write various error messages to
   the Probe error log.  These serve to

        (1) Monitor the use of new features
        (2) Monitor Supervisor performance
        (3) Signal anomalies

   It is useful to monitor the use of new features in order to gauge how
   useful or marketable they are.  This might influence the direction of
   future designs.

   Supervisor performance is monitored in general, but it is of special
   importance with regard to login processing.  This is because logins using
   the new features, such as X.121 addressing, will probably be substantially
   more costly than current logins. and it is very hard to predict in advance
   what the impact will be.  Performance statistics will be used to insure
   that deployment of complex MUD entries does not get out-of-hand.  The
   information will also be useful for future enhancements to login
   processing.

   The logging of anomalies is clearly of great importance, especially while
   other interfaces are being upgraded to the LOGII, ADRII, and MUDII
   standards.  This will help flush out any discrepancies between the various
   interfaces that interact during a login.

   The list of possible error messages, and the format of each one, will be
   provided in the detail in the ADRII GID.



























   ADRII GED                    Error Log Messages                          -72-








   12.  TARGET PROFILES

   Target profile addressing is an ADRI addressing scheme which allows users
   to log into foreign networks by specifying their DNICs.  It also allows
   users to force their circuit through a specified transit network, if
   desired.  The syntax is "GxxxxTyyyy", where "xxxx" and "yyyy" both indicate
   four decimal digits.  "xxxx" is the DNIC of the destination network, and
   "yyyy" is the DNIC of the transit network (called the "TNIC" in this
   context).  The "Tyyyy" portion of the address is optional.

   For example, "JSMITH:G2222" would cause a circuit to be built to a gateway
   to network 2222.  "JSMITH:G2222T3333" would cause a circuit to be built to
   a gateway to network 3333, which would eventually route the circuit to
   network 2222.

   As far as Supervisor processing is concerned, the target and transit DNICs
   are simply used as an index into an internal table which provides lists of
   host numbers.  The DNIC 2222 alone might be used to index the list 2, 5,
   and 100.  These will presumably be gateways to network 2222, or else they
   will be gateways to networks which can eventually route to network 2222.
   The destination DNIC 2222 along with the transit DNIC 3333 might index an
   entirely different list of hosts.  It is the responsibility of the target
   profile administrator to insure that the proper lists of hosts are included
   in the table.

   One benefit of the ADRII project is that target profile addressing can be
   supported as part of the hostname facility.  These addresses, which
   formerly required a special table and special handling, can now be treated
   like other ordinary logins.  The address "GxxxxTyyyy" is simply interpreted
   by the ADRII Supervisor as a hostname, and the MUD entry associated with it
   specifies the appropriate target gateways.  This, in fact, allows a great
   deal more flexibility, since the MUD entries can route the circuit
   intelligently depending upon the user's origination.  MUD entries also
   provide greater security with regard to access restrictions.

   Target profile information must still be maintained, but this will be in
   the form of MUD entries corresponding to the various hostnames.  NETVAL
   provides a convenient means of updating the MUD, whereas currently there is
   no convenient way to maintain the target profile table.  The target profile
   information can therefore be updated in a much more timely manner than is
   currently possible.

   Two migration details should be noted.  First, all destination entries
   which represent target profiles, such as "G2222T3333", must have the "P"
   control bit set in the header portion of the entry.  (See the MUDII GED.)
   This tells the Supervisor to append the hostname to the username when
   sending a LOGI needle.  In this example, ":G2222T3333" would be appended to
   the username.  This is for backward compatibility only and will become
   obsolete when LOGI hosts and nodes disappear.

   Second, all user APEs which use the Universal Target Profile Access group
   must be changed.  Instead of specifying this group number, each APE must
   have the "P" bit set to indicate universal target profile access.  Note
   that this is different from the "P" bit in the header portion of the MUD



   ADRII GED                      Target Profiles                           -73-








   entry.  (See the MUDII GED.)  This bit serves the same function as the
   universal group number - namely to allow the user to log into any host
   specified by the target profile address.  If the bit is not set, then the
   user is targetted to those hosts which are specified both by the target
   profile and the user's APE (perhaps none).




















































   ADRII GED                      Target Profiles                           -74-








   13.  ADRI/ADRII INCOMPATIBILITY


   ADRII adds functionality by allowing new fields in the login string and new
   kinds of items in the existing fields.  However, the intention is to be
   backward compatible.  That is, any login string which was acceptable
   previously should still be acceptable with ADRII and have the same results.
   Unfortunately, there are the following minor differences:

        (1) The Supervisor sends the "access denied" response/reject messages
            only after receiving a password (assuming one is required).

        (2) The range of characters permitted in usernames has been slightly
            limited.  Although an attempt has been made to eliminate usernames
            with the newly-disallowed characters, there is always the
            possibility of some remaining.

        (3) Dashes in usernames are no longer ignored for aux-circuit
            requests.  Previously, "J-SMITH" and "JSMITH" would be treated
            identically in aux-circuit requests.

        (4) A control-W effectively deletes an entire field, not just to the
            last delimiter.  Previously, if a host/subhost was specified, any
            subsequent control-W would delete back to the period (which
            separates the host number from the subhost number).  With ADRII,
            the control-W deletes the entire destination field - in this case,
            both the host and subhost numbers.

        (5) A host number can no longer contain non-digits.  (Previously,
            "JSMITH:39" and "JSMITH:3A9B" would both specify host 39.)

        (6) A subhost number will be rejected if it contains more than four
            digits.  Previously, other digits would be allowed, but would be
            ignored.

        (7) Target profile designations can no longer contain extraneous
            characters.  Previously, "JSMITH:G12A34B" would target to the same
            hosts as "JSMITH:G1234".  With ADRII, the target profile
            designation would be taken as hostname "G12A34B" and would
            probably be unknown.

   The following differences appear only if the circuit request is made with a
   LOGII message:

        (8) An escape clears all user-specifiable options.  That is, if a
            Logon Session Reset MO is received in a message, the half-duplex,
            interactive/batch, reverse charge, and throughput class settings
            are returned to their default values.  Previously, these settings
            would not be cleared.  (Note: the interface can transparently
            resend any of these options, thereby making it look to the user as
            though the options were never cleared.)

        (9) The following characters will no longer be taken as indicating a
            reset condition: ASCII escape, the ASCII separater characters (hex



   ADRII GED                ADRI/ADRII Incompatibility                      -75-








            1C, 1D, 1E, and 1F), left curly brace ("{"), right curly brace
            ("}"), vertical bar ("|"), tilde ("~").  The first five of these
            characters (i.e., the non-printable ones) are ignored.  The
            remaining four characters (i.e., the printable ones) are treated
            as ordinary data.  (Note: the MUX currently uses the left brace as
            a terminator and expects the Supervisor to treat it as an escape.)



















































   ADRII GED                ADRI/ADRII Incompatibility                      -76-








   14.  EXTERNAL REQUIREMENTS

   The following is a list of requirements for the ADRII project.

        (1) The LOGII and MUDII projects must be completed.  Although
            ADRII-style login strings can be sent from LOGI nodes, the
            Supervisor must nevertheless be configured for both ADRII and
            LOGII.  ADRII routines in the Supervisor are dependent upon LOGII
            subroutines to translate between the LOGI/LOGII network messages
            and the internal data format.  ADRII routines also require MUDII
            routines to locate user and destination entries in the MUD.

        (2) As a consequence of requiring MUDII, ADRII requires that NETVAL be
            modified to make use of the new MUD format.  Also, NETVAL must
            provide a means of converting the existing MUD format into the new
            MUD format.  These requirements are spelled out in detail in the
            MUDII GED.

        (3) TMCS must be modified in order to be able to interpret the new
            Probe error log messages.

        (4) In order to support target profile addressing, entries must be
            added to the MUD which correspond to the target profile addresses.
            For example, if the address "G2222T3333" is currently valid, a MUD
            entry with the same name must be created.  All entries must be
            flagged as being target profile destination entries, and their
            access profiles must be compatible with the current target profile
            table.  Furthermore, all user entries which specify the Universal
            Target Profile Access group number (group 37) must be changed.
            See section 13 for a description of target profiles.

        (5) In order to support the new X.121 addressing, various MUD entries
            must be created and maintained.  For example, in order for the
            address "-3106(408)446-6000" to be valid, there must a
            corresponding entry in the MUD.  If, for example, the DNIC table
            specifies that only three digits of NTN are relevant for DNIC
            3106, then the corresponding MUD entry is "-3106408".  The
            numbering plan adopted by the network determines how these MUD
            entries (and the DNIC table) are defined.

        (6) Hosts can send ADRII-style login strings in the old LOGI message
            format.  Therefore, upgrading hosts or nodes to LOGII is not an
            absolute requirement for the ADRII project.  However, the Node
            Code and other interfaces will eventually be upgraded in order to
            benefit from the LOGII design itself, irrespective of ADRII.  To
            do this, the login dialogue protocol and new login string syntax
            specified in this document must be followed.










   ADRII GED                   External Requirements                        -77-








                                     APPENDIX

































































   A.  STATE DIAGRAMS


   A.1  State diagram for LOGII normal circuit requests






                                                +-------+
                                                |       |
                                                V       |
                                   +--------------+     |
                                   | STATE 1:     +-----+
                      +------------+ WAITING FOR  |
                      |            | INITIAL      |
                      |            | LOGIN STRING |<------------+
                      |            +----+---------+             |
                      |                 |   ^                   |
                      |                 |   |                   |
                      |                 |   |   +-------+       |
                      |                 |   |   |       |       |
                      |                 V   |   V       |       |
                      |            +--------+-----+     |       |
                      |            | STATE 2:     +-----+       |
                      |            | WAITING FOR  |             |
                      |            | LOGIN STRING |             |
                      |            +----+---------+             |
                      |                 |   ^                   |
                      |                 |   |                   |
                      |                 |   |   +-------+       |
                      |                 |   |   |       |       |
                      |                 V   |   V       |       |
                      |            +--------+-----+     |       |
                      |            | STATE 3:     +-----+       |
                      +----------->| WAITING FOR  |             |
                                   | PASSWORD     +-------------+
                                   +--------------+


















   ADRII GED                      State Diagrams                            -78-








   A.2  State diagram for LOGI normal circuit requests


                                                          +-------+
                                                          |       |
                                                          V       |
                                             +--------------+     |
            +--------------------------------+ STATE 1:     +-----+
            |                                | WAITING FOR  |
            |           +--------------------+ INITIAL      |
            |           |   +--------------->| LOGIN STRING |<------------+
            |           |   |                +----+---------+             |
            |           |   |                     |   ^                   |
            |           |   |                     |   |                   |
            |           |   |   +-------+         |   |   +-------+       |
            |           |   |   |       |         |   |   |       |       |
            |           V   |   V       |         V   |   V       |       |
            |      +--------+-----+     |    +--------+-----+     |       |
            |      | STATE 4:     +-----+    | STATE 2:     +-----+       |
            |      | WAITING FOR  |          | WAITING FOR  |             |
            |      | LOGIN ZAPPER |<---------+ LOGIN STRING |             |
            |      +--------------+          +----+---------+             |
            |             ^                       |   ^                   |
            |             |                       |   |                   |
            |             |                       |   |   +-------+       |
            |             |                       |   |   |       |       |
            |             |                       V   |   V       |       |
            |             |                  +--------+-----+     |       |
            |             +------------------+ STATE 3:     +-----+       |
            |                                | WAITING FOR  |             |
            +------------------------------->| PASSWORD     +-------------+
                                             +--------------+

























   ADRII GED                      State Diagrams                            -79-








   A.3  State diagram for LOGII aux-circuit requests




                                               +-------+
                                               |       |
                                               V       |
                                  +--------------+     |
                                  | STATE 1:     |     |
                                  | WAITING FOR  +-----+
                                  | INITIAL      |
                                  | REQUEST      |
                                  +--------------+




   A.4  State diagram for LOGI aux-circuit requests


                                               +-------+
                                               |       |
                                               V       |
                                  +--------------+     |
                                  | STATE 1:     |     |
                                  | WAITING FOR  +-----+
                                  | INITIAL      |
                                  | REQUEST      |
                                  +----+---------+
                                       |    ^
                                       |    |
                                       |    |
                                       V    |
                                  +---------+----+
                                  | STATE 2:     |
                                  | WAITING FOR  |
                                  | LOGIN STRING |
                                  +--------------+


















   ADRII GED                      State Diagrams                            -80-








   B.  LOGIN STRING SYNTAX


   LOGIN STRING:

   +--------+    +-------+    +-------------+    +-----------+    +----------+
   | OPTION |--->| USER  |--->| DESTINATION |--->| EXTENSION |--->| PASSWORD |
   | FIELD  |    | FIELD |    |    LIST     |    |   FIELD   |    |  FIELD   |
   +--------+    +-------+    +-------------+    +-----------+    +----------+


   OPTION FIELD:

   ---------------------------------------->
      \                                /
      |           +--------+           |
      \---> ( --->| OPTION |---> ) ----/
                  |  LIST  |
                  +--------+


   OPTION LIST:

   ---------------------------------->
      \                         /
      |        +--------+       |
      \------->| OPTION |-------/
          /    +--------+    \
          |                  |
          \-------- , <------/


   OPTION:

      +------+
   -->|LETTER|--------------------------------------------------------------->
      +------+  /                \   \                                     /
                |    +------+    |   |                 +------+            |
                \----|LETTER|<---/   \--> = ---------->|LETTER|------------/
                |    +------+    |            /   \    +------+    /   \
                |                |            |   |                |   |
                |    +------+    |            |   |    +------+    |   |
                \----|DIGIT |<---/            |   \--->|DIGIT |----/   |
                |    +------+    |            |   |    +------+    |   |
                |                |            |   |                |   |
                |    +------+    |            |   |    +------+    |   |
                \----|PUNCT |<---/            |   \--->|PUNCT |----/   |
                     +------+                 |        +------+        |
                                              |                        |
                                              \------------<-----------/







   ADRII GED                    Login String Syntax                         -81-








   USER FIELD:

   ------------------------------------>
      \                            /
      |    +------------------+    |
      \--->| REGULAR USERNAME |----/
      |    +------------------+    |
      |                            |
      |    +------------------+    |
      \--->|  X.121 USERNAME  |----/
           +------------------+


   REGULAR USERNAME (1 to 20 characters total):

           +--------+
   ------->| LETTER |----------------------------------->
      \    +--------+    /       /                  \
      |                  |       |    +--------+    |
      |    +--------+    |       \----| LETTER |<---/
      \--->| DIGIT  |----/       |    +--------+    |
      |    +--------+    |       |                  |
      |                  |       |    +--------+    |
      \------> * --------/       \----| DIGIT  |<---/
      |                  |       |    +--------+    |
      |                  |       |                  |
      \------> # --------/       |    +--------+    |
      |                  |       \----| PUNCT  |<---/
      |                  |            +--------+
      \------> $ --------/


   X.121 USERNAME:

                  +---------------+      +--------------+
   -----> - ----->| USERNAME DNIC |----->| USERNAME NTN |----->
                  +---------------+      +--------------+


   USERNAME DNIC or DESTINATION DNIC:

       +-------+    +-----+    +-----+    +-----+    +-----+    +-------+
   --->|IGNORES|--->|DIGIT|--->|DIGIT|--->|DIGIT|--->|DIGIT|--->|IGNORES|--->
       +-------+    +-----+    +-----+    +-----+    +-----+    +-------+


   USERNAME NTN or DESTINATION NTN (maximum of 10 digits):

             +---------+     +-------+
   --------->| IGNORES |---->| DIGIT |----------->
        /    +---------+     +-------+    \
        |                                 |
        |                                 |
        \----------------<----------------/



   ADRII GED                    Login String Syntax                         -82-








   IGNORES:

   ------------------------------>
      /                      \
      |    +-----------+     |
      \----|  IGNORES  |<----/
           | CHARACTER |
           +-----------+


   DESTINATION LIST (maximum of 2 destinations):

   -------------------------------------->
      /                              \
      |    +-------------+           |
      \----| DESTINATION |<--- : <---/
           +-------------+


   DESTINATION:

           +-------------------+
   ------->| ACTIVE SUPERVISOR |-------->
      \    +-------------------+    /
      |                             |
      |    +-------------------+    |
      \--->|     HOST LIST     |----/
      |    +-------------------+    |
      |                             |
      |    +-------------------+    |
      \--->|     HOSTNAME      |----/
      |    +-------------------+    |
      |                             |
      |    +-------------------+    |
      \--->|    KERNEL HOST    |----/
      |    +-------------------+    |
      |                             |
      |    +-------------------+    |
      \--->| X.121 DESTINATION |----/
           +-------------------+


   ACTIVE SUPERVISOR:

   -----> * ----->












   ADRII GED                    Login String Syntax                         -83-








   HOST LIST:

                +------+
   ------------>| HOST |------------------------------------------->
      \    /    +------+   \                          /   \    /
      |    |               |           +---------+    |   |    |
      |    |               \---> . --->| SUBHOST |----/   |    |
      |    |                           +---------+        |    |
      |    |                                              |    |
      |    \----------------- , <-------------------------/    |
      |                                                        |
      |                      +---------+                       |
      \--------------> . --->| SUBHOST |-----------------------/
                             +---------+


   HOST (maximum of 5 digits):

            +-------+
   ---------| DIGIT |--------->
      /     +-------+     \
      |                   |
      \---------<---------/


   SUBHOST (maximum of 4 digits):

            +-------+
   ---------| DIGIT |--------->
      /     +-------+     \
      |                   |
      \---------<---------/


   HOSTNAME (maximum of 20 characters total):

        +------+
   ---->|LETTER|------------------------->
        +------+   /                \
                   |    +------+    |
                   \----|LETTER|<---/
                   |    +------+    |
                   |                |
                   |    +------+    |
                   \----|DIGIT |<---/
                   |    +------+    |
                   |                |
                   |    +------+    |
                   \----|PUNCT |<---/
                        +------+







   ADRII GED                    Login String Syntax                         -84-








   KERNEL HOST:

                 +-------------+
   -----> % ---->| NODE NUMBER |----->
                 +-------------+


   NODE NUMBER (maximum of 5 octal digits):

            +-------+
   ---------| OCTAL |--------->
      /     | DIGIT |     \
      |     +-------+     |
      |                   |
      \---------<---------/


   X.121 DESTINATION:

                        +-------------+    +-------------+
   -------------> - --->| DESTINATION |--->| DESTINATION |--------->
            \           |    DNIC     |    |     NTN     |    /
            |           +-------------+    +-------------+    |
            |                                                 |
            |           +-------------+    +-------------+    |
     SWBT   \---> 1 --->| DESTINATION |--->| DESTINATION |----/
     ONLY   |           |    DNIC     |    |     NTN     |    |
            |           +-------------+    +-------------+    |
            |                                                 |
     SWBT   |           +-------------+                       |
     ONLY   \---------->|  LOCAL NTN  |-----------------------/
                        +-------------+


   LOCAL NTN (from 6 to 10 digits):

          +-------------+
   ------>|DIGIT GREATER|----------------------------------------->
          |  THAN ONE   |    /                                \
          +-------------+    |    +-------+     +-------+     |
                             \----| DIGIT |<----|IGNORES|<----/
                                  +-------+     +-------+


   EXTENSION FIELD:

   ------------------------------------------->
      \                                   /
      |           +-----------+           |
      \---> [ --->| EXTENSION |---> ] ----/
                  +-----------+






   ADRII GED                    Login String Syntax                         -85-








   EXTENSION:

   ------------------------------>
      /                      \
      |    +-----------+     |
      \----| EXTENSION |<----/
           | CHARACTER |
           +-----------+


   PASSWORD FIELD:

   --------------------------------------->
       \                           /
       |           +----------+    |
       \---> ; --->| PASSWORD |----/
                   +----------+


   PASSWORD:

   -------------------------------->
        /                      \
        |    +-----------+     |
        \----| PASSWORD  |<----/
             | CHARACTER |
             +-----------+


   EXTENSION CHARACTER:

   All characters except right square bracket ("]").


   PASSWORD CHARACTER:

   Any character is allowed.


   LETTER:

   Any upper or lower case letter.


   DIGIT:

   Any decimal digit from 0 to 9.


   DIGIT GREATER THAN ONE:

   Any decimal digit from 2 to 9.





   ADRII GED                    Login String Syntax                         -86-








   OCTAL DIGIT:

   Any digit from 0 to 7.


   PUNCT:

   Any of the following: # $ * & . - /


   IGNORES CHARACTER:

   Space character, or any of the following: + - ( )












































   ADRII GED                    Login String Syntax                         -87-








   C.  SWBT ADDRESSING


   If the Supervisor Tymfile indicates SWBT special addressing, then the login
   string syntax is extended to handle X.121 addresses in a slightly different
   format.  This applies only to X.121 addresses in the destination list.

   First of all, the digit "1" is allowed to prefix an X.121 address instead
   of a dash.  Whenever the Supervisor encounters this in the login string, it
   proceeds exactly as if it had encountered a dash instead of the "1".  This
   means that all data passed in the needle will be translated into standard
   format - i.e., with a dash.  There is one complication, however.  The X.121
   address must have at least five digits following the initial "1".
   Otherwise, the Supervisor would interpret it as an ordinary host number.

   Second, if the user specifies between six and ten decimal digits in a
   destination field and does not prefix this with a dash or a "1", the digits
   are interpreted as a local NTN.  The Supervisor translates this into a full
   X.121 destination address and then continues as if it had received the full
   address in the first place.  It is this full address which is passed to the
   destination host in the needle.

   In order to create the full address from the local NTN, the Supervisor
   extracts the DNIC specified in the Origination Address MO.  The resulting
   full address consists of a dash, followed by the DNIC from the Origination
   Address, followed by the local NTN.  However, if the Origination Address
   was not given, or if it was not in the Tymnet X.121 format, then the
   default DNIC for the network is used to create the full address.





























   ADRII GED                      SWBT Addressing                           -88-


@r