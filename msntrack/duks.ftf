CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
*       (MSNTRACK:28)DUKS.FTF (formerly KS.FTF) R.ROSKILLY MAR '84

*       GETS KS XRAY COMMAND OUTPUT FROM AUX CIRCUIT AND APPENDS TO
*       DUKS.DAT FILE. THIS DATA IS LATER LOADED INTO X22 DATA BASE BY
*       ANOTHER PROGRAM.

*       CALLED FROM DUBAK (formerly NTRBAK)

C Revised by:		Jason Ma
C Revision date:	2-7-86
C Revision purpose:	To rename the I/O files to DU####.* (for
C			"Delay/Utilization").  The old and new files
C			are as follows:
C
C				OLD		NEW
C				---		---
C				KS		DUKS
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC

*       SUBROUTINE COMPILER ENTRY POINT         *******************************

        SUBROUTINE DUKS (NODE,NEIGH,TDATE,TTIME)

*       AUX PORT NUMBER
        INTEGER PORT

*       OUTPUT FILE CURSOR POSITION
        INTEGER MTRPOS

*       COMMON STORAGE DECLARATIONS

        COMMON /AUX/ PORT
        COMMON /OUTPOS/ MTRPOS

*       LOCAL STORAGE DECLARATIONS

*       DATE AND TIME (AS HHMM)
        INTEGER TDATE,TTIME

*       NODE NUMBER BEING PROCESSED
        INTEGER NODE

*       XRAY COMMAND STRING FOR 'KS' TO BE SENT ON AUX CIRCUIT
        INTEGER KSCMND (13)

*       CHARACTER WHICH SIGNALS END OF XRAY OUTPUT
        DATA PROMPT /62/

*       KS DATA OUTPUT FILE FOR NEXT WRITE (APPEND)
        INTEGER KSPOS

*       SUBROUTINE EXECUTION ENTRY POINT        *******************************

*       OPEN KS COMMAND OUTPUT FILE

        OPEN (30,'(MSNTRACK)DUKS.DAT',RANDOUT(82))

*       SET UP 'KS' COMMAND IN KSCMND WORD
*       THE 0 MEANS NO NEIGH NUMBER IS SENT, JUST THE COMMAND ITSELF

        CALL AXBCOM ('KS   ',NEIGH,KSCMND)

*       SEND 'KS' COMMAND TO XRAY

        CALL SEND (KSCMND)

*       GET SIZE OF FILE AND ADD 1 FOR NEXT WRITE

        KSPOS=SIZE(30)+1

*       WRITE HEADER TO OUTPUT FILE FIRST TO IDENTIFY XRAY INFORMATION
*       INCLUDE NODE, DATE, AND TIME AS HHMM

        WRITE (30#KSPOS,100) NODE,TDATE,TTIME
100     FORMAT (/,1X,'XRAY ID: KS ',I5,1X,I6,1X,I4)

*       ADVANCE OUTPUT FILE CURSOR POSITION TO END OF FILE

        KSPOS=SIZE(30)+1

*       WRITE XRAY OUTPUT TO KS OUTPUT FILE

        CALL XRFOUT (PROMPT,30,KSPOS)

*       ADVANCE OUTPUT CURSOR POSITION TO END OF FILE

        KSPOS=SIZE(30)+1

*       WRITE OUT END OF XRAY SESSION FLAG

        WRITE (30#KSPOS,200)
200     FORMAT (/,1X,'XRAY END FLAG')

*       CLOSE OUTPUT FILE

        CLOSE (30)

*       RETURN TO MAIN PROGRAM

        RETURN

*       END OF SUBROUTINE

        END
