C**********************************************************************
C                                                                     C
C       THIS FILE CONTAINS TWO SUBROUTINES USED IN OBTAINING A        C
C       SAMPLE FROM A NETSTAT DATA BASE.                              C
C                                                                     C
C**********************************************************************




CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C                                                                     C
C       SUBROUTINE: SAMPLE                                            C
C       AUTHOR: JO ANN JOELS, MANAGEMENT SCIENCES                     C
C       CREATED: FEBRUARY, 1983                                       C
C       LAST UPDATED:                                                 C
C       UPDATED BY:                                                   C
C       TABS: 9,12,15,18,60,71                                        C
C                                                                     C
C       THIS SUBROUTINE TAKES A SAMPLE (1 OUR OF N SESSIONS) FROM A   C
C       DAILY NETSTAT FILE (1022 DATA BASE).  THE SAMPLE IS FURTHER   C
C       REFINED BY MAKING SURE EACH NTH RECORD FALLS WITHIN A SPEC-   C
C       IFIED TIME PERIOD.  IF THE SESSION STARTS OR ENDS WITHIN      C
C       THE TIME PERIOD THE SESSION IS SELECTED. THE SAMPLE IS OUTPUT  C
C       TO A SYMBOLIC FILE.                                           C
C                                                                     C
C       FORMAT:                                                       C
C          CALL SAMPLE(OUTDEV,SHOUR,EHOUR,N,SELECT,ERROR)             C
C                                                                     C
C       ARGUMENTS:                                                    C
C          OUTDEV  INTEGER VARIABLE CONTAINING THE OUTPUT DEVICE      C
C                   NUMBER.  THE OUTPUT FILE MUST ALREADY BE OPENED   C
C                   WHEN THIS ROUTINE IS CALLED.                      C
C          SHOUR  - INTEGER VARIABLE CONTAINING THE START TIME OF THE C
C                   TIME PERIOD OVER WHICH THE SAMPLE IS TO BE TAKEN  C
C          EHOUR  - INTEGER VARIABLE CONTAINING TEH END TIME OF THE   C
C                   TIME PERIOD OVER WHICH THE SAMPLE IS TO BE TAKEN  C
C          N      - INTEGER VARIABLE CONTAINING THE SAMPLING RATE     C
C          SELECT - INTEGER VARIABLE RETURNING THE NUMBER OF SESSIONS C
C                   SELECTED FOR THIS SAMPLE                          C
C          ERROR  - INTEGER VARIABLE RETURNING ANY ERROR CONDITIONS   C
C                   0 = NO ERROR                                      C
C                   1 = ERROR WHILE WRITTING TO OUTPUT FILE           C
C                                                                     C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC


        SUBROUTINE SAMPLE(OUTDEV,SHOUR,EHOUR,N,SELECT,ERROR)

C*****
C DECLARE ALL VARIABLES
C*****

        INTEGER OUTDEV,SHOUR,EHOUR,N,SELECT,ERROR,ARRAY(36),RCNT

C       C*****
C       C VARIABLE DEFINITIONS
C       C --------------------
C       C
C       C ARRAY  - A 36 WORD ARRAY USED TO GET ALL ATTRIBUTE VALUES
C       C          FOR THE CURRENTLY SELECTED SESSION
C       C          ARRAY(1) = SESSNO
C       C          ARRAY(2) = ORIGNODE
C       C          ARRAY(3) = ORIGPORT
C       C          ARRAY(4) = TERMID
C       C          ARRAY(5) = TERMNODE
C       C          ARRAY(6) = TERMPORT
C       C          ARRAY(7) = TERMHOST
C       C          ARRAY(8) = HOSTPORT
C       C          ARRAY(9) = STARTDATE
C       C          ARRAY(10) = STARTTIME
C       C          ARRAY(11) = INPUTCHAR
C       C          ARRAY(12) = OUTPUTCHAR
C       C          ARRAY(13) = TOTALCHAR
C       C          ARRAY(14) = ENDDATE
C       C          ARRAY(15) = ENDTIME
C       C          ARRAY(16) = TOTMIN
C       C          ARRAY(17) = DISCTYPE
C       C          ARRAY(18) = IRC
C       C          ARRAY(19) = UUN
C       C          ARRAY(20) - ARRAY (24) = USRNAM
C       C          ARRAY(25) = ORIGHOST
C       C          ARRAY(26) = ORIGPHYPORT
C       C          ARRAY(27) = HIGHDTE
C       C          ARRAY(28) = LOWDTE
C       C          ARRAY(29) = PAYFLAG
C       C          ARRAY(30) = ACCFLAG
C       C          ARRAY(31) = DNIC
C       C          ARRAY(32) = STIMESEC
C       C          ARRAY(33) = ETIMESEC
C       C          ARRAY(34) = ERRTYP
C       C          ARRAY(35) = MPVCSESS
C       C          ARRAY(36) = OUTDIAL
C       C
C       C IERR2  - ERROR FLAG USED TO RETURN ERROR CONDITIONS FROM THE
C       C          SAMPLE OUTPUT (SOUT) SUBROUTINE
C       C RCNT   - RECORD COUNTER. USED TO TELL 1022 WHICH RECORD TO
C       C          SELECT FROM WORKSPACE.
C       C*****

C*****
C INITIALIZE RECORD COUNTER TO THE FIRST RECORD TO SELECT FROM THE
C 1022 WORKSPACE
C*****

        RCNT=N

C*****
C INITIALIZE THE ERROR FLAG TO NO ERRORS, AND THE NUMBER OF RECORDS
C SELECTED TO ZERO
C*****

        ERROR=0
        SELECT=0

C*****
C SELECT A RECORD FROM THE WORKSPACE
C*****

100     CALL DBGET(ARRAY,$200,RCNT)

C*****
C IF THE SESSION STARTED OR ENDED DURING THE SPECIFIED TIME PERIOD
C SELECT THE SESSION
C*****

C       C*****
C       C BEFORE COMPARING THE TIMES, MUST MAKE SURE SESSION STERTED
C       C AND ENDED ON THE SAME DAY.  IF THEY DIDN'T SET THE START TIME
C       C OF THE SESSION TO FIRST MINUTE OF THE DAY (0).
C       C*****

105        IF (ARRAY(9).LT.ARRAY(14)) ARRAY(10)=0

C       C*****
C       C NOW CK IF SESSIONS FALLS INTO TIME PERIOD
C       C*****

110        IF ( (ARRAY(10).GE.SHOUR. AND .ARRAY(10).LE.EHOUR) .OR.
     +       (ARRAY(15).GE.SHOUR. AND .ARRAY(15).LE.EHOUR) ) GO TO 115

C       C*****
C       C NOT IN TIME PERIOD. DON'T SELECT THIS SESSION, TRY NEXT ONE
C       C*****

           GO TO  160

C*****
C IF THE DISCONNECT TYPE = 3 SET NUMBER OF ABNORMAL DISCONNECTS TO 1.
C USE THE 'DISCTYPE' ELEMENT OF 'ARRAY' TO PASS THE NUMBER OF ABNORMAL
C DISCONNECTS TO THE SOUT ROUTINE.
C*****

115     IF (ARRAY(17).EQ.3) ARRAY(17)=1
        IF (ARRAY(17).NE.3) ARRAY(17)=0

C*****
C OUTPUT THE INFORMATION ON THIS SESSION TO THE OUTPUT FILE
C*****

120     CALL SOUT(OUTDEV,ARRAY,IERR2)

C       C*****
C       C IF THERE WERE NO ERRORS RETURNED FROM THE SOUT 
C       C ROUTINE, CONTINUE
C       C*****

125        IF (IERR2.EQ.0) GO TO 150

C       C*****
C       C ERROR IN WRITTING TO OUTPUT FILE. SET ERROR FLAG
C       C*****

130        ERROR=1
           GO TO 200

C*****
C INCREMENT NUMBER OF RECORDS SELECTED BY 1
C*****

150     SELECT=SELECT+1

C*****
C INCREMENT RECORD COUNTER TO GET NEXT NTH RECORD
C*****

160     RCNT=RCNT+N

C*****
C GO GET NEXT RECORD
C*****

        GO TO 100

C*****
C FINISHED. REACHED END-OF-WORKSPACE IN 1022. RETURN TO CALLING 
C PROGRAM
C*****

200     RETURN
        END


CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C                                                                     C
C       SUBROUTINE: SOUT                                              C
C       AUTHOR: JO ANN JOELS,MANAGEMENT SCIENCES                      C
C       CREATED: FEBRUARY, 1983                                       C
C       LAST UPDATED:                                                 C
C       UPDATE BY:                                                    C
C       TABS: 9,12,15,18,60,71                                        C
C                                                                     C
C       THIS SUBOUTINE MUST BE USED IN CONJUNCTION WITH THE SAMPLE    C
C       SUBROUTINE.  IT OUTPUTS SELECTED INFORMATION FROM THE ARRAY   C
C       PASSED TO IT FROM THE SAMPLE SUBROUTINE.                      C
C                                                                     C
C       FORMAT:                                                       C
C          CALL SOUT(OUTDEV,ARRAY,IERR2)                              C
C                                                                     C
C       ARGUMENTS:                                                    C
C          OUTDEV - INTEGER VARIABLE CONTAINING OUTPUT DEVICE NUMBER  C
C          ARRAY  - 34 WORD ARRAY CONTAINING NETSTAT INFORMATION      C
C          IERR2  - INTERGER VARIABLE USED TO RETURN ERROR CONDITIONS C
C                   0 = NO ERRORS                                     C
C                   1 = ERROR WHILE WRITTING TO OUTPUT FILE           C
C                                                                     C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC

        SUBROUTINE SOUT(OUTDEV,ARRAY,IERR2)

C*****C
C DECLARE VARIABLES
C*****

        INTEGER OUTDEV,ARRAY(36),IERR2

C*****
C INITIALIZE ERROR FLAG TO NO ERRORS
C*****

        IERR2=0

C*****
C SET NUMBER OF SESSIONS TO 1
C*****

        NSESS=1

C*****
C OUTPUT THE NETSTAT INFORMATION NEEDED FOR THE OTIO FORMAT.
C ATTRIBUTES NEEDED ARE: ORIGNODE, TERMHOST, INPUTCHAR,OUTPUTCHAR,
C TOTMIN, NUMBER OF SESSIONS, NUMBER OF ABNORMAL DISCONNECTS
C*****

        WRITE (OUTDEV,100)ARRAY(2),ARRAY(7),ARRAY(11),ARRAY(12),
     +  ARRAY(16),NSESS,ARRAY(17)
100     FORMAT (I5,I5,5I10)

C*****
C FINISHED WITH THIS SESSION. RETURN TO CALLING PROGRAM
C*****
        RETURN
        END

    