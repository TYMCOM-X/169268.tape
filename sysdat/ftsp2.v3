C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C                                                                       C
C       PROGRAM: FTSP1 - PTS PART 2                                     C
C       AUTHOR: JO ANN JOELS                                            C
C       VERSION 1.0                                                     C
C       CREATED: APRIL, 1987                                            C
C       LAST UPDATED:                                                    C
C       LAST UPDATED BY:                                                 C
C                                                                        C
C       THIS PROGRAM IS PART 2 OF THE EFFORT TO DETERMINE THE PORTS      C
C       REQUIREMENTS FOR THE FTS2000 BID.                                C
C                                                                        C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC

        INTEGER CLATA,FTSNAM(2),FTSDAT(2),FTSOUT(2),IDATE(2),END,FREC,
     +  NLATA,TOTREC,
     +  PORTS(254),CITY(4),STATE,TELNO,APORTS,BPORTS,XPORTS,
     +  SPORTS,P2780P,CCITY(4),CSTATE,CLATA,CTELNO,CNPA,CNXX,
     +  NPA,NXX,NSITE,FTSDMS(2),SITE

        REAL MDIAL,M4800,M9600,M56,ERLANG(254),AHRS,BHRS,XHRS,SHRS,
     +  P2780H

        CALL DBSTRT(1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0)
        DO 90 I = 1,4
        CCITY(I)=' '
90      CONTINUE
        CSTATE=' '
        NSITE=0
        END=0
        FREC=0

100     TYPE 110
110     FORMAT (1X,'FTS2000 PROGRAM - PART 2')
115     CALL DATE(IDATE)
120     TYPE 125,IDATE
125     FORMAT (1X,2A5)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC


CCCCC
C GET FTS FILE NAME FROM USER
CCCCC
150     TYPE 160
160     FORMAT (//,1X,'ENTER FTS FILE NAME: ',$)
        ACCEPT 165,FTSNAM
165     FORMAT (2A5)

CCCCC
C BUILD FILE NAMES
CCCCC

170     ENCODE(9,175,FTSOUT)(FTSNAM(I),I=1,2)
175     FORMAT (A5,A1,'.O3')
        ENCODE(9,180,FTSDMS)(FTSNAM(I),I=1,2)
180     FORMAT (A5,A1,'.P2')


CCCCC
C READ THE ERLANG P-GRADE 1 FILE
CCCCC
200     OPEN(21,'ERLANG.PO1',INPUT)
210     DO 220 I=1,254
        READ (21,215)PORTS(I),ERLANG(I)
215     FORMAT (I9,1X,F10.2)
220     CONTINUE
        CLOSE(21)

CCCCC
C OPEN THE OUTPUT FILE
CCCCC
250     OPEN(21,FTSOUT,OUTPUT)

CCCCC
C OPEN THE FTS DATA BASE
CCCCC
        CALL DBOPEN(FTSDMS)

CCCCC
C FIND ALL OF THE RECORDS AND SORT BY STATE AND CITY
CCCCC
        CALL DBFIND('ALL')
        CALL DBEXEC('SORT STATE CITY')

CCCCC
C LOOP THROUGH THE RECORDS ONE BY ONE
CCCCC
400     CALL DBGREC($950)
        CALL DBVAL('LATA',CLATA,'MDIAL',MDIAL,'M4800',
     +  M4800,'M9600',M9600,'M56',M56,'CITY',CCITY,'STATE',CSTATE,
     +  'SITE',SITE)

C LOOK UP THE NUMBER OF PORTS
C NEEDED FOR THE DIAL-UP PROTOCOLS.
C
460     CALL DIAL(MDIAL,PORTS,ERLANG,AHRS,APORTS,BHRS,BPORTS,XHRS,
     +  XPORTS,SHRS,SPORTS,P2780H,P2780P)

CCCCC
C WRITE DATA FOR THIS CATEGORY TO OUTPUT FILE
CCCCC
        WRITE(21,465)CLATA,SITE,CCITY,CSTATE,AHRS,APORTS
465     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DIAL-UP ASYNC ',     
     +  14X,F8.4,2X,I3)
        WRITE (21,466)CLATA,SITE,CCITY,CSTATE,BHRS,BPORTS
466     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DIAL-UP 3270 ',
     +  'BYSYNC  ',7X,F8.4,2X,I3)
        WRITE (21,467)CLATA,SITE,CCITY,CSTATE,XHRS,XPORTS
467     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DIAL-UP X.25 ',
     +  15X,F8.4,2X,I3)
        WRITE (21,468)CLATA,SITE,CCITY,CSTATE,SHRS,SPORTS
468     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DIAL-UP SNA',
     +  'SDLC    ',9X,F8.4,2X,I3)
        WRITE (21,469)CLATA,SITE,CCITY,CSTATE,P2780H,P2780P
469     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DIAL-UP 2780',
     +  '/3780   ',8X,F8.4,2X,I3)

CCCCC
C DO THE CALCULATIONS FOR THE 4800 CATEGORIES
CCCCC
470     CALL NDIAL(M4800,AHRS,APORTS,BHRS,BPORTS,XHRS,XPORTS,
     +  SHRS,SPORTS,P2780H,P2780P)

CCCCC
C WRITE DATA FOR THIS CATEGORY TO OUTPUT FILE
CCCCC
        WRITE(21,471)CLATA,SITE,CCITY,CSTATE,AHRS,APORTS
471     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 4800 ',
     + 'ASYNC      ',2X,F8.4,2X,I3)
        WRITE (21,472)CLATA,SITE,CCITY,CSTATE,BHRS,BPORTS
472     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 4800 ',
     +  '3270 BYSYNC',2X,F8.4,2X,I3)
        WRITE (21,473)CLATA,SITE,CCITY,CSTATE,XHRS,XPORTS
473     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 4800 ',
     +  'X.25       ',2X,F8.4,2X,I3)
        WRITE (21,474)CLATA,SITE,CCITY,CSTATE,SHRS,SPORTS
474     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 4800 ',
     +  'SNA/SDLC   ',2X,F8.4,2X,I3)
        WRITE (21,475)CLATA,SITE,CCITY,CSTATE,P2780H,P2780P
475     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 4800 ',
     +  '2780/3780  ',2X,F8.4,2X,I3)

CCCCC
C DO THE CALCULATIONS FOR THE 9600 CATEGORIES
CCCCC
480     CALL NDIAL(M9600,AHRS,APORTS,BHRS,BPORTS,XHRS,XPORTS,
     +  SHRS,SPORTS,P2780H,P2780P)

CCCCC
C WRITE DATA FOR THIS CATEGORY TO OUTPUT FILE
CCCCC
        WRITE(21,481)CLATA,SITE,CCITY,CSTATE,AHRS,APORTS
481     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 9600 ',
     +  'ASYNC      ',2X,F8.4,2X,I3)
        WRITE (21,482)CLATA,SITE,CCITY,CSTATE,BHRS,BPORTS
482     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 9600 ',
     +  '3270 BYSYNC',2X,F8.4,2X,I3)
        WRITE (21,483)CLATA,SITE,CCITY,CSTATE,XHRS,XPORTS
483     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 9600 ',
     +  'X.25',9X,F8.4,2X,I3)
        WRITE (21,484)CLATA,SITE,CCITY,CSTATE,SHRS,SPORTS
484     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 9600 ',
     +  'SNA/SDLC   ',2X,F8.4,2X,I3)
        WRITE (21,485)CLATA,SITE,CCITY,CSTATE,P2780H,P2780P
485     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 9600 ',
     +  '2780/3780  ',2X,F8.4,2X,I3)


CCCCC
C DO THE CALCULATIONS FOR THE 56KB CATEGORIES
CCCCC
490     CALL NDIAL(M56,AHRS,APORTS,BHRS,BPORTS,XHRS,XPORTS,
     +  SHRS,SPORTS,P2780H,P2780P)

CCCCC
C WRITE DATA FOR THIS CATEGORY TO OUTPUT FILE
CCCCC
        WRITE(21,491)CLATA,SITE,CCITY,CSTATE,AHRS,APORTS
491     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 56KB',
     +  ' ASYNC ',7X,F8.4,2X,I3)
        WRITE (21,492)CLATA,SITE,CCITY,CSTATE,BHRS,BPORTS
492     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 56KB ',
     +  '3270 BYSYNC',2X,F8.4,2X,I3)
        WRITE (21,493)CLATA,SITE,CCITY,CSTATE,XHRS,XPORTS
493     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 56KB ',
     +  'X.25       ',2X,F8.4,2X,I3)
        WRITE (21,494)CLATA,SITE,CCITY,CSTATE,SHRS,SPORTS
494     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 56KB ',
     +  'SNA/SDLC   ',2X,F8.4,2X,I3)
        WRITE (21,495)CLATA,SITE,CCITY,CSTATE,P2780H,P2780P
495     FORMAT (I6,1X,I4,1X,3A5,A3,1X,A2,1X,'DEDICATED 56KB ',
     +  '2780/3780  ',2X,F8.4,2X,I3)


CGO GET ANOTHER RECORD
C
        NSITE=NSITE+1
        GOTO 400
C
C
C BRANCH TO HERE ON END OF RECORDS
C
900     END=1
        GOTO 460
C BRANCH TO HERE AFTER FINISHED WRITTING OUT THE LAST LATA INFO
950     CLOSE(21)
        TYPE 955,NSITE
955     FORMAT (///,1X,'NUMBER OF SITES PROCESSED = ',I3)
9999    CALL DBEND

        END

CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C SUBROUTINE: DIAL
C
C THIS SUBROUTINE LOOKS UP THE NUMBER OF PORTS NEEDED FOR A P-GRADE
C OF ONE GIVEN A NUMBER OF ERLANG MINUTES.  THE ERLANG HRS ARE HALVED
C BECAUES OF THE FTS REQUIREMENT REGARDING THE AMOUNT OF TRAFFIC THAT
C WILL ACCESS THE NETWORK THROUGH ASYNC PROTCOLS VERSUS
C OTHER TYPES OF PROTOCOLS.
CCCCC

        SUBROUTINE DIAL(MINS,PORTS,ERLANG,AHRS,APORTS,BHRS,BPORTS,
     +  XHRS,XPORTS,SHRS,SPORTS,P2780H,P2780P)

        INTEGER PORTS(254),APORTS,BPORTS,XPORTS,SPORTS,P2780P
        REAL EHRS,AHRS,BHRS,XHRS,SHRS,P2780H,ASYNC,BYSYNC,X25,SNA,
     +  P2780,ERLANG(254),MINS

        ASYNC=.5
        BYSYNC=.15
        X25=.15
        SNA=.175
        P2780=.025


100     EHRS=MINS/60.
        AHRS=EHRS*ASYNC
        CALL TABLE(AHRS,PORTS,ERLANG,APORTS)

        BHRS=EHRS*BYSYNC
        CALL TABLE(BHRS,PORTS,ERLANG,BPORTS)

        XHRS=EHRS*X25
        CALL TABLE(XHRS,PORTS,ERLANG,XPORTS)

        SHRS=EHRS*SNA
        CALL TABLE(SHRS,PORTS,ERLANG,SPORTS)

        P2780H=EHRS*P2780
        CALL TABLE(P2780H,PORTS,ERLANG,P2780P)

        RETURN
        END


CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C SUBROUTINE: TABLE
C
C THIS SUBROUTINE LOOKS UP A SPECIFIED NUMBER OF ERLANG HRS IN A P-GRADE
C TABLE AND RETURNS THE NUMBER OF PORTS REQUIRED TO SUPPORT THIS NUMBER
C OF HRS AT A P-GRADE OF 1.
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC

        SUBROUTINE TABLE(HRS,PORTS,ERLANG,NPORTS)

        INTEGER PORTS(254),NPORTS
        REAL HRS,ERLANG(254)


        DO 110 I=1,254
        IF (ERLANG(I).GE.HRS) GOTO 200
110     CONTINUE

200     NPORTS=PORTS(I)

        RETURN
        END

        SUBROUTINE NDIAL(MINS,AHRS,APORTS,BHRS,BPORTS,XHRS,XPORTS,SHRS,
     +  SPORTS,P2780H,P2780P)

        INTEGER APORTS,BPORTS,XPORTS,SPORTS,P2780P
        REAL SESS,AHRS,BHRS,XHRS,SHRS,P2780H,ASYNC,BYSYNC,X25,SNA,
     +  P2780,MINS

        ASYNC=.5
        BYSYNC=.15
        X25=.15
        SNA=.175
        P2780=.025

100     SESS=MINS/60.

        AHRS=SESS*ASYNC
        CALL RNDUP(AHRS,APORTS)

        BHRS=SESS*BYSYNC
        CALL RNDUP(BHRS,BPORTS)

        XHRS=SESS*X25
        CALL RNDUP(XHRS,XPORTS)

        SHRS=SESS*SNA
        CALL RNDUP(SHRS,SPORTS)

        P2780H=SESS*P2780
        CALL RNDUP(P2780H,P2780P)

        RETURN
        END

CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C SUBROUTINE RNDUP
C
C THIS SUBROUTINE TAKES A REAL NUMBER AND ROUNDS IT UP TO THE NEXT 
C HIGHEST INTEGER NUMBER
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC

        SUBROUTINE RNDUP(FNUM,INUM)

        INTEGER INUM
        REAL FNUM,XNUM,XD

100     INUM=FNUM
        XNUM=INUM
        XD=FNUM-INUM
        IF(XD.GT.0) INUM=INUM+1
        RETURN
        END
   