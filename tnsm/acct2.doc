      Accounting Addenda                                     February 4, 1986






                              5 -  Accounting Addenda


           Accounting Addenda  messages are used  to pass  certain additional
      data to  the supervisor, for  inclusion in the  accounting information.
      In  order  to  permit  the  definition  of  an  orderly  structure, for
      transmitting these data, the following convention is used:

         --.-.-.-.-.-.-.-:-.-.-.-.-.-.-.-:-.-.-.-.-.-.-.-:-.-.-.-.-.-.-.--
         |  14   | stype |                value                          |
         -----------------------------------------------------------------


           STYPE (sub-type) currently may have the values:


         0   This has the 24-bit value divided into "msg" and  16-bit values,
             of format:

         --.-.-.-.-.-.-.-:-.-.-.-.-.-.-.-:-.-.-.-.-.-.-.-:-.-.-.-.-.-.-.--
         |  14   |   0   |      msg      |             value             |
         -----------------------------------------------------------------






                             5.1  Circuit Termination

         Msg 0 is circuit terminated, of form:

         --.-.-.-.-.-.-.-:-.-.-.-.-.-.-.-:-.-.-.-.-.-.-.-:-.-.-.-.-.-.-.--
         |  14   |   0   |       0       |            reason             |
         -----------------------------------------------------------------

                      value  reason
                       1     host has gone down (ISIS slot crash)
                       2     dropped by host
                       3     dropped by user
                       4     host not available
                       5     sub-host down at logon
                       6     sub-host shut at logon
                       7     out of ports
                       8     out of channels
                       9     terminal does not match available ports
                      10     circuit origination rejected (based upon node of
                             origination)
                      11     user-name rejected (Callee has rejected circuit)

      20                       TYMNET Accounting II                 ACCT2.DOC
      Accounting Addenda                                     February 4, 1986


                      12     illegal usage of foreign origin
                      13     special camp-on disconnect
                      14     network disconnect
                      15     node code out of dispatcher ports
                      16     ISIS slot out of dispatcher ports
                      17     ISIS slot zapped, host out of ports -- issued by
                             ISIS Node Code (Slot  has issued a BE  [Zap with
                             reason]   message,  and   then  the   node  code
                             discovers  that the  host has  not  reported "no
                             ports available" -- the slot is ill-behaved).
                      18     host not answering
                      19     host rejected caller
                      20     protocol violation
                      21     resource-limit exceeded
                      22     loss of synchronization
                      23     MP out of LAN routes
                      24     Internal Hosts -- circuit rejected  (bad control
                             char)
                      25     Internal  Hosts  --  circuit  timeout  (host not
                             answering)
                      26     Internal  Hosts   --  resource   limit  exceeded
                             (bumped by higher status XRAY user)
                      27     Outdial unsuccessful - busy
                      28     Outdial unsuccessful - no modem available
                      29     Outdial unsuccessful - no ringing
                      30     Outdial unsuccessful - call  answered;  no  tone
                             received
                      31     Outdial unsuccessful - static; unknown tone
                      32     Outdial unsuccessful - call    failed   (unknown
                             reason)


             NOTE  --  Message  type  14.0.0.v  is  the  ONLY  way  to
                     terminate accounting;  It is always  preceeded by
                     message types  8 and 9  if those fields  are non-
                     zero!






                           5.2  Other subtype-0 messages

                 Msg  use
                 1    value is the actual (Physical) port-number assigned (on
                      destination -- See also Subtype-0.9 and Subtype-13).







      21                       TYMNET Accounting II                 ACCT2.DOC
      Accounting Addenda                                     February 4, 1986


                      The next four msg's apply to called address:

                 2    value is the low four BCD digits of address.
                 3    value is the next four BCD digits.
                 4    value is the third group of four BCD digits.
                 5    1 byte of length and 2 high-order BCD digits.

                 6    The  value is  4 BCD  digits of  transit  DNIC's.  Last
                      message sent  is FFnn,  where nn  is number  of transit
                      nets.

                 7    value  is  Collect:Origination   (NOTE...eventually  to
                      become facility) --

                               high 8 bits ---
                                     0 for normal charges,
                                     1 for reverse charges requested;

                               low 8 bits ---
                                     0 for origination from host
                                     1 for origination from terminal

                 8    value is circuit-Originating Host Number.
                 9    value is circuit-Originating (Physical) Port  Number --
                      (See also subtype-14):

                               High 8 bits (Device-type) ---
                                     0 for uncontrolled (vanilla) ports,
                                   1-4 for ASYNC ports,
                                     5 for SYNC ports,
                                     6 for SIO ports.

                               Low 8 bits ---
                               Physical port number.

             NOTE   SIO ports specify  physical port number  as 4-bits
                     of mother-board ID, followed by 4-bits of channel
                     number.

                      The next four msg's apply to calling address:

                 10   value is the low four BCD digits.
                 11   value is the next four BCD digits.
                 12   value is the third group of four BCD digits.
                 13   1 byte of length and 2 high-order BCD digits.


                 14   low order 4 bits  are IRC selected by gateway.   Bit 16
                      is  indication of  updated session  start time,  due to
                      call-accepted packet being received.
                 15   Call_cleared cause and diagnostic.
                 16   Multiplexed  PVC  count of  port  sessions accumulated.


      22                       TYMNET Accounting II                 ACCT2.DOC
      Accounting Addenda                                     February 4, 1986


                      Reported periodically for MPVC circuits, and at  end of
                      MPVC session.
                 17   MPVC count  of port  session time  (minutes).  Reported
                      periodically  for MPVC  circuits,  and at  end  of MPVC
                      session.

                 18   value is DATAPAC Tariff Class (non-X.75 Utility) --

                               Format: SSSSSBBB

                                   BBB ---
                                   000 Band 1
                                   001 Band 2
                                   010 Band 3
                                   011 Band 4
                                   100 Band 5;

                                 SSSSS ---
                                 00000 SNAP Service
                                 00001 ITI Public Dial
                                 00010 ITI Private Access

                 19   Terminal address (extended).  Used to identify specific
                      terminals  on a  multiple-terminal physical  port (e.g.
                      multi-drop lines).  Format is PROTOCOL-DEPENDENT!

                               3270 -    Format: CCCCDDDD;  the first byte is
                                         the  controller address,  the second
                                         is the device address.

                 20   Message-mode circuit.  Low-order bit  specifies whether
                      circuit-originator (0) or circuit-destination (1) is in
                      message-mode.  (NOTE...unused, to be reassigned  in the
                      future.)
                 21   PVC  indicator.  This  circuit is  a  Permanent Virtual
                      Circuit.  Value field to be 1.
                 22   X-25 Fast-select packet-request facility.  (Provisional
                      until X.25/X.75  facilities implemented  in Accounting-
                      II.)  Value field to be 1.

                      The next 8 messages apply to Outdial (NOTE:  the dialed
                      number  is encoded  as strings  of BCD  digits;  unused
                      digits are padded with hex F; only as many  message are
                      sent as are required to contain the digits.):

                 23   Dialed number: high 4 digits.
                 24   Dialed number: next 4 digits.
                 25   Dialed number: third group of 4 digits.
                 26   Dialed number: fourth group of 4 digits.
                 27   Dialed number: fifth group of 4 digits.
                 28   Dialed number: sixth group of 4 digits.
                 29   Dialed number: seventh group of 4 digits.
                 30   Dialed number: eighth group of 4 digits.

      23                       TYMNET Accounting II                 ACCT2.DOC
      Accounting Addenda                                     February 4, 1986



                      The following message  also applies to  outdial:  these
                      are  various  conditions  which  do  not  terminate the
                      circuit:

                 31.x.0 Outdial successful - call is completed -- if the low-
                      order 8  bits of  v is  0, then  the high-order  8 bits
                      contain the  CCT representing the  speed of  the actual
                      call  completed (which  may be  different than  the CCT
                      associated with the Outdial circuit).
                 31.1   Outdial unsuccessful - busy
                 31.2   Outdial unsuccessful - no modem available
                 31.3   Outdial unsuccessful - no ringing
                 31.4   Outdial unsuccessful - no answer






                            5.3  Non subtype-0 messages

         1   This contains 20 bits of origination input packet count (mPs).
         2   This contains 20 bits of origination output packet count (mPs).
         3   This contains 20 bits of origination input segment count (mPs).
         4   This contains 20 bits of origination output segment count (mPs).
         5   This contains 20 bits of destination input segment count (mPs).
         6   This contains 20 bits of destination output segment count (mPs).
         7   This contains 20 bits of destination input packet count (mPs).
         8   This contains 20 bits of destination output packet count (mPs).

         9   This contains 24  bits of gateway  invoice number (in  a TYMNET-
             TYMNET gateway, there are independent supervisors in each of the
             networks,  and each  half of  the circuit  is assigned  a unique
             invoice number--this message permits the exchange of invoices so
             that accounting in the two networks may be correlated).
         10  This contains the low  24-bits of server invoice number  (with a
             server-slot, one circuit is created from origin to server, and a
             second circuit  is created  from the  server to  the destination
             host.   This  invoice  number  permits  the  correlation  of the
             accounting for the two circuits).
         11  This contains  the high 24-bits  of gateway invoice  number (see
             9).
         12  This contains  the high  24-bits of  server invoice  number (see
             10).
         13  This  contains  the  destination MP  port-address  --  8-bits of
             machine-number  prefixing that  machine's  physical port-address
             (See also subtypes 0.1 and 0.9).  A machine-number of  0 implies
             non-MP.
         14  This contains the origination MP port-address, as in subtype-13.
             (See also subtype 0.9)
         15  unused;  reserved.


      24                       TYMNET Accounting II                 ACCT2.DOC
      Messages which originate in Nodes                      February 4, 1986







                  4.1.9  Type 15 -- X.25 / X.75 Facilities

         --.-.-.-.-.-.-.-:-.-.-.-.-.-.-.-:-.-.-.-.-.-.-.-:-.-.-.-.-.-.-.--
         |  15   | flags |       F1      |        F2     |       F3      |
         -----------------------------------------------------------------

           These are used to  transmit a variable amount of  data (character-
      string) for a particular  session into the accounting  stream.  Because
      they may  originate at  the Callee  and/or Caller,  and because  of the
      disastrous effects of a loss of synchronization,  redundant information
      is included:

         Flags   The  bits  of this  field  are "micro-coded",  and  have the
             (binary) significance (x are arbitrary values):
             0 x x x - Originated at Callee;
             1 x x x - Originated at Caller;
             x 0 x x - first byte is a string-length indicator;
             x 1 x x - first two bytes are a string-length indicator;
             x x 1 x - string-start   (first   element    is   string-length)
                indicator;
             x x x 1 - string-end indicator.
                 Note:   not all combinations are meaningful (e.g. x10x).

         Fi      Successive bytes  of information;   padding beyond  the last
             byte specified by the count may contain arbitrary  values.  This
             message must, however, have the xxx1 flag set;  if xxx1 and end-
             of-string determined by count disagree, it must be  assumed that
             synchronization has been lost and the entire string is suspect!





















      18                       TYMNET Accounting II                 ACCT2.DOC
      Summary of Accounting messages and Field sizes         February 4, 1986






           APPENDIX I.   Summary of Accounting messages and Field sizes



           The accounting messages are of format:

           Type       Usage        format: | t |         value              |

           The types are as follows:

              0       Null                 | 0 |           0                |
              1(.0)   New Logon            | 1 |mP |  New Invoice Number    |
              1(.8)   Continue Logon       | 1 |8mP|  Cont. Invoice Number  |
              2.0     Origination Data     | 2 | 0 |mPs|  Origination node  |
              2.1                          | 2 | 1 |mPs|  Origination port  |
              2.2                          | 2 | 2 |mPs|  Origination host  |
              2.3                          | 2 | 3 | Origination Phy. port  |
              2.4                          | 2 | 4 |   R   |  CCT  |IRC| S  |
              2.5     (Rebuild)            | 2 | 5 |   R   |   R   | reason |
              3.0     Target Data          | 3 | 0 |mPs|  Destination node  |
              3.1                          | 3 | 1 |mPs|  Destination host  |
              3.2                          | 3 | 2 |mPs|  Destination port  |
              4       User Name (mP)       | 4 | R |   C1  |   C2  |   C3   |
              5       UUN                  | 5 | R |         UUN            |
              6       Node Number          | 6 |   R   |    Node number     |
              7       Invoice number       | 7 |mP |    Invoice Number      |
              8       Input Char. Count    | 8 |mP |    Input Count         |
              9       Output Char. Count   | 9 |mP |    Output Count        |
             10       Obsolete Out. Count  |10 |        Output Count        |
             11       Obsolete Out. Count  |11 |        Output Count        |
             12       Obsolete Out. Count  |12 |        Output Count        |
             13       Project Code (mP)    |13 | R |   C1  |   C2  |   C3   |
             14       Accounting Addenda   |14 | S |       fields           |
             14.0     Accounting Message   |14 | 0 |  msg  |     value      |
             14.0.0   Termination Reason   |14 | 0 |   0   |     reason     |
             14.0.1   Dest. Phys. Port #   |14 | 0 |   1   |     port #     |
             14.0.2-6 BCD address Digits   |14 | 0 |  2-6  |     digits     |
             14.0.7   Collect/Origination  |14 | 0 |   7   | Col.  | Orig.  |
             14.0.8   Origination Host     |14 | 0 |   8   |   Orig. Host   |
             14.0.9   Origination Port     |14 | 0 |   9   |   Orig. Port   |
             14.0.10-13 Calling BCD Digits |14 | 0 | 10-13 |     digits     |
             14.0.14  IRC Select           |14 | 0 |  14   |      IRC       |
             14.0.15  Call Cleared         |14 | 0 |  15   |     cause      |
             14.0.16  MPVC Session Count   |14 | 0 |  16   |     count      |
             14.0.17  MPVC Session Time    |14 | 0 |  17   |     time       |
          .0.18  DATAPAC Tarrif Class |14 | 0 |  18   |     class      |
             14.0.19  Term. Addr. (extend) |14 | 0 |  19   |     addr.      |
             14.0.20  Message-mode Circuit |14 | 0 |  20   |   orig/dest    |
             14.0.21  X.25 PVC             |14 | 0 |  21   |     unused     |

      27                       TYMNET Accounting II                 ACCT2.DOC
      Summary of Accounting messages and Field sizes         February 4, 1986


             14.0.22  X.25 Fast-Select     |14 | 0 |  22   |     unused     |
             14.0.23-30 Outdial BCD Digits |14 | 0 | 23-30 |     digits     |
             14.0.31  Outdial Status       |14 | 0 |  31   |     status     |
             14.1     Orig. Inp. Pkt. Cnt  |14 | 1 |       count            |
             14.2     Orig. Out. Pkt. Cnt  |14 | 2 |       count            |
             14.3     Orig. Inp. Seg. Cnt  |14 | 3 |       count            |
             14.4     Orig. Out. Seg. Cnt  |14 | 4 |       count            |
             14.5     Dest. Inp. Pkt. Cnt  |14 | 5 |       count            |
             14.6     Dest. Out. Pkt. Cnt  |14 | 6 |       count            |
             14.7     Dest. Inp. Seg. Cnt  |14 | 7 |       count            |
             14.8     Dest. Out. Seg. Cnt  |14 | 8 |       count            |
             14.9     Gateway Invoice      |14 | 9 |  Invoice number (low)  |
             14.10    Server Invoice       |14 |10 |  Invoice number (low)  |
             14.11    Gateway Invoice      |14 |11 |  Invoice number (high) |
             14.12    Server Invoice       |14 |12 |  Invoice number (high) |
             14.13-14 MP Physical Port     |14 | x |  Physical port number  |
             15       X.25/X.75 facilities |15 | f |   F1  |   F2  |   F3   |

           Where:   "mP"  designates  (possible)  Multiple-Precision  format;
      "mPs" designates (possible)  Multiple-Precision (short) format;  "R" is
      reserved;  "S" is subtype.






                                 I-1  Field Sizes


           The  accounting  master  must  reserve  fields  whose   sizes  are
      consistant  with  the  field  sizes  actually  used.   The  field sizes
      corresponding  to this  specification ('+'  indicates fields  which are
      potential subjects for future expansion) are:

        4 bit     IRC
        4 bit     Circuit speed
        8 bit     Supervisor number
        8 bit     CCT
      +20 bits    Node number
      +20 bits    Host number
      +20 bits    Port number
      +20 bits    UUN
       24 bits    Physical Port number (3 8-bit sub-fields)
       32 bits    Timestamp
      +48 bits    Invoice number
      +48 bits    Input count
      +48 bits    Output count
       20 bytes   User name
       27 bytes   Project code
      256+ bytes  X.25/X.75 Facilities (character-strings)



      28                       TYMNET Accounting II                 ACCT2.DOC
  &rW•