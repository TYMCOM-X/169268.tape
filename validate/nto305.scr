.cm (netvalcode:36)NTO305.SCR
.hs 3;.tt ////
.se docdate='&sysdate'
.se docname=/Netval Operator's Guide/
.pn off;.ad 8;.sp 8;.ce on;&docname
.sp 2;Version 3.05
.sp 2;&docdate
.sp 16;Tymnet Inc.
.sp 2;Network Technology Division
.ce off;.sp 7;.bx 1 &sysll-2;.in 4 -6;.sk
Tymnet, Inc.'s proprietary rights are included in
the information disclosed herein.
The recipient, by receiving this document, agrees that neither this document
nor the information disclosed herein nor any part thereof shall be reproduced
or transferred to other documents or used or disclosed to others for
manufacturing or for any other purpose except as specifically authorized
in writing by Tymnet, Inc.
.sk;.bx off;.in;.pa 1;.pn on
.ur .tt /&docname//&sysdate/
.si wtoc
.nextsect 'Document Overview'
This document describes Operator Procedures for Netval Version 3.05 and
NVDM Version 3.05.
Refer to the Netval External Reference Specification document,
(dndspec:39)ntv305.doc for additional information about Netval.
.sp;Section two describes Netval and NVDM log in and log out procedures.
.sp;Section three describes Netval in relation to network Supervisors and the
procedures used to monitor and control their updating.
.sp;Section four describes how to control the Netval host state.
.sp;Section five describes the operator log.
.sp;Section six describes the tape backup procedure.
.sp;Section seven describes the file restore procedure.
.sp;Section eight explains the logical volume system and procedures
that deal with bringing the system up and creating disk pack backups.
.nextsect 'Logging In and Logging Out'				
This Section covers logging in and logging out of Netval and NVDM.
If the Logical Volumes system is in use, and Netval has not been initialized
after loading, the Netval Programmer or the NVDM Operator may have to follow
special login procedures.
.ur These special procedures are explained in Section &operassis.
.pushsect 'Logging In to Netval'
Netval usernames are multiple access, i.e.,
many users may login to a username at the same time.
You must be at the PLEASE LOG IN: network
prompt in order to log in to Netval.
Follow the procedures established for your terminal in
order to bring you to this prompt.
Then, enter the following login string to access Netval:
.in 12;.sp;.il -2;- a network username
.il -2;- a colon ":" (if the Netval host is not a home host for the username)
.il -2;- the destination host number (if the Netval host
is not a home host for the username)
.il -2;- a semicolon ";"
.il -2;- the password for the network username entered
(this will not be echoed at your terminal)
.il -2;- a Carriage Return
.in;.sp;If a successful login string is entered, Netval displays a welcome
banner and an asterisk (*).
The asterisk is the Netval prompt,
indicating that you may begin to enter commands.
.sp 2;.cp begin;A sample login sequence is:
.in 10;.sp;please log in: nvaluser:84;xxxxxxxxx<CR>
.sp;Netval - Version 3.05 at 10/01/85 23:48:42
.sp;*
.in;.cp end;.sp;If your username is not authorized to log in to Netval, you
will not be allowed to log in, and Netval will display the following message:
.sp;.ce you are not valid to use NETVAL
.sp;If the Logical Volumes system is in use,
and Netval has not been initialized after loading,
the Netval Programmer or the NVDM Operator may have to log in and
select an access disk, before any other users can log in to Netval.
In this case, if you attempt to log in to Netval and you are not using the
Netval Programmer or the NVDM Operator username,
you will not be allowed to log in,
and Netval will display the following message:
.sp;.ce NETVAL has not been initialized, no unprivileged logins allowed
.sp;Or, if you are logging in with the Netval Programmer or NVDM Operator
username and an access disk must be selected,
Netval displays the disk status,
and you must confirm the disk that will be used as the current disk.
.ur This process is explained in Section &operassis.
.nextsect 'Logging In to NVDM'
If NVDM is loaded in the slot, only one user, using the Netval Programmer or
NVDM Operator username, may login.
The login procedure is the same as for Netval.
You must be at the PLEASE LOG IN: network prompt in order to log in to NVDM.
Follow the procedures established for your terminal
in order to bring you to this prompt.
Then, enter the following login string to access NVDM:
.in 12;.sp;.il -2;- the NVDM Operator name
.il -2;- a colon ":" (if the Netval host is not a home host for the
NVDM Operator username)
.il -2;- the destination host number (if the Netval host
is not a home host for the NVDM Operator username)
.il -2;- a semicolon ";"
.il -2;- the password for the NVDM Operator username
(this will not be echoed at your terminal)
.il -2;- a Carriage Return
.in;.sp;If a successful login string is entered, NVDM displays a welcome
banner and an asterisk (*).
The asterisk is the NVDM prompt,
indicating that you may begin to enter commands.
.sp 2;.cp begin;A sample login sequence is:
.in 5;.sp;please log in: nvdmop:84;xxxxxxxxx<CR>
.sp;Netval Disk Maintenance - Version 3.05 at 10/01/85 23:48:42
.sp;*
.in;.cp end;.sp;If a user other than the NVDM Operator or Netval Programmer
attempts to login while NVDM is loaded in the slot,
NVDM will not allow the user to login and displays the following message:
.sp;.ce you are not valid to use NVDM
.nextsect 'Logging Out'
This Section describes the logout procedures used in Netval and NVDM.
Operators may logout manually, or, in the case of Netval, be timed out.
The operator may manually log out of Netval or NVDM by entering the
QUIT command at the asterisk prompt.
When this command is entered the operator is taken to network level and the
PLEASE LOG IN prompt will be displayed.
.sp 2;A sample logout sequence is:
.in 10;* quit
.sp;Logging out at 10/1/85 23:52:35
.sp;please log in:
.in;.sp;There is an automatic logout factor in Netval.
This factor is set at system generation by the specification of the
Terminal Timeout Parameter in the configuration file.
This parameter specifies the number of minutes that can pass with the
user at the Netval prompt and no activity on the user's terminal
before the terminal circuit is zapped.
10 minutes is the typical timeout period.
.sp;The timeout does not apply to the Netval Programmer.
.popsect 1 'Supervisor Updating'
Netval is a Network Validation program that allows validators to make changes
to network validation data on the Netval system, and
automatically transmits these changes to the network Supervisors.
.sp;The data that is handled by Netval includes:
.sp;.in 4;.il -4;1.  CUD/MUD Information
.sp;The CUD, or Controlling User Directory, is a file that contains network
usernames, passwords and various other network access and validation data.
Each Supervisor has its own copy of the CUD, called the MUD, or Master User
Directory.
.sp;When a user attempts to login through the network,
the Supervisor uses the information in its MUD to determine the user's
legal access (i.e., is the username in the MUD? is the password correct?
can the user originate from the node or host that he is entering the network
from?
can the user access the host specified as a destination?
which host should the user be routed to if there is none specified in the
login string? etc.).
.sp;.il -4;2.  Class/group Information
.sp;Part of the user's CUD/MUD entry contains access information, i.e.,
legal network origins and destinations for the user.
.sp;A CLASS is a globally defined set of originating hosts and/or originating
nodes, which are used to define the locations from which
a user may access the network (ORIGINS).
.sp;A GROUP is a globally defined set of host numbers.
Groups are used to define the set of hosts to which a user
may build a circuit (DESTINATIONS).
.sp;Netval maintains information about Classes and groups, and generates
a copy of the Supervisor Class/group Table; each Supervisor has its own copy
of the Class/group Table.
The Supervisor uses its Class/group Table when a user is logging in,
and the users MUD entry refers to a CLASS as an origin or a GROUP as a
destination.
.in;.sp;In both these cases, validators login to Netval and
make changes to Netval's information.
Netval then transmits the changes to the Supervisors.
When transmitting CUD data, Netval communicates with the UN2 slave part of the
Supervisor;
when transmitting Class/group data,
Netval communicates with the SYSMSG1 slave part of the Supervisor.
.sp;It is important that the validation information gets updated
on the Supervisors in a timely manner.
Out-of-date information may cause users to lose access through the network,
or may grant access to a user that should no longer have it.
.sp;Netval maintains a list of legal Supervisors,
i.e., Supervisors that have been turned ON in Netval with the
.ur SET SUPERVISOR Command (Section &nasetsup).
These are the Supervisors that Netval will update when there are changes
made to the CUD or Class/group Table.
This list must be kept up-to-date, or there may be a Supervisor with
old information.
.pushsect 'MUD Updating'
When a modification is made to the Netval CUD,
a description of the change is appended to the MUDUPDATE file.
An automatic process for each Supervisor is notified that there is a change
to be sent, a circuit is built to the Supervisor,
and the change is transmitted through the network.
Only the changed information is sent.
.sp;Netval keeps track of how much data is in the file (the file EOF)
and the point to which each Supervisor has been updated.
When the data has been sent to all legal Supervisors, the EOF is set to 0.
.sp;If a Supervisor is DOWN (inaccessible to Netval) for a period of time,
the data in the MUDUPDATE file may come close to filling up the file.
If the MUDUPDATE file ever becomes full, VALIDATORS WILL NO LONGER
BE ABLE TO MAKE CHANGES TO THE CUD!
A Supervisor may be turned OFF with the SET SUPERVISOR Command
.ur (Section &nasetsup).
.sp;.ur The DISPLAY UPDATES command (Section &nadisupcmd) types information
about the amount of data in the file (MUD update EOF),
how full the file is, and the amount of data sent to each Supervisor (Ptr).
In addition, the date and time the Supervisor was last sent a MUD change
is displayed.
.sp;Once a day, according to a schedule set by the SET SCHEDULE Command
.ur (Section &nasetcmd), an automatic CONSISTENCY process is run.
It compares checksums between CUD and MUD blocks,
and if the MUD checksum does not match the CUD checksum,
the CUD block data is transmitted to be stored in the MUD.
.sp;If it is ever necessary to turn off the automatic consistency process
.ur altogether, the CLEAR Command (Section &naclrcmd) may be used.
.sp;A MANUAL, or command initiated consistency may also be run by the
.ur operator by executing the CONSISTENCY Command (Section &naconscmd).
Manual consistencies are run whenever there is doubt as to whether the
MUD contains up-to-date information.
If a Supervisor is turned OFF in Netval, when it is turned back ON, it
is important the the Supervisor's MUD be brought up-to-date.
If Netval is compiled with the RUN_AUTO_CONSISTENCY_ON_SUP_INIT parameter set
to true in the configuration file, a consistency will start up immediately
when the SET SUPERVISOR Command is executed.
Otherwise, the CONSISTENCY Command should be used to
guarantee the data in the MUD.
.sp;The DISPLAY UPDATES command types information about consistencies.
It displays the time that the automatic consistency is set to run
(Scheduled consistency period:), the time that the previously completed
consistency started (Last Start) and stopped (Last Stop),
the last block that the previously completed consistency processed (End Block),
the time any currently running consistencies started (Current Start), and the
block just processed (Block).
In addition, it flags any manual or halted consistencies.
.nextsect 'Class/group Table Updating'
The Class/group Table information is maintained by Network Administrator
validators.
When the Class/group Table is ready to be transmitted to the Supervisors
the SEND Command is executed.
This causes a date (Class and Group table last created) to be set to the
current time.
An automatic process continually compares this time against the time that
the Table was last sent to each Supervisor, and if necessary, transmits a
copy of the Table to any out-of-date Supervisors.
.sp;The DISPLAY UPDATES Command types the date
(Class and Group table last created) and, for each Supervisor, the
date and time it was last sent the Table (Class and group Updated).
.nextsect 'Supervisor Notification Procedure'
Netval must be notified of changes in Supervisor status,
i.e., changes in their accessibility by Netval.
.sp 3;.ce;Turning a Supervisor ON
.sp;When a new Supervisor is brought up into the network,
or when a Supervisor has been turned OFF and is now back up and
ready to be updated, Netval must be notified.
.ur This is accomplished with the SET SUPERVISOR Command (Section &nasetsup).
.sp;Since the Supervisor MUD will most likely be out-of-date, the MUD
must be updated with the current CUD information.
If the parameter RUN_AUTO_CONSISTENCY_ON_SUP_INIT is set to TRUE
in the Netval configuration file, a consistency will be automatically
started whenever a Supervisor is set to ON.
.ur The DISPLAY UPDATES Command (Section &nadisupcmd) will show whether a
consistency starts up;
.ur the MESSAGES Command (Section &namesscmd) will show
if Netval attempted to run a consistency and failed
(Netval may fail if the Supervisor is not accessiable through the network).
.sp;If an automatic consistency does not start up, the CONSISTENCY Command
.ur (Section &naconscmd) must be executed to bring the MUD up-to-date.
.sp 3;.ce;Turning a Supervisor OFF
.sp;When a Supervisor is unavailable for an extended period of time,
and MUD change data is accumulating so much that the MUDUPDATE file
is getting full, Netval must be notified to stop attempting to update
that Supervisor.
.ur This is accomplished with the SET SUPERVISOR Command (Section &nasetsup).
.ur The DISPLAY UPDATES Command (Section &nadisupcmd) will show if the
MUDUPDATE file is getting full.
.nextsect 'Supervisor Related Commands'
The following commands are used to monitor and control Netval's
Supervisor access.
.pushsect 'CLEAR Command'
.se naclrcmd='&sectno'
.cp begin;Syntax:  CLear
.sp;The CLEAR command allows the validator to turn off
the automatic consistency.
Once the CLEAR command is used, the consistency will not run until the SET
.ur SCHEDULE command (Section &nasetcmd) is executed to reset the schedule.
.cp end;.sp;A message is written to the operator log specifying
that the command was executed by the operator.
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;* clear
.sp;consistency deactivated
.sp;*
.in;.cp end;.nextsect 'CONSISTENCY Command'
.se naconscmd='&sectno'
.cp begin;Syntax:  CONsistency Supervisor s <Nochange> <From b>
.sp;The CONSISTENCY command allows the validator to
force the information in a Supervisor MUD to be identical with the
information in the CUD.
"s" represents a Supervisor host.
.cp end;.sp;.cp begin;As Netval processes the blocks of information,
it reports its progress.
After every CONSISTENCY_REPORT_INTERVAL (defined in the configuration file)
blocks checked, Netval outputs:
.sp;.ce n<:u/r>
.cp end;.sp;.cp begin;where "n" is the block number just processed,
"u" is the number of MUD blocks that needed to be updated,
"r" is the number of MUD blocks that were re-transmitted (sent to the
Supervisor more than once).
"u" and "r" are both output if either one is non-zero.
.cp end;.sp;.cp begin;If the NOCHANGE parameter is included
in the command, no MUD updates are actually made; differences are output
to the validator as described above and the differing blocks are
reported to the operator log.
.cp end;.sp;.cp begin;If the FROM parameter is included in the command,
and the configuration parameter CONSISTENCY_RESTARTABLE is set to TRUE,
the consistency will begin at the block specified, "b."
.cp end;.sp;.cp begin;The CONSISTENCY command may also be executed
automatically according to a schedule.
To set the schedule for the automatic consistency, use the SET SCHEDULE
.ur command (Section &nasetcmd).
An automatic consistency and a manually initiated
consistency cannot run at the same time on a Supervisor.
.ur The DISPLAY UPDATES command (Section &nadisupcmd) reports information on
whether or not a consistency is running, and the STOP command
.ur (Section &nastpcmd) will halt a currently running automatic consistency.
.cp end;.sp;.cp begin;Output from the automatic consistency, which only
includes information about updated and/or re-transmitted blocks is sent
to the LOG,
.ur and may be displayed with the MESSAGE command (Section &namesscmd).
.cp end;.sp;.cp begin;This command may require
considerable time to complete, since the entire CUD is processed.
If the update is interrupted, the MUD will be checked only to the current
block.
.cp end;.sp;A message is written to the operator log specifying
that the command was executed by the operator.
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;* consistency sup 125
.sp;99 199 299 399:1/0 499 599 . . .
.sp;Supervisor 125 consistency:  complete
.sp;*
.cp end;.in;.nextsect 'DISPLAY UPDATES Command'
.se nadisupcmd='&sectno'
.cp begin;Syntax:  DIsplay UPdates <Repeat <s>>
.sp;The DISPLAY UPDATES command allows the
validator to display information about MUD, Class and Group Table updates
and current and past runs of consistencies.
If the REPEAT parameter is included in the command,
the display will be repeated every "s" seconds;
if "s" is omitted, 60 seconds is assumed.
The operator should enter the <break> key to halt the command.
.cp end;.sp;The information displayed includes:
.in 5;.sp;.il -5;The current time in GMT.
.sp;.cp begin;.il -5;Blocks in cud
.br;The BLOCKS IN CUD indicates the total size of the CUD in blocks.
.cp end;.sp;.cp begin;.il -5;MUD update EOF
.br;The MUD UPDATE EOF specifies the address in thePDATE file
at which the next CUD change will be recorded; it is followed by
a value which reports how full the MUD update file is.
.cp end;.sp;.cp begin;.il -5;Class and Group table last created
.br;The CLASS AND GROUP TABLE LAST CREATED specifies the time and date
.ur at which the last SEND command (Section &nasencmd) was executed.
.cp end;.sp;.cp begin;.il -5;Scheduled consistency period
.br;The SCHEDULED CONSISTENCY PERIOD specifies the current time period set up
.ur by the last SET SCHEDULE command (Section &nasetcmd).
.cp end;.sp;.cp begin;.il -5;For each Supervisor:
.in +5;.il -5;PTR
.br;For each Supervisor in the network, Netval keeps track of the
MUD updates by maintaining a PTR into the MUDUPDATE file.
If the PTR is the same as the MUD UPDATE EOF, all outstanding changes
have been sent to the Supervisor.
.cp end;.sp;.cp begin;.il -5;MUD UPDATED
.br;MUD UPDATED is the last date and time that a MUD change was sent
to that Supervisor.
.cp end;.sp;.cp begin;.il -5;CLASS AND GROUP UPDATED
.br;CLASS AND GROUP UPDATED is the last date and time that
the Class and Group table was transmitted to that Supervisor.
.cp end;.sp;.cp begin;.il -5;CONSISTENCY LAST START
.br;CONSISTENCY LAST START is the start time of the previously started
consistency.
.cp end;.sp;.cp begin;.il -5;CONSISTENCY LAST STOP
.br;CONSISTENCY LAST STOP is the stop time of the previously started
consistency.
.cp end;.sp;.cp begin;.il -5;CONSISTENCY END BLOCK
.br;CONSISTENCY END BLOCK specifies the block number the previously run
consistency completed when it stopped.
COMPLETE means the consistency compared all blocks in the CUD.
S specifies that the run was stopped by the STOP command (Section
.ur &nastpcmd).
M specifies that the run was manual, i.e., initiated by the
.ur CONSISTENCY command (Section &naconscmd).
.cp end;.sp;.cp begin;.il -5;CONSISTENCY CURRENT START
.br;CONSISTENCY CURRENT START is the start time of a currently
running consistency.
.cp end;.sp;.cp begin;.il -5;CONSISTENCY BLOCK
.br;CONSISTENCY BLOCK is the block that the consistency is currently
comparing.
M specifies that the consistency was started manually by the CONSISTENCY
.ur command (Section &naconscmd).
.in;.cp end;.sp;Note: All times are displayed in GMT.
.sp 2;.cp begin;A sample command/response sequence is:
.sp;* display updates
.sp;Current time is 12/07/84 02:20:39 GMT
.br;Blocks in CUD: 2039    MUD update EOF:  294   (0% full)
.br;Class and Group table last created:  12/06/83 08:42:02
.br;Scheduled consistency period: 01:00 to 04:00
.fo no
.sp;Sup                      MUD        Class and Group
.br;           Ptr         Updated          Updated
.br;121            4      12/05 11:02      12/05 13:42
.br;122          294      12/07 01:42      12/06 12:40
.br;124            4      12/06 12:03      12/06 08:43
.br;125          294      12/07 02:12      12/06 08:44
.br;127           56      12/07 02:45      12/07 01:20
.sp;Sup                      CONSISTENCY
.br;     Last Start     Last Stop   End Block    Current Start  Block
.br;121  12/05 01:01   12/05 02:00   complete
.br;122  12/06 01:01   12/06 01:15      102   S
.br;124  12/06 01:03   12/06 02:26     1205       12/07 01:15      45
.br;125  12/06 01:02   12/06 02:25   complete     12/07 01:03    2030 M
.br;127  12/07 00:05   12/07 01:15   complete M
.sp;*
.in;.fo;.cp end;.nextsect 'SET SCHEDULE Command'
.se nasetcmd='&sectno'
.cp begin;Syntax:  SET SChedule
.sp;The SET SCHEDULE command allows the validator to specify the time period
during the day at which the automatic consistency process runs.
.ur The CLEAR command (Section &naclrcmd) turns all automatic consistencies
off.
The times are entered in hours and minutes in GMT time.
.cp end;.sp;.cp begin;When the following conditions exist: within the time
period specified, an automatic consistency has not run to completion,
Supervisor is legal, consistency
is not currently running, and no MUD updates are being made - an automatic
consistency is started.
.cp end;.sp;.cp begin;At the end of the time period, if any automatic
consistencies are running, they will be stopped.
.cp end;.sp;A message is written to the operator log specifying
that the command was executed by the operator.
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;* set schedule
.sp;start time of consistency period: 1:00
.br;stop time of consistency period: 4:00
.sp;entry complete
.sp;*
.in;.cp end;.nextsect 'SET SUPERVISOR Command'
.se nasetsup='&sectno'
.cp begin;Syntax:  SET SUpervisor s [ON|OFF]
.sp;The SET SUPERVISOR command allows the
validator to specify the Supervisors that are to be accessed by:
.in 20;.cp end;.sp;.cp begin;MUDUPDATE
.br;CONSISTENCY
.br;Class and Group UPDATE
.in;.cp end;.sp;.cp begin;If the ON parameter is included, Supervisor "s"
will be considered a legal Supervisor by Netval; if the OFF parameter is
included, Supervisor "s" will be ignored by Netval.
.cp end;.sp;.cp begin;If the operation is completed successfully,
Netval will report the list of currently legal Supervisors.
.cp end;.sp;.cp begin;When a Supervisor is turned ON, (if previously OFF)
and the configuration parameter RUN_AUTO_CONSISTENCY_ON_SUP_INIT
is set to TRUE, an automatic consistency is run when the SET SUPERVISOR
command is executed.
.cp end;.sp;.cp begin;Note that the entries are limited by the
definition in the configuration file of MAXIMUM_EXPECTED_SUPERVISORS.
.cp end;.sp;A message is written to the operator log and the Supervisor error
log specifying that the command was executed by the operator.
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;* set supervisor 121 on
.sp;entry completed
.sp;Netval Supervisors are: 121, 122, 124, 125
.sp;*
.in;.cp end;.nextsect 'STOP Command'
.se nastpcmd='&sectno'
.cp begin;Syntax:  STOp Supervisor s
.sp;The STOP command allows the
validator to halt an AUTOMATIC consistency run for the specified Supervisor.
"s" represents a Supervisor host.
.ur The DISPLAY UPDATES command (Section &nadisupcmd) reports
information on whether or not a consistency is currently running.
.cp end;.sp;A message is written to the operator log specifying
that the command was executed by the operator.
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;* stop supervisor 121
.sp;consistency halted
.sp;*
.in;.cp end;.popsect 2  'Controlling the Netval Host State'
The initial state of the Netval host (UP or SHUT) may be specified in the
Netval slot TYM file.
It may also be changed with the HOST SHUT or HOST UP commands
described in this Section.
.sp;Information about the Netval host may be retrieved with the
HOST STATUS command.
.pushsect 'HOST SHUT Command'
.se shutcmd='&sectno'
.cp begin;Syntax:  HOst SHut
.sp;Description:  The HOST SHUT command allows the operator to change
the state of the Netval host in the network to the shut state.
In this state, only users with the shut override control option
may login to Netval.
.cp end;.sp;.cp begin;This command is useful when Netval is to go down,
to allow the MUD change file to catch up with all its changes.
It may also be used when Netval first comes up, to give the operator or
network administrator a chance to check on the state of Netval files.
.cp end;.sp;The Netval TYM file specifies the initial state of the Netval host.
.sp;.cp begin;When Netval is in the shut state,
.ur the HOST UP command (Section &upcmd) may be used to change
the state of the Netval host to allow all users to login.
.cp end;.sp;There are no errors possible for this command,
and a message is written to the operator log specifying
that the command was executed by the validator.
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;* host shut
.sp;entry completed
.sp;*
.in;.cp end;.nextsect 'HOST STATUS Command'
.cp begin;Syntax:  HOst STatus
.sp;Description:  The HOST STATUS command allows the operator to
display information about the Netval host, including:
.sp;.in 17;.il -2;- hardware identification (node and kernel host)
.il -2;- the number and type of users currently logged in
.in;.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;* host status
.sp;Host 83 is UP
.sp;This hardware is identified by: 
.br;  node: 2012
.br;  kernel host: 12
.sp;logged in:
.br;   2 licensed validators
.br;   1 programmer validator
.sp;*
.in;.cp end;.nextsect 'HOST UP Command'
.se upcmd='&sectno'
.cp begin;Syntax:  HOst Up
.sp;Description:  The HOST UP command allows the
operator to change the state of the Netval host in the network to answered.
In this state, all usual Netval validators may login to Netval.
.cp end;.sp;.cp begin;The hardware identification is displayed to the operator,
and he is prompted to confirm the information.
.cp end;.sp;There are no errors possible for this command,
and a message is written to the operator log specifying
that the command was executed by the validator.
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;* host up
.sp; Host 83 is SHUT
.sp;This hardware is identified by:
.br;  node: 2012
.br;  kernel host: 12
.sp;continue? y
.sp;entry completed
.sp;*
.in;.cp end;.popsect 1 'Operator Log'
.se namesscmd='&sectno'
Netval maintains a log of information about critical events in the
Netval system.
This includes validator logins, logouts, disk errors, and the execution of
critical operational commands
(setting Supervisors, consistency schedule, etc.).
If the flag CHANGES_TO_OPERLOG is enabled in the Netval configuration file,
in addition, a record of each CUD change is written to the file.
The MESSAGE command is used to display information from the operator log file.
.sp 2;.ce; MESSAGE Command
.sp;.cp begin;Syntax:  Message <From date-time>
.sp;Contents of the operator's log is displayed to
the user's terminal.
If the FROM parameter is omitted, messages not previously
read by any user are output until the <break> character is entered.
.cp end;.sp;.cp begin;If the FROM parameter is entered,
only records on or following the date-time are printed,
and the command returns the user to the prompt when
all messages are displayed.
.cp end;.sp;Times are displayed in GMT.
.sp;.cp begin;"date-time" is entered as:
.sp;.ce;<MM/DD</YY>>  <HH:MM>
.cp end;.sp;.cp begin;where MM is a month of the year,
DD is a day of the month, YY is the optional year (current is default),
HH is an hour of the day and MM is a minute of the hour.
If the time is omitted, 00:00 is assumed;
if the date is omitted, the current day is assumed.
.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;* message
.sp;2/28/83  01:30:13
.br;Validator login: 1   USERVAL  network administrator
.br;from host: 220 node: 2012 port:3d   invoice: 2156789
.sp;2/28/83  01:35:20
.br;Validator logged out: 1   USERVAL
.br;<break>
.sp;*
.in;.cp end;.nextsect 'Tape Backups'
This Section describes the Archive Sub-system commands, and the procedure
used to perform a Netval tape backup.
.sp;The Netval Archive sub-system is accessed by logging in to Netval,
and entering the ARCHIVE Command;
the operator may then access tape units and
store all Netval disk files from disk to tape.
The prompt for the ARCHIVE sub-system is:
.sp;.il 20;arch>
.sp;Once the user has entered the ARCHIVE sub-system,
.ur he may only enter Netval ARCHIVE commands (Section &archive).
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;* archive
.sp;arch>
.in;.cp end;.pushsect 'Netval Archive Commands'
.se archive='&sectno'
The Netval ARCHIVE sub-system allows the user to:
.in 12;.sp;.il -2;- attach a magnetic tape unit to the Netval slot
.il -2;- detach a magnetic tape unit from the Netval slot
.il -2;- store Netval disk files on tape in Netval ARCHIVE format
.il -2;- in addition, if the conditional flag INCLUDE_DUMP is enabled, dump the
Netval CUD to tape in ASCII format
.in;.sp;The prompt for the ARCHIVE sub-system is:
.sp;.il 20;arch>
.sp;Tape units may have the following status:
.sp;.cp begin;1.  ATTACHED
.br;An ATTACHED tape is accessible by users logged into the Netval SLOT only;
no other slot on the Netval Engine may access the tape unit.
.cp end;.sp 2;.cp begin;2.  ASSIGNED
.br;An ASSIGNED tape is reserved for a single Netval validator;
no other ARCHIVE validator may access the tape unit.
Only one tape unit may be assigned to a validator at a time.
During the period that a tape is assigned to a validator, it is also
attached to the Netval slot.
.cp end;.sp;Tape units may become ATTACHED and/or ASSIGNED explicitly
or implicitly.
.sp;If a tape unit is ATTACHED explicitly by the ATTACH command (Section
.ur &arattcmd), it remains ATTACHED until it is DETACHED explicitly by the
.ur DETACH command (Section &ardetcmd).
Any Netval ARCHIVE validator may use (and therefore may also DETACH)
an attached tape, as long as no other validator has the tape ASSIGNED.
.sp;If a tape unit is ASSIGNED explicitly to a validator by the ASSIGN command
.ur (Section &arasscmd), it remains ASSIGNED until the validator explicitly
.ur DEASSIGNS the unit by the DEASSIGN command (Section &ardeacmd) OR leaves
the Netval system (by logging out or becoming disconnected).
If a Netval user still has a tape ASSIGNED when he logs out,
Netval will notify him of the unit.
.sp;During any Netval ARCHIVE command that accesses a tape unit, the unit
is necessarily both ATTACHED and ASSIGNED for the validator
(implicitly if not by an explicit command).
If reserved implicitly, the tape unit is reserved for the Netval slot and the
validator FOR THE DURATION OF THE COMMAND ONLY.
At the completion of the command, the unit will have the same status as it
did before the command.
If the unit had previously been ATTACHED, it will remain ATTACHED.
.sp;When a validator enters or leaves the ARCHIVE sub-system he is shown a
summary of the status of all tape units in use;
.ur the DISPLAY STATUS command (Section &ardstcmd) may also be used to
see the summary.
.sp;The following commands may be executed from the ARCHIVE sub-system:
.in 5;.sp;.cp begin;ASSIGN        Reserve tape unit for validator
.br;ATTACH        Reserve tape unit for Netval slot
.br;DEASSIGN      Free tape unit from validator
.br;DETACH        Free tape unit from slot
.br;DISPLAY       Type tape availability or Netval tape id
.br;DUMP	  Dump CUD to tape in ASCII format
.br;RETURN        Return to system level
.br;REWIND        Return magnetic tape to beginning of reel
.br;STORE         Copy files from disk to tape
.in;.cp end;.pushsect 'ASSIGN Command'
.se arasscmd='&sectno'
.cp begin;Syntax:  ASsign u
.sp;The ASSIGN command reserves a magnetic
tape unit for the Netval ARCHIVE validator, and prevents any other
validators from accessing the tape unit.
The unit is reserved for the validator until the DEASSIGN
.ur (Section &ardeacmd) command is executed OR the validator leaves
the Netval system.
.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> assign 0
.sp;tape assigned
.sp;arch>
.in;.cp end;.nextsect 'ATTACH Command'
.se arattcmd='&sectno'
.cp begin;Syntax:  ATtach u
.sp;The ATTACH command reserves a magnetic tape unit
for the Netval slot, and prevents any other slots in the Netval Engine
from accessing the tape unit.
The unit is reserved for the Netval slot until the DETACH
.ur (Section &ardetcmd) command is executed.
.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> attach 0
.sp;tape attached
.sp;arch>
.in;.cp end;.nextsect 'DEASSIGN Command'
.se ardeacmd='&sectno'
.cp begin;Syntax:  DEAssign
.sp;The DEASSIGN command frees the tape unit from
the Netval ARCHIVE validator and makes it available to other validators.
Since a validator may only have one tape assigned at a time, it is not
necessary to supply the tape unit number.
.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> deassign
.sp;unit 0 deassigned
.sp;arch>
.in;.cp end;.nextsect 'DETACH Command'
.se ardetcmd='&sectno'
.cp begin;Syntax:  DETach u
.sp;The DETACH command frees the tape unit from
the Netval slot and makes it available to other slots in the Netval Engine.
.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> detach 0
.sp;tape detached
.sp;arch>
.in;.cp end;.nextsect 'DISPLAY ID Command'
.cp begin;Syntax:  DIsplay Id <u>
.sp;The DISPLAY ID command allows the validator to
identify a magnetic tape as a Netval backup tape, and to display
its creation date and version.
The tape is rewound initially, to read the first record.
.cp end;.sp;.cp begin;If the tape is already ASSIGNED to the validator,
"u" may be omitted.
If the validator had not ASSIGNED a tape unit, however,
"u" must specify the unit.
Since a validator may only have one unit assigned at a time,
if the validator already has a unit assigned, the display command
must refer to that assigned unit.
.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> display id
.sp;tape rewinding
.sp;mta is not a Netval tape
.cp end;.sp;.cp begin;arch> display id 1
.sp;tape rewinding
.sp;Netval tape (Version 03.05) created on: 02/08/83
.sp;arch>
.in;.cp end;.nextsect 'DISPLAY STATUS Command'
.se ardstcmd='&sectno'
.cp begin;Syntax:  DIsplay Status
.sp;The DISPLAY STATUS command gives the validator
a summary of current tape usage and availability.
It reports magnetic tape units in use, their status,
and, if ASSIGNED, the validator that the unit is assigned to.
.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> display status
.sp;unit
.sp;  0     ATTACHED
.br;  2                 ASSIGNED to ARCHIVEUSER
.sp;arch>
.in;.cp end;.nextsect 'DUMP Command'
.cp begin;Syntax:  DUmp <From block-no> <u>
.sp;If the conditional compilation flag INCLUDE_DUMP
is enabled in the Netval configuration file, the
DUMP command will be included in the Archive command sub-system.
.cp end;.sp;.cp begin;The DUMP command rewinds a tape unit, reads
all CUD entries, and writes the formatted ASCII CUD entries to tape.
If the parameter FROM is used, the DUMP will start at the specified
block-no, otherwise it will start at block zero.
.cp end;.sp;.cp begin;If the tape is already ASSIGNED to the validator,
the parameter "u" may be omitted.
If the validator had not ASSIGNED a
tape unit, however, "u" must specify the unit.
Since a validator may
only have one unit assigned at a time, if the validator already
has a unit assigned, the dump command must refer to that
assigned unit.
.cp end;.sp;A message is written to the operator log specifying
that the command was executed by the validator.
.sp;NOTE:  This command may be very time consuming.
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> dump
.sp;tape rewinding
.br;storing CUD ASCII dump: 115 records written
.sp;dump completed
.br;tape rewinding
.sp;arch>
.in;.cp end;.nextsect 'RETURN Command'
.se arretcmd='&sectno'
.cp begin;Syntax:  RETurn
.sp;The RETURN command takes the validator
back to system command level.
.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> return
.sp;*
.in;.cp end;.nextsect 'REWIND Command'
.cp begin;Syntax:  REWind <u>
.sp;The REWIND command allows the validator
to position a tape unit to the beginning of the reel.
.cp end;.sp;.cp begin;If the tape is already ASSIGNED to the validator,
"u" may be omitted.
If the validator had not ASSIGNED a tape unit, however,
"u" must specify the unit.
Since a validator may only have one unit assigned at a time,
if the validator already has a unit assigned, the rewind command
must refer to that assigned unit.
.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> rewind
.sp;tape rewinding
.sp;tape rewound
.sp;arch>
.in;.cp end;.nextsect 'STORE Command'
.se arstocmd='&sectno'
.cp begin;Syntax:  STOre <u>
.sp;The STORE command rewinds a tape unit,
and records all disk files on the tape.
.cp end;.sp;.cp begin;If the tape is already ASSIGNED to the validator,
"u" may be omitted.
If the validator had not ASSIGNED a tape unit, however,
"u" must specify the unit.
Since a validator may only have one unit assigned at a time,
if the validator already has a unit assigned, the store command
must refer to that assigned unit.
.cp end;.sp;NOTE:  This may be a very time consuming command
since the entire CUD is stored.
.sp;A message is written to the operator log specifying
that the command was executed by the operator.
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> store
.sp;tape rewinding
.sp;storing configuration: 1 records written
.br;storing node_host(header): 1 records written
.br;storing node_host(hostlists): 45 records written
.br;storing node_host(nodelists): 55 records written
.br;storing node_host(classes): 23 records written
.br;storing node_host(groups): 8 records written
.br;storing mud_update: 1 records written
.br;storing CUD: 2039 records written
.br;storing CUD_PARAMETER: 1 records written
.sp;store completed
.br;tape rewinding
.sp;arch>
.in;.cp end;.popsect 1 'Backup Procedure'
Tape Backups are obtained by executing the STORE command in the
Netval archive sub-system.
.sp;The following describes the process in more detail:
.in 4;.sp 2;.cp begin;.il -4;1.  Determine the tape unit number to be used,
and mount a scratch magnetic tape on the drive.
.cp end;.sp;.cp begin;.il -4;2.  Enter the Netval archive sub-system by
entering the ARCHIVE Command.
.cp end;.sp;.cp begin;.il -4;3.  If Netval is the only slot running
in the Engine, there is no need to reserve a tape unit for Netval.
If there is other code running in the Engine that might access
the tape unit during a backup operation,
.ur it is safest to use the ATTACH Command (Section &arattcmd) to reserve
the tape unit for the Netval slot.
.cp end;.sp;.cp begin;If there may be other users logged into the Netval slot
that may also be performing tape operations,
.ur it is safest to use the ASSIGN Command (Section &arasscmd).
This command will insure that no other Netval users will access the tape unit.
.cp end;.sp;.cp begin;.il -4;4.  Backup the Netval disk data to tape by
.ur executing the STORE Command (Section &arstocmd).
.cp end;.sp;.cp begin;.il -4;5.  If the ATTACH Command was used,
.ur execute the DETACH Command (Section &ardetcmd);
if the ASSIGN Command was used, execute the DEASSIGN Command
.ur (Section &ardeacmd).
.in;.cp end;.popsect 1 'NVDM File Restores'
This Section describes the NVDM Archive Sub-system commands, and the procedure
used to restore Netval files to disk from tape.
.sp;NVDM (Netval Disk Maintenance) is a companion program to Netval that is
used to perform disk initialization and various other disk utility funcitons.
Its Archive sub-system is used to restore files from
Netval Archive tapes to disk.
.sp;The NVDM Archive sub-system is accessed by logging in to NVDM,
and entering the ARCHIVE Command;
the operator may then access tape units and
restore one or more Netval files from tape to disk.
The prompt for the ARCHIVE sub-system is:
.sp;.il 20;arch>
.sp;Once the user has entered the ARCHIVE sub-system,
.ur he may only enter NVDM ARCHIVE commands (Section &iarchive).
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;* archive
.sp;arch>
.in;.cp end;.pushsect 'NVDM Archive Commands'
.se iarchive='&sectno'
The Disk Maintenance ARCHIVE sub-system allows the user to:
.in 12;.sp;.il -2;- attach a magnetic tape unit to the slot
.il -2;- detach a magnetic tape unit from the slot
.il -2;- restore all files from a Netval ARCHIVE tape to disk
.il -2;- restore a specific file from a Netval ARCHIVE tape to disk
.in;.sp;The prompt for the ARCHIVE sub-system is:
.sp;.il 20;arch>
.sp;If a tape unit is ATTACHED by the ATTACH command (Section
.ur &iarattcmd), it remains ATTACHED to the slot (and therefore not accessible
by other slots) until it is DETACHED by the
.ur DETACH command (Section &iardetcmd).
.sp;The following commands may be executed from the ARCHIVE sub-system:
.in 5;.sp;.cp begin;ATTACH        Reserve tape unit for Netval slot
.br;DETACH        Free tape unit from slot
.br;DISPLAY       Type Netval tape id
.br;RESTORE       Copy file(s) from tape to disk
.br;RETURN        Return to system level
.br;REWIND        Return magnetic tape to beginning of reel
.in;.cp end;.pushsect 'ATTACH Command'
.se iarattcmd='&sectno'
.cp begin;Syntax:  Attach u
.sp;The ATTACH command reserves a magnetic tape unit
for the Netval slot, and prevents any other slots in the Netval Engine
from accessing the tape unit.
The unit is reserved for the Netval slot until the DETACH
.ur (Section &iardetcmd) command is executed.
.cp end;.sp;"u" must specify the tape unit.
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> attach 0
.sp;tape attached
.sp;arch>
.in;.cp end;.nextsect 'DETACH Command'
.se iardetcmd='&sectno'
.cp begin;Syntax:  DEtach u
.sp;The DETACH command frees the tape unit from
the Netval slot and makes it available to other slots in the Netval Engine.
.cp end;.sp;"u" must specify the tape unit.
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> detach 0
.sp;tape detached
.sp;arch>
.in;.cp end;.nextsect 'DISPLAY Command'
.cp begin;Syntax:  DIsplay u
.sp;The DISPLAY command allows the user to
identify a magnetic tape as a Netval backup tape, and to display
its creation date and version.
The tape is rewound initially, to read the first record.
.cp end;.sp;"u" must specify the tape unit.
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> display 0
.sp;tape rewinding
.sp;mta is not a Netval tape
.cp end;.sp;.cp begin;arch> display 1
.sp;tape rewinding
.sp;Netval tape (Version 03.05) created on: 02/08/83
.sp;arch>
.in;.cp end;.nextsect 'RESTORE Command'
.se restcmd='&sectno';.fo no
.cp begin;Syntax:  REStore [All|CUD <Block b1<-b2>>|Mudupdate|Node|Operlog] u
.fo yes;.sp;The RESTORE command rewinds the tape unit
specified, identifies the tape as a Netval tape, asks the user to confirm,
then restores one or more tape files to the disk.
.cp end;.sp;"u" must specify the tape unit.
.sp;If the parameter ALL is entered,
all files on the tape will be written to the disk.
.sp;.cp begin;If the parameter CUD is entered without the BLOCK parameter,
the entire CUD and CUD parameter files will be restored from tape to disk.
If the BLOCK parameter is included, only the CUD blocks in the range
"b1" through "b2" will be restored; a single block, "b1" may be specified.
.cp end;.sp;If the parameter MUDUPDATE is entered, the MUDUPDATE header only
will be written to the disk.
.sp;If the parameter NODE is entered, the file describing the named node and
host lists and class and group definitions will be written to the disk.
.sp;If the parameter OPERLOG is entered, the file containing system messages
will be written to the disk.
.sp;.cp begin;NOTE:  Restoring the CUD file may be very time
consuming; interrupting any restore will have uncertain results.
.cp end;.sp;.cp begin;Since the RESTORE command should only be used under
catastrophic circumstances, some effort has been taken to help the user
avoid errors:
.in 7;.cp end;.sp;.cp begin;.il -2;- All Supervisors are set to OFF when
the MUDUPDATE file is restored.
They must be redefined with the Netval SET SUPERVISOR command.
If the configuration parameter RUN_AUTO_CONSISTENCY_ON_SUP_INIT
is set to TRUE, an automatic consistency is run when the SET SUPERVISOR
command is executed.
The restored CUD SHOULD BE CHECKED FOR CORRECTNESS BEFORE ANY SUPERVISORS
ARE TURNED ON, or any errors in the CUD will be transferred to each MUD.
Since the usernames UN2 and SYSMSG1 are required to be valid for the
successful running of Netval, one check is that these two names are valid
in the CUD.
.cp end;.sp;.cp begin;If the configuration parameter
RUN_AUTO_CONSISTENCY_ON_SUP_INIT is FALSE, manual consistencies should
be run on each MUD.
.cp end;.sp;.cp begin;.il -2;- The ARCHIVE STORE/RESTORE operation does not
maintain the CUD changes stored in the MUD CHANGE file.
Since consistencies are run, all changes made to the CUD will be transmitted
to each MUD, but of course, any changes made after the STORE and before the
RESTORE will be lost.
.cp end;.sp;.cp begin;.il -2;- The CLASS/GROUP TABLE LAST CREATED date
is cleared.
The ARCHIVE system does not record the Class and Group table from Netval's
disk to the ARCHIVE tape (the named node and host lists and Class and
Group definitions, however, are recorded).
After the RESTORE operation, Class, Group, nodelist and hostlist
definitions should be checked for validity and a SEND command executed.
.in;.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.sp;arch> restore all 0
.sp;tape rewinding
.sp;Netval tape (Version 03.05) created on: 02/08/83
.sp;.fo no;okay? y
.sp;restoring node_host(header): records read: 1  records written: 1
.br;restoring node_host(hostlists): records read: 45  records written: 45
.br;restoring node_host(nodelists): records read: 55  records written: 55
.br;restoring node_host(classes): records read: 23  records written: 23
.br;restoring node_host(groups): records read: 8  records written: 8
.br;restoring oper_log: records read: 256  records written: 256
.br;restoring mud_update: records read: 1  records written: 1
.br;restoring CUD: records read: 2039  records written: 2039
.br;restoring CUD_PARAMETER: records read: 1  records written: 1
.br;.fo yes;tape rewinding
.sp;arch>
.cp end;.nextsect 'RETURN Command'
.cp begin;Syntax:  RETurn
.sp;The RETURN command takes the user
back to system command level.
Be sure to DETACH any tape units no longer needed.
.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> return
.sp;*
.in;.cp end;.nextsect 'REWIND Command'
.cp begin;Syntax:  REWind u
.sp;The REWIND command allows the user
to position a tape unit to the beginning of the reel.
.cp end;.sp;"u" must specify the tape unit
.sp 2;.cp begin;A sample command/response sequence is:
.in 10;.sp;arch> rewind 0
.sp;tape rewinding
.sp;tape rewound
.sp;arch>
.in;.cp end;.popsect 1 'File Restore Procedure'
Tape file restores are obtained by executing the RESTORE command in the
NVDM archive sub-system.
.sp;The following describes the process in more detail:
.in 4;.sp;.cp begin;.il -4;1.  Determine the tape unit number to be used,
and mount the appropriate backup tape on the drive.
.cp end;.sp;.cp begin;.il -4;2.  Enter the NVDM archive sub-system by
entering the ARCHIVE Command.
.cp end;.sp;.cp begin;.il -4;3.  If NVDM is the only slot running
in the Engine, there is no need to reserve a tape unit for NVDM.
If there is other code running in the Engine that might access
the tape unit during a backup operation,
.ur it is safest to use the ATTACH Command (Section &iarattcmd) to reserve
the tape unit for the NVDM slot.
.cp end;.sp;.cp begin;.il -4;4.  Execute the RESTORE Command
.ur (Section &restcmd) to restore the file(s) required.
.cp end;.sp;.cp begin;.il -4;5.  If the ATTACH Command was used,
.ur execute the DETACH Command (Section &iardetcmd).
.in;.cp end;.popsect 1 'Logical Volumes'
Note:  If the configuration parameter LOGICAL_VOLUMES is ENabled in the Netval
configuration file, NVAL03.A##, the information in this Section applies
to Netval.
.pushsect 'Logical Volume Overview'
.sp 3;.ce;Physical Layout of Files
.sp;If logical volumes are used in Netval (enabled in the Configuration file,
and defined in the TYM file), the Engine must have 2 physical disk drives.
An ISIS logical unit is defined on each physical drive for the CUD and
file system.
The CUD logical units include the CUD and the CUD parameter file;
the FILE SYSTEM logical units include all other Netval files.
The 2 CUD units must be defined as the same number of cylinders in the DSC
file;
the 2 file system units must be defined as the same number of cylinders in
the DSC file.
.in 3;.sp 2;.cp begin;.fo no;
     Physical Drive 0                  Physical Drive 1
      (incarnation 0)                   (incarnation 1)
 _________________________          ________________________
/  UNIT 0       UNIT 1    \        /  UNIT 2       UNIT 3   \
|           |             |        |           |             |
|    CUD,      Config,    |        |    CUD       Config,    |
| CUD param |  Node/host, |        | CUD param |  Node/host, |
|             Class/group,|        |             Class/group,|
|           | Mud change, |        |           | Mud change, |
|             Operator Log|        |             Operator Log|
\___________|_____________/        \ __________|_____________/
    |              |                        ^           ^
    |              |                        |           |
    |               \______________________ |  _________/
    \ ______________________________________/
.in;.fo yes;.cp end;.sp 3;.ce;Logical Volume I/O
.sp;Each physical drive is referred to as an INCARNATION of the Netval files.
The logical volume system normally performs all requested writes to each
incarnation;
reads are normally executed from the more efficient copy.
In this way, 2 copies of all Netval information is maintained.
.sp 3;.ce;Incarnation States
.sp;Incarnations are defined to be in one of a number of states, which
indicates the I/O operations which are currently sent to it:
.in 20;.sp;.cp begin;
.il -15;unknown        the initial state of both incarnations
.il -15;read/write     the normal UP state; reads and writes may occur
on the incarnation
.il -15;write only     the state of an incarnation being copied to
.il -15;read only      the state of an incarnation with write errors;
only read operations may occur on the incarnation
.il -15;down           the incarnation is physically down; no read or write
operations may occur on the incarnation
.il -15;offline        set by the SET DRIVE OFFLINE Command; no read or write
operations may occur on the incarnation
.in;.cp end;.sp;Under normal conditions,
all incarnations should be in the read/write state.
If the system has been unable to complete a read or write operation to a
logical disk unit on a particular drive, it will change the logical disk
unit's state to down.
When Netval detects that a logical disk unit is down it will automatically
set the other logical disk unit from the same drive to offline.
At this time the entire drive is considered to be down by Netval.
The SET DRIVE OFFLINE Command allows a user to specify an entire drive
to offline.
.sp;The system will send no further I/O requests to a drive which is
down or offline.
Once a drive is down or offline, the COPY Command must be
executed in order to restore the drive to the read/write state.
.sp 3;.ce;System Initialization
.sp;When Netval first comes up, it must be determined which incarnation is the
most recent.
There is a time stamp recorded on each writable incarnation periodically.
Initially, both incarnations are set to the unknown state.
.sp;If the time stamps are the SAME on both incarnations, then Netval makes the
arbitrary decision that incarnation 0 will be considered the most reliable;
incarnation 0 is set to read/write, incarnation 1 is set to write only,
Netval is initialized, validators may start to log in, and all information
is copied from incarnation 0 to incarnation 1.
This guarantees that Netval
starts up with exactly duplicate information on both incarnations.
.sp;If the time stamps recorded are NOT the same on both incarnations, Netval
will not make a decision about which is the more up-to-date copy.
This is because there may be an offline disk pack that is more recent than
those on the system, and Netval will give the operator the chance to decide
which disks Netval will come up with.
.nextsect 'Logical Volume Commands'
The COPY, DISPLAY VOLUMES, and SET DRIVE OFFLINE Commands are available
to the operator for maintaining the logical volume system.
The following Sections describe these commands.
.pushsect 'COPY Command'
.cp begin;Syntax:  COPy
.sp;The COPY Command causes data to be read from one physical disk
(in the read/write state) and copied to the same sectors on the other
physical disk (in the down or offline state).
Once the copy operation starts, the state of the disk being copied TO is
changed to write only.
At the end of the COPY Command, the state of the disk being copied TO
is changed to read/write.
Execution of the COPY Command is the only way that a drive that is not being
used by the logical volume system can be brought back to the read/write state.
.cp end;.sp;.cp begin;If neither disk is down or offline,
the user receives the error message:
.sp;.ce;one disk must be down or offline
.cp end;.sp;.cp begin;If a copy is already being performed on the system,
the user receives the message:
.sp;.ce;A copy is already in progress
.cp end;.sp;If the above criteria are satisfied,
the COPY Command displays logical
volume information, and prompts for confirmation of the direction of the copy.
The logical volume information includes information from the DISPLAY VOLUMES
Command, the direction of the copy, and the age of the FROM disk.
The age should always be CURRENT.
.sp;When Netval receives confirmation, the copy will be TO the
disk which Netval detects is down or offline.
.sp;Periodically, the number of the sector being copied is displayed.
.sp;A message is written to the operator log specifying
that the command was executed by the operator.
.sp 2;.cp begin;A sample command/response sequence is:
.sp;* copy
.fo no;.sp;
Drive 0    Legal: yes   State: read/write  Time Stamp: 1/22/85 08:40
Drive 1    Legal: no    State: offline     Time Stamp: unknown
.sp;the direction of the copy will be from drive 0 to drive 1
.br;the source Netval disk is 1 hour 20 minutes old
.br;continue? y
.sp;copying to unit: 2
10000 20000 30000 . . . (etc.)
.sp;copying to unit: 3
10000 20000 30000 . . . (etc.)
.sp;Copy complete
.sp;*
.fo yes;.cp end;.nextsect 'DISPLAY VOLUMES Command'
.cp begin;Syntax:  DIsplay Volumes
.sp;The DISPLAY VOLUMES Command types current logical volume information.
It can be used to monitor the current drive states.
.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.fo no;.sp;* display volumes
.sp;Drive 0:   legal: yes  State: read/write  Time Stamp: 1/22/85 08:40
Drive 1:   legal: yes  State: read/write  Time Stamp: 1/22/85 08:40
.sp;*
.fo yes;.cp end;.sp;.cp begin;A description of the terminology follows:
.in 5;.sp;.il -5;legal
.br;A legal disk is one which has a Netval identifier and the current
Netval configuration.
.cp end;.sp;.cp begin;.il -5;State
.fo no;Logical volume disk states are as follows:
unknown          when Netval comes up, state is unknown
down             the disk is not sent any requests (set by
                    the Pascal Nucleus)
read/write       the disk is sent read and write requests
read only        the disk is only sent read requests
write only       the disk is only sent write requests
offline          the disk is not sent any requests (set by
                    the SET DRIVE OFFLINE Command)
.fo yes;.cp end;.sp;.cp begin;.il -5;Time Stamp
.br;The Time Stamp identifies the last moment at which the system verified
the legitimacy of the disk's database.
When a disk is down or offline the Time Stamp is not updated;
otherwise, it is updated at 30 second intervals.
If a disk is not legal, it has no Time Stamp.
.in;.cp end;.nextsect 'SET DRIVE OFFLINE Command'
.cp begin;Syntax:  SET Drive d OFFLine
.sp;The SET DRIVE OFFLINE Command sets drive "d" to the offline state;
it should be used by an operator when a drive is known to be faulty, the data
on a disk is suspect, or when preparing to remove a pack from the system.
Normally, the system will detect error conditions and respond by bringing the
problem drive down.
.cp end;.sp;.cp begin;Once the command has been executed,
the old pack may be removed,
and a new pack mounted on the drive.
The COPY Command is then used to bring the pack up-to-date and to change
the drive back to the read/write state.
.cp end;.sp;.cp begin;One Netval drive must always be on-line
for the system to run;
therefore, if one drive is already in the down or offline state,
when the command is entered, Netval responds:
.sp;.ce;one drive is already down or offline
.cp end;.sp;This command MUST be used before changing Netval disk packs.
.sp;Note:  Never power a disk down before executing the SET DRIVE OFFLINE
Command.
.sp;A message is written to the operator log specifying
that the command was executed by the operator.
.fo no;.sp 2;.cp begin;A sample command/response sequence is:
.sp;* set drive 1 offline
.sp;restoration to read/write state requires execution of the COPY command
.br;continue? y
.sp;entry completed
.sp;*
.fo yes;.cp end;.popsect 1 'STATISTICS Command'
In addition to the specific logical volume commands
described in the preceding Sections, the Netval STATISTICS command displays
additional information if logical volumes are used.
.cp begin;Syntax:  STAtistics
.sp;The Netval program maintains a histogram
of recent disk activity in 5 minute intervals; the STATISTICS
Command displays this information to the user.
.cp end;.sp 2;.cp begin;A sample command/response sequence is:
.sp;* statistics
.fo no;since 1/31/84 19:46:55 GMT
.sp;read   total: 8742   pages: 816291
.br;3     4     3     3     4     3     3     4     6     3     4     21
.sp;write   total: 8304   pages: 813823
.br;3     4     3     3     4     3     3     4     7     3     4     6
.sp;drive 0:
.br; unit 0:   reads: 1010   writes: 86   state: read/write
.br;           errors: 0   last error: 0   last isis: 0
.sp; unit 1:   reads: 7732   writes: 81   state: read/write
.br;           errors: 0   last error: 0   last isis: 0
.br;drive 1:
.br; unit 2:   reads: 5   writes: 1073   state: read/write
.br;           errors: 0   last error: 0   last isis: 0
.sp; unit 3:   reads: 91   writes: 7231   state: read/write
.br;           errors: 0   last error: 0   last isis: 0
.sp;*
.fo yes;.cp end;.sp 2;The output of the STATISTICS Command displays information
on I/O for EACH logical unit.
The error information can be used to help determine the state of a drive or
disk pack.
.nextsect 'System Start-Up'
When the Netval slot is loaded or restarted, Netval determines the
most up-to-date drive by comparing the time stamps on the two incarnations.
The most recent time stamp should be approximately the time when the engine
or slot was last brought down.
If it is not, then it is possible that a disk pack was
removed while Netval was down.
.pushsect 'Automatic Start-up'
If the time stamps are the same, the system is initialized, an automatic copy
is started, and users may login.
Messages about the copy are written to the operator log.
.nextsect 'Operator Assisted Start-up'
.se operassis='&sectno'
.cp begin;If the time stamps are not the same,
only the programmer or NVDM operator
may login; other validators attempting to login will receive the message:
.sp;.ce;Netval has not been initialized, no unprivileged logins allowed
.cp end;.sp;When the programmer or NVDM operator logs in,
they will receive a message
specifying information about the current status of the disks, the proposed
direction of the copy, and a request for confirmation.
For example:
.in 5;.fo no;
.sp;.cp begin;logical volumes have not been initialized, current status is:
.sp;Drive 0   legal: yes   State: unknown   Time Stamp: 6/28/85 16:20
Drive 1   legal: yes   State: unknown   Time Stamp: 6/28/85 18:24
.sp;the direction of the copy will be from drive 1 to drive 0
the source Netval disk is 1 hour 22.32 minutes old
continue?
.in;.fo yes;.cp end;.pushsect 'Confirmation Procedure'
If the operator determines that the latest Netval
data is on the FROM drive, a "yes" should be entered.
In this case, the TO drive will be set to write only, the FROM
drive will be set to read/write, Netval will be initialized so that other
validators may log in, and a copy operation will begin.
.sp;Netval will notify the user of its progress with output as in the
COPY Command.
.sp;When the copy is complete, the TO disk will be set to read/write,
and the user will be logged out.
.sp 2;.cp begin;The following is a sample sequence:
.sp;logical volumes have not been initialized, current status is:
.sp;Drive 0   legal: yes   State: unknown   Time Stamp: 6/28/85 16:20
Drive 1   legal: yes   State: unknown   Time Stamp: 6/28/85 18:24
.sp;the direction of the copy will be from drive 1 to drive 0
the source Netval disk is 1 hour 22.32 minutes old
continue? yes
.sp;Netval initializing
.sp;copying to unit: 0
.br;10000 20000 30000 . . . (etc.)
.sp;copying to unit: 1
.br;10000 20000 30000 . . . (etc.)
.sp;Copy complete
.br;Netval initialized
.sp;please login:
.cp end;.nextsect 'Change Disk Pack Procedure'
If the operator determines that there is another disk pack that contains
more recent Netval data, he should enter "no."
In this case, a disk pack may be
removed and another mounted which has the more current Netval data.
THIS IS THE ONLY TIME IT IS CORRECT TO REMOVE A DISK PACK WHICH IS NOT
IN THE DOWN OR OFFLINE STATE.
.sp;When the new pack is mounted and ready for Netval to access it,
the operator should press <carriage return> to have the disks reevaluated.
If the dates reported are more reasonable, a "yes" should be entered,
and Netval will proceed as in the preceding Section.
.sp 2;.cp begin;The following is a sample sequence:
.sp;.fo no;logical volumes have not been initialized, current status is:
.sp;Drive 0   legal: yes   State: unknown   Time Stamp: 6/28/85 16:20
Drive 1   legal: yes   State: unknown   Time Stamp: 6/28/85 18:24
.sp;the direction of the copy will be from drive 1 to drive 0
the source Netval disk is 1 hour 22.32 minutes old
continue? no
.sp;If it is necessary to bring the system up with a single disk,
press the escape key.
.sp;THIS IS ONLY A CORRECT PROCEDURE IF ONE DRIVE IS UNUSABLE.
.sp;Else, press carriage return when you are ready to have the disks
reevaluated.
.sp;<carriage return>
.sp;logical volumes have not been initialized, current status is:
.sp;Drive 0   legal: yes   State: unknown     Time Stamp: 6/28/85 19:31
Drive 1   legal: yes   State: unknown     Time Stamp: 6/28/85 18:24
.sp;the direction of the copy will be from drive 0 to drive 1
the source Netval disk is 19 minutes old
continue? y
.sp;Netval initializing
.sp;copying to unit: 0
.br;10000 20000 30000 . . . (etc.)
.sp;copying to unit: 1
.br;10000 20000 30000 . . . (etc.)
.sp;Copy complete
Netval initialized
.sp;please login:
.fo yes;.cp end;.nextsect 'Come Up With One Disk Procedure'
If one drive is unusable and it is impractical
to keep the system down until the problem is corrected,
the operator may decide to bring the system up with a single drive.
In this case, he should enter "no," then press an <escape> to indicate that
Netval should be initialized and come up with a single drive.
.sp 2;.cp begin;The following is a sample sequence:
.sp;.fo no;logical volumes have not been initialized, current status is:
.sp;Drive 0   legal: yes   State: unknown   Time Stamp: 6/28/85 16:20
Drive 1   legal: yes   State: unknown   Time Stamp: 6/28/85 18:24
.sp;the direction of the copy will be from drive 1 to drive 0
the source Netval disk is 1 hour 22 minutes old
continue? no
.sp;If it is necessary to bring the system up with a single disk,
press the escape key.
.sp;THIS IS ONLY A CORRECT PROCEDURE IF ONE DRIVE IS UNUSABLE.
.sp;Else, press carriage return when you are ready to have the disks
reevaluated.
.sp;<escape>Netval initializing
Netval initialized
.sp;please login:
.fo yes;.cp end;.sp 2;The drive with the more recent data on it
will be put into the read/write state;
the other drive will remain in the unknown state.
.sp;Bringing Netval up with a single drive will cause
response to be a little slower,
and the system is more vulnerable to disk failures.
The second drive should be brought up as soon as possible.
.sp;When it is time to bring up the second drive,
and the drive has a pack mounted and ready, the COPY Command is used
to copy all Netval data to the pack and the drive is brought up to the
read/write state.
.popsect 2 'Disk Pack Backup Procedure'
In order to retrieve a backup disk pack, a drive is set offline,
the pack is physically
switched with a new pack and a COPY Command is executed.
IT IS VERY IMPORTANT TO SET A DRIVE OFFLINE BEFORE REMOVING ITS DISK PACK.
.sp;The following describes the process in more detail:
.in 4;.sp 2;.il -4;1.  Enter the DISPLAY VOLUMES Command
to determine the current state of the drives.
In order to retrieve a backup disk pack,
both drives must be in the read/write state.
.sp;If one drive is not in the read/write state, it may have been brought down
by the system because of a read or write failure.
A backup pack may not be retrieved at this point,
since the down pack is probably out-of-date.
A COPY Command should be attempted in order to bring the down pack back
into the system; if it fails or the integrity of the drive or pack
is questionable, the hardware problems should be checked out.
.sp;.il -4;2.  If both drives are in the read/write state, set one of
the drives offline with the SET DRIVE OFFLINE Command.
The pack on the drive that is set offline will be the backup pack;
it is an arbitrary decision as to which pack is chosen.
.sp;.il -4;3.  Remove the disk pack from the drive which has
been set offline and replace it with a new pack.
.sp;.il -4;4.  Enter the COPY Command.
The copy will be in the direction from the current read/write drive to
the offline drive.
As Netval executes the copy it will report its progress to the terminal.
The start and end of the Copy command is also reported to the operator log,
.ur and can be seen by entering the Message command (Section &namesscmd).
.in
   a