     

                     DOWNSTREAM LOADING TROUBLESHOOTING
                             (CES:33)DSLTRB.DOC
     
     THE EXPERIENCE TO DATE WITH DOWNSTREAM LOADING SUGGESTS THAT SOME
     FACTORS SHOULD BE EXPLAINED IN A LITTLE MORE DETAIL.  ALSO WE HAVE
     GAINED SOME EXPERIENCE WITH USING IT AND HAVE DISCOVERED PROBLEMS.
     I FEEL THAT ALL THINGS CONSIDERED IT HAS GONE WELL.  NOW TO THE
     DETAILS.
     
     FIRST I WISH TO GO OVER SOME OF THE EXTERNAL FACTORS INVOLVED IN DOING
     A DOWNSTREAM LOAD.  I WILL START WITH THE HOST PROGRAM BUILDING A 
     CIRCUIT.  
     
       A REQUEST IS MADE THROUGH THE PDP-10 MONITOR FOR AN AUXILIARY
       CIRCUIT.  THE MONITOR MAY NOT HONOR THIS REQUEST IF THE PROGRAM DOES
       NOT HAVE THE PROPER LICENSE TO MAKE SUCH A REQUEST.  THE REASON
       IS THAT NOT EVERYONE SHOULD BE ALLOWED TO USE SUCH CIRCUITS.  THE
       NLOAD PROGRAM HAS THIS LICENCE AS IT IS INSTALLED IN THE NETCON
       DIRECTORY ON SYSTEMS 33 AND 36. SOMETIME THESE PROGRAMS MAY BE RELOADED
       BECAUSE OF SYSTEM PROBLEMS AND THEY WILL NOT HAVE THE LICENSE.
       THIS IS NOT A VERY LIKELY THING TO HAPPEN.  IF IT DOES, CONTACT
       EITHER DAVE SMITH OR DAN LASATER.
     
       IF THE MONITOR ACCEPTS THE REQUEST,  THE BASE IS ASKED FOR AN AUX
       CIRCUIT ON AN AVAILABLE PORT.  THIS IS ESSENTIALY PASSED ON TO
       THE SUPERVISOR IN A FASHION SIMILAR TO A LOG IN.  AT THIS
       POINT SEVERAL THINGS CAN HAPPEN.  THE BASE MAY NOT HAVE ANY PORTS
       AVAILABLE.  THE BASE MAY NOT BE TALKING TO THE SUPERVISOR.  THE
       SUPERVISOR MAY BE TOO BUSY TO BUILD AN AUX CIRCUIT.  THE LINES ON
       THE BASE MAY ALL BE SHUT.  THE SUPERVISOR MAY NOT BE ABLE TO BUILD
       A CIRCUIT TO THE NEIGHBOR NODE BECAUSE ALL OF ITS LINES ARE SHUT
       OR IT IS NETWORK ISOLATED BY OTHER MACHINES WHOSE LINES ARE SHUT
       OR OUT.  SIMILAR SORTS OF THINGS MAY HAPPEN IF THE NEIGHBOR NODE
       DOES NOT HAVE PASSTHRUS OR IS ISOLATED BY OTHER MACHINES THAT DON'T
       HAVE PASSTHRUS.  WATCH OUT FOR COMBINATIONS OF THESE THINGS.  ALL
       THAT YOU WILL SEE IF ANY OF THESE THINGS HAPPEN IS A MESSAGE
       TELLING YOU THAT IT IS UNABLE TO BUILD AN AUX CIRCUIT.  MOST OF 
       THESE PROBLEMS CAN BE PREVENTED BY CAREFUL OBSERVATION AND PLANNING.
     
       ONCE THE SUP HAS DETERMINED THAT IT CAN BUILD A CIRCUIT, IT PROCEEDS
       TO DO JUST THAT.  THERE IS A SMALL CHANCE THAT IT CANNOT FINISH
       DUE TO A SUDDEN FAILURE IN THE NETWORK.  ONE OTHER THING THAT 
       HAS BEEN OBSERVED IS THAT THE SUP IS SLOW TO TELL THE BASE THAT
       THE CIRCUIT IS COMPLETE. (THE PDP-10 MONITOR WAITS ONLY A CERTAIN
       AMOUNT OF TIME FOR THE CIRCUIT TO BE MADE BEFORE GIVING UP.) THIS
       ALSO RESULTS IN A MESSAGE TELLING YOU THAT THE PROGRAM IS UNABLE
       TO BUILD AN AUX CIRCUIT.  YOU'LL HAVE TO TRY AGAIN.
     
       IF NONE OF THE ABOVE PROBLEMS HAPPEN AND WE HAVEN'T FOUND A NEW ONE,
       YOU WILL BE INFORMED THAT YOU HAVE AN AUX CIRCUIT AND WHAT PORT IT
       IS ON. THIS PORT NUMBER IS A HOST PORT NUMBER.  IT IS RELATED
       TO THE PORT NUMBERS SHOWN ON A "CT" FROM PROBE ON THE BASE BUT
       IT IS NECESSARY TO DO SOME ARITHMETIC ON THE NUMBERS TO MATCH THEM
       UP.  IT IS GIVEN MAINLY AS AN AID IN DETERMINING HOST PROBLEMS.
     

       AT THIS POINT THE NEIGHBOR NODE HAS BEEN INFORMED BY THE SUPERVISOR
       THAT THERE IS A DOWNSTREAM LOAD CIRCUIT AND WHERE THAT CIRCUIT
       IS COMING FROM, BUT THE NEIGHBOR HAS NO IDEA WHERE THE DATA IS
       TO BE SENT.  HOWEVER, THE NODE DOES KNOW IF IT IS ALREADY DOING A LOAD
       ON SOME LINE.  IF IT IS, THE NODE WILL IMMEDIATELY SEND A ZAPPER
       DOWN THE CIRCUIT TO PREVENT MORE THAN ONE LOAD FROM BEING DONE
       FROM A PARTICULAR NODE.  IF THE HOST PROGRAM FINDS THAT THE CIRCUIT
       IS ZAPPED IT WILL TELL YOU AND EXIT.
     
       IF THE NEIGHBOR NODE IS NOT DOING ANOTHER LOAD ALREADY, IT SIMPLY
       WAITS FOR THE HOST TO TELL IT WHAT LINE IT IS TO TRANSMIT THE DATA
       ON. THE HOST WILL SEND ONE BYTE OF DATA CONTAINING THE LINE
       NUMBER THAT YOU HAVE REQUESTED TO TRANSMIT ON.  THE HOST THEN WAITS,
       WHEN THE NODE RECEIVES THE LINE NUMBER, IT DETERMINES IF THE LINE
       IS OUT.  (LINE OUTAGE IS DETERMINED BY THE SAME LOGIC AS THE LINOUT
       REPORTS IN THE CONSOLIDATOR LOG).  IF THE LINE IS NOT OUT, THE NODE
       WILL RETURN A ZAPPER TO THE HOST TERMINATING THE LOAD REQUEST.  IF
       THE LINE IS OUT THE NODE RETURNS THE LINE NUMBER TO THE HOST.
       (A ZAPPER IS ALSO SENT IF THE LINE NUMBER IS OUT OF RANGE) WHILE THE
       LINE NUMBER IS RETURNING TO THE HOST, THE NEIGHBOR NODE
       WILL GIVE UP CONTROL OF THE LINE TO THE HOST PROGRAM.  THIS IS WHY
       THE LINE WILL GO SILENT.
     
       THE HOST PROGRAM WILL INFORM YOU THAT THE NEIGHBOR HAS ACKNOWLEGED THE
       REQUEST AND SEND THE LOADER DOWN.  THE LOADER IS SENT AS A GROUP
       OF 33 WORD BLOCKS.  THE NEIGHBOR NODE SIMPLY ACCUMULATES THE DATA INTO
       33 WORD BLOCKS AND TRANSMITS IT.  IT IS ALSO LOOKING TO RECEIVE A 
       SPECIAL PATTERN ON THE LINE TO SIGNAL THE BEGINNING OF A BLOCK OF
       DATA FOR THE HOST.  THE ONLY OTHER INVOLVEMENT OF THE NEIGHBOR NODE
       IS THAT IT LOOKS FOR A CIRCUIT ZAPPER.  IF IT RECEIVES ONE IT RETAKES
       CONTROL OF THE LINE AND RETURNS IT TO ITS NORMAL STATE.
       (TRANSMITTING RESET PATTERNS).
      
       WHEN THE HOST HAS TRANSMITTED ALL OF THE BOOTSTRAP, IT WAITS FOR
       THE ACKNOWLEGEMENT FROM THE LOADER.  THIS IS A CRITICAL POINT AND
       HAS BEEN KNOWN TO CAUSE MANY PEOPLE GREAT STRESS.  SEVERAL THINGS
       CAN HAPPEN.  THE LINE MAY NOT BE WORKING. THE BOOTSTRAP MAY NOT
       BE LOADED OR MAY NOT BE LOOKING ON THE CORRECT LINE.  THE LINE MAY
       NOT BE WIRED CORRECTLY.  THE LINE MAY BE NOISY CAUSING THE NODE
       NOT TO RECEIVE THE DATA CORRECTLY (THE LOADER IS CHECKSUMMED).
       THE NODE MAY NOT BE RECEIVING INTERRUPTS FROM THE PROCESSOR. (IN
       EITHER DIRECTION OR BOTH).  THE NODE MAY GO INTO STEP BECAUSE OF
       PROCESSOR OR MEMORY PROBLEMS.  THE NODE MAY TAKE A POWER FAILURE
       DURING THE LOAD. (THE BOOTSTRAP WILL RESTART ON A POWER UP ASSUMING
       THE POWER FAILURE DIDN'T SCRAMBLE ITS BRAINS), THE WRONG LOADER MAY
       HAVE BEEN SENT. (IE THE CODE MAY HAVE BEEN ASSEMBLED FOR 16K BUT
       SOMEBODY FORGOT TO TELL THE 12K MACHINE IT WAS SUPPOSED TO GROW
       ANOTHER 4K OF MEMORY) IF THIS LAST HAPPENS, THE LOADER WILL 
       DISCOVER THE ERROR AND QUIETLY RETURN TO THE BOOTSTRAP.  THE HOST
       MAY BE SO SLOW SENDING OUT THE DATA THAT THE BOOTSTRAP THINKS THE
       HOST IS DEAD. (MOST OF THE TIME IT IS PROBABLY RIGHT). IF THIS HAPPENS
       THE BOOTSTRAP RESTARTS ITSELF.  ANY OF THESE WILL RESULT IN
       THE HOST PROGRAM TELLING "TIMEOUT NO RESPONSE TO LOADER".  WEAK
       HEARTS HAVE BEEN KNOW TO FAIL WHEN THIS HAPPENS.  A LITTLE THOUGHT AS
       TO WHAT MAY CAUSE SUCH A HAPPENING WOULD SUGGEST THAT YOU SHOULD
       NOT GIVE UP ON THE FIRST TRY.  THE NEW NDL PROGRAM WILL TRY

       AGAIN, AND CONTINUE TRYING EVERY 20 SECONDS UNTIL IT IS
       ACKNOWLEDGED OR ABORTED BY THE USER.  IF THE LOADER CANNOT BE
       RECEIVED BY THE TARGET MACHINE, YOU MAY WISH TO TRY
       AND TALK SOMEONE AT THE OTHER END THROUGH A FEW TESTS.  HOW MUCH
       YOU TRY DEPENDS ON YOUR ESTIMATION OF THE OTHER END'S INTELLEGENCE
       AND YOUR PATIENCE.  SOME THINGS TO TRY:
        
         ARE YOU SURE THE BOOT IS IN THERE AND "GOOD".  IF YOU USED A 
         "DLOAD" IT PROBABLY IS AND YOU CAN FORGET THIS AS A FIRST TRY.
         IF IT WAS LOADED FROM TAPE, IT MAY NOT HAVE LOADED.  CHECKING
         A FEW LOCATION IN THE AREA WHERE THE CASSETTE BOOT NORMALLY RESIDES
         WILL TELL YOU IF THE SYNC BOOT IS THERE. (IE IF 77720 CONTAINS A
         6030 THE SYNC BOOT DID NOT LOAD, HOWEVER IF IT CONTAINS A 134050
         THERE MAY BE A SYNC BOOT IN THE MACHINE. (IT MIGHT NOT HURT IF
         YOU FEEL SUSPICIOUS, TO CHECK THE WHOLE BOOT BUT YOU MIGHT
         TRY A FEW OTHER THINGS FIRST)).
     
         TAKE A LOOK AT THE LOCATIONS LABELED OUTPUT AND INPUT IN THE LISTING
         FOR THE BOOTSTRAP. (LOCATIONS 77753 AND 77762 IN A 32K MACHINE)
         IF LOADED BY CASSETTE, THESE CELLS ARE INITIALLY ZERO.  IF THE 
         BOOT HAS BEEN RUNNING THE CELLS WILL HOLD SOME POSITIVE VALUE
         (WHAT THE VALUE IS, IS NORMALLY NOT IMPORTANT AND WILL VARY)
         IF THE LOCATIONS REMAINED ZERO, YOU ARE NOT GETTING INTERRUPTS.
         AT THIS POINT YOU WILL NEED SOME HARDWARE ASSISTANCE TO FIX
         THE MACHINE. (IT MAY BE SOMETHING SIMPLE LIKE THE LINE IS NOT
         PLUGGED IN BUT NOT USUALLY... I HOPE).
     
         WELL, LETS SUPPOSE THE BOOT IS THERE AND YOU ARE GETTING INTERRUPTS.
         EXAMINE THE PORTION OF MEMORY WHERE THE LOADER IS SUPPOSED TO GO.
         SEE IF THE LOADER IS BEING RECEIVED.  IF THE LOADER IS BEING 
         RECEIVED, YOU MAY WISH TO TRY AN EXPERIMENT.  SET THE FIRST 6
         LOCATIONS OF THE LOADER TO ZERO (NOTE LOADER, NOT BOOT!  PLEASE
         DON'T DESTROY A GOOD BOOTSTRAP!!!). ONCE THIS IS DONE, RESTART
         THE BOOT AND TRY A LOAD.  WHEN THE HOST TIMES OUT AGAIN, EXAMINE
         THE FIRST LOCATIONS OF THE LOADER.  IF THEY ARE STILL ZERO, YOU
         ARE NOT RECEIVING ANY DATA.  YOU MAY HAVE SELECTED THE WRONG LINE.
         (CHECK AND MAKE SURE...DON'T GUESS AND BELIEVE HALF OF WHAT YOU
         SEE AND NONE OF WHAT YOU HEAR).  IF YOU'VE REACHED THIS POINT 
         YOU MAY HAVE FOUND A NEW PROBLEM.  AT LEAST YOU NEED HELP.
     
         MAKE SURE THAT THE BOOT IS SET TO RECEIVE ON THE CORRECT LINE.
     
         SUPPOSE THAT YOU ARE GETTING DATA IN THE FIRST FEW CELLS OF THE LOADER.
         IF IT IS NOT THE RIGHT DATA YOU ARE RECEIVING NOISE. IF IT
         SEEMS LIKE THE RIGHT DATA YOU MIGHT CHECK THE WHOLE LOADER.
         (THIS TAKES A LOT OF PATIENCE) YOU MIGHT TRY ANOTHER EXPERIMENT
         FIRST.  RESTART THE BOOTSTRAP.  SEND DOWN THE LOADER AGAIN.
         AFTER THE HOST TIMES OUT AGAIN, STOP THE MACHINE.  EXAMINE THE
         CONTENTS OF THE "P" REGISTER.  IF IT IS A VALUE SOMEWHERE
         IN THE AREA OF THE LOADER YOU HAVE RECEIVED THE LOADER CORRECTLY.
         IF IT IS NOT, YOU MAY HAVE TOO MUCH NOISE OR SOME OTHER PROBLEM
         IN THE RECEIVE SIDE.  GIVE SOME THOUGHT TO THE PROPER WIRING OF
         THE CIRCUIT.  CHECK OUT THE MODEMS AND THE TELCO LINES.
         IF YOU HAVE THE OPTION BY ALL MEANS TRY ANOTHER LINE.  IF
         YOU DID NOT LOAD THE BOOT BY CASSETTE TAPE THE OLD CODE MAY
         STILL BE IN THE MACHINE.  YOU COULD TRY A MANUAL RESTART
         IF YOU MUST, SEEK A TEMPORARY SOLUTION TO A STICKY SITUATION.  DON'T
         EXPECT THIS TO ALWAYS WORK.  IN ANY CASE, IT IS A LAST RESORT.
     

         SUPPOSE YOU HAVE EVIDENCE THAT THE LOADER IS GETTING THERE INTACT.
         THE TRANSMIT PORTION OF THE MACHINE MAY NOT BE WORKING. (ARE YOU
         GETTING TRANSMIT INTERRUPTS.  YOU DONT NEED THEM TO RECEIVE THE
         LOADER)  AGAIN YOU MAY HAVE TELCO PROBLEMS.  CHECK OUT THE CIRCUIT
         IF YOU CAN.  
     
         USE A LITTLE IMAGINATION: TRY AND THINK OF SOMETHING ELSE TO
         TRY.  (CRYING DOESN'T HELP).
     
       THESE SUGGESTIONS ARE SOME OF THE POSSIBILITIES.  THIS IS NOT
       EXHAUSTIVE.  NEITHER IS THIS THE ORDER IN WHICH IT IS ALWAYS REASONABLE
       TO TRY THESE THINGS.  ANY KIND OF TROUBLE SHOOTING SHOULD BE CONDUCTED
       WITH SOME THOUGHT AND INTUITION.  ALSO, DO NOT ASSUME THAT THE GIVEN
       CAUSE IS NECESSARILY THE ONLY CAUSE.  IF YOU DON'T KNOW WHAT IS WRONG
       IT MAY CAUSE SOMEONE ELSE TO GET TRAPPED IN THE SAME DEAD END 
       REASONING IF YOU SUGGEST A CAUSE FOR A PROBLEM.
     
       RETURNING TO THE NORMAL SEQUENCE OF EVENTS,  THE LOADER WILL BE
       CHECKSUMMED BY THE BOOTSTRAP.  IF IT IS CORRECT,  THE BOOTSTRAP WILL
       BRANCH TO THE LOADER.  THE LOADER IMMEDIATLY TRANSMITS AN ACKNOWLEGEMENT
       TO THE HOST.  
     
       THE HOST WILL TELL YOU THAT THE LOADER HAS BEEN RECEIVED AND BEGIN
       TRANSMITTING THE LOAD DATA TO THE NODE.  THE DATA IS SENT IN BLOCKS.
       EACH BLOCK IS CHECKSUMMED AND THIS SUM IS VERIFIED BY THE LOADER.
       (ACTUALLY THERE ARE TWO CHECKSUMS FOR THIS PART OF THE DATA
       BUT I WILL CALL IT ONE).  IF THE SUM IS GOOD, THE DATA IS MOVED
       INTO MEMORY AND AN ACKNOWLEGEMENT FOR THAT RECORD IS RETURNED TO
       THE HOST.  DUMP DATA MAY BE RETURNED WITH THE ACKNOWLEGEMENT
       IF IT WAS REQUESTED.  IF THE RECORD IS RECEIVED WITH A BAD SUM
       IT IS IGNORED. NO ACKNOWLEGEMENT IS RETURNED.
     
       THE HOST WILL MAKE ONE COMPLETE PASS THROUGH ALL OF THE DATA TO BE
       SENT.  IF DURING THIS TIME THE HOST FINDS THAT THERE ARE ONE
       HUNDRED RECORDS NOT ACKNOWLEGED, IT KNOWS THAT SOMETHING MAY HAVE
       GONE WRONG AND WARNS YOU.  IF THIS HAPPENS THE LOADER MAY HAVE
       TIMED OUT THINKING THAT THE HOST HAS DIED.  IF THIS HAPPENS
       THE LOADER WILL RESTART THE BOOT.  SINCE THE DATA AND THE 
       ACKNOWLEDGEMENTS ARE BOTH ON THE LINE AT THE SAME TIME, THE
       LINE MAY SHOW A CERTAIN SENSITIVITY TO SENDING DATA
       SIMULTANEOUSLY IN BOTH DIRECTIONS.  IN ALMOST EVERY CASE
       TRYING AGAIN WILL BE SUCCESSFUL.  ALLOW A LITTLE TIME TO MAKE
       SURE THAT THE BOOT HAS BEEN RESTARTED.
       
       ASSUMING THAT THE LOAD CONTINUES, THE HOST WILL GO BACK AND RETRANSMIT
       ANY RECORDS THAT IT RECEIVED NO ACKNOWLEGEMENTS FOR.  IT IS POSSIBLE
       THAT IT COULD HANG IN A LOOP RETRANSMITTING THE SAME RECORDS MANY 
       TIMES.  THIS IS CAUSED BY THE SAME KINDS OF THINGS THAT WOULD
       CAUSE 100 ACKNOWLEGEMENTS TO BE OUTSTANDING. (IN THE TEST TOMORROW
       ON THIS LESSON YOU WILL BE ASKED TO EXPLAIN WHY THIS IS TRUE).
     

       ONE MORE CRITICAL ACTION MUST HAPPEN.  THE HOST COMMANDS THE LOADER TO
       DO A MANUAL RESTART.  THE HOST DOES NOT WAIT FOR AN ACKNOWLEGEMENT TO
       THIS RECORD.  NOR DOES THE LOADER SEND ONE.  IF THIS RECORD DOES NOT
       MAKE IT CORRECTLY THE LOADER WILL TIME OUT AND RETURN TO THE BOOTSTRAP.
       IN ANY EVENT THE HOST SENDS A ZAPPER ON THE CIRCUIT WHICH WILL CAUSE
       THE NEIGHBOR NODE TO RECLAIM THE LINE AND LOOK FOR A RESET PATTERN.
     
       ONE OTHER NASTINESS COULD HAPPEN IN THIS PROCESS.  DURING THE
       LOAD A NODE IN THE DOWNSTREAM LOAD CIRCUIT COULD DIE.  (SO COULD
       ONE OF THE LINES WITH THE SAME EFFECT "PLEASE LOG IN").  THE
       HOST PROGRAM WILL TELL YOU AND EXIT.  THE NEIGHBOR NODE WILL ALSO
       RECEIVE A ZAPPER AND RETAKE THE LINE.  EVENTUALLY THE NODE
       BEING LOADED WILL TIME OUT AND RETURN TO THE BOOTSTRAP.  TRY AGAIN
       IN ABOUT 4 MINUTES.
     
       ONE FINAL PRECAUTION:  NEVER USE A LINE ON A NEIGHBOR NODE
       THAT DOES NOT HAVE CLOCKS ON THE LINE.  IF YOU DO, THE 
       NEIGHBOR NODE COULD BE JAMMED, AND WOULD THEN BELIEVE
       A DOWNSTREAM LOAD IS ALWAYS IN PROGRESS.  IF THIS OCCURS,
       THE NEIGHBOR NODE CANNOT BE USED FOR ANY OTHER LOADS UNTIL
       IT IS EITHER RESTARTED OR RELOADED.
     
 