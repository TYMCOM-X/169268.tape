
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C       NDUMP   PROGRAM TO TEAR APART NETWORK DUMPS AND
C               CREATE DDT,SYMBOLIC AND .REL COMPARISON FILE
C
C               WRITTEN BY BILL SCHEIBLE   MARCH 8,1978
C               UPDATED BY DAN LASATER     DEC 18,1978
C               UPDATED BY DAN LASATER     MAR 09,1979
C               UPDATED BY DEAN HENDERSON  OCT 03,1979
C
C       FILES:  NDUMP.FTF,ALOAD.MAC
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC

*       BUFFERS AND STORAGE WORDS
        INTEGER BUF(0/33000),INDATA(30),IADR,IREC,IDUMP,LA,HA,ID1(16)
        INTEGER IANS,NAME(4),NAME1(4),NAME2(4),NAME3(4),NAME4(4),ID2
        INTEGER NAME5(4),VER,LENGTH,E,INDX,BUF1(0/16000),IDATE(2)
        INTEGER NCRASH,CTAB,CL,CE,PARCRS,POWCRS,CTYP


*       OK...HERE WE GO
        VER=05
        TYPE 9000,VER
9000    FORMAT( ' NETWORK DUMP ANALYSIS   VER = ',I3)
 100    TYPE 9010
9010    FORMAT(' NAME OF DUMP INPUT FILE ? ',$)
        ACCEPT 9020,NAME
9020    FORMAT(4A5)
        OPEN(20,NAME,INPUT,BINARY,ERR=110)
        GOTO 200
 110    TYPE 9240,NAME
        GO TO 100

 200    TYPE 9030
9030    FORMAT(' DO YOU WANT A DDT FILE WRITTEN ?(Y OR N) ',$)
        ACCEPT 9040,IANS
9040    FORMAT(A1)
        IF (IANS.EQ.'Y') GO TO 210
        IF (IANS.EQ.'N') GO TO 230
        GO TO 200
 210    IDDT=-1
        TYPE 9050
9050    FORMAT(' NAME OF OUTPUT FILE FOR DDT ? ',$)
        ACCEPT 9020,NAME1
        OPEN (21,NAME1,OUTPUT,BINARY,ERR=220)
        GO TO 300
 220    TYPE 9240,NAME1
        GO TO 210
 230    IDDT=0

 300    TYPE 9060
9060    FORMAT(' DO YOU WANT A COMPARISION TO THE .REL FILE ? ',$)
        ACCEPT 9040,IANS
        IF (IANS.EQ.'Y') GO TO 310
        IF (IANS.EQ.'N') GO TO 420
        GO TO 300
 310    IREC=-1
        TYPE 9070
9070    FORMAT(' NAME OF COMPARISION OUTPUT FILE ? ',$)
        ACCEPT 9020,NAME4
        OPEN(23,NAME4,OUTPUT,SYMBOLIC,ERR=320)
        GO TO 400
 320    TYPE 9240,NAME4
        GO TO 310

 400    TYPE 9080
9080    FORMAT(' NAME OF .REL FILE FOR COMPARE ? ',$)
        ACCEPT 9020,NAME5
        OPEN (24,NAME5,INPUT,BINARY,ERR=410)
        GO TO 500
 410    TYPE 9240,NAME5
        GO TO 400
 420    IREL=0



C
C       NOW...GET THE (INPUT DUMP) AND PUT INTO A 
C       BUFFER...
C

 500    READ(20,ERR=550,END=550)LENGTH
        CALL EXPAND(LENGTH)
        DO 510 I=0,LENGTH-1
        INDX=I*2
        READ(20,ERR=550,END=520)ID3
        CALL WD32(ID3,BUF(INDX),BUF(INDX+1))
 510    CONTINUE

 520    HA=LENGTH*2
        LA=0
        DO 530 I=0,HA
        LA=I
        IF(BUF(I).GE.0)GOTO 540
 530    CONTINUE

 540    TYPE 9090,LA,HA
9090    FORMAT('  DUMP ADDRESSES RANGE FROM ',O6,' TO ',O6,/)
        GOTO 600
 550    TYPE 9100
9100    FORMAT(' ERROR WHILE READING DUMP FILE ',4A5,/)
        GOTO 1000

 600    IF(IDDT.GT.-1)GOTO 620
        DO 610 K=LA,HA
        WRITE(21)BUF(K)
 610    CONTINUE
        TYPE 9110
9110    FORMAT( ' DDT OUTPUT FILE WRITTEN',/)

 620    IF(IREC.GT.-1) GO TO 1000
C
C
C       HERE WE ARE DOING TO DO A COMPARE W/ THE BINARY .REL FILE
C
C

*       GET THE FILE SIZE

 700    READ(24,ERR=900,END=900)LENGTH
        CALL EXPAND(LENGTH)
        DO 710 ID2=0,LENGTH-1
        INDX=ID2*2
        READ(24,ERR=900,END=720)ID3
        CALL WD32(ID3,BUF1(INDX),BUF1(INDX+1))
 710    CONTINUE
*
*       OK...COMPARISION BUFFER ALL DONE
*
 720    INDX=LENGTH*2
        TYPE 9120,INDX
9120    FORMAT( ' .REL FILE IS ',I5,' WORDS ',/)
        IF (INDX.GT.HA)INDX=HA
        TYPE 9130,LA,INDX
9130    FORMAT( ' WILL COMPARE LOCATIONS ',O6,' TO ',O6,/)

*
*       WRITE OUT THE HEADER FOR THE FILE
*


 730    CALL DATE(IDATE)
        WRITE(23,9140)IDATE,BUF1(64),BUF1(65)
9140    FORMAT( ' DATE : ',2A5,3X,' NODE: ',O6,3X,' VERSION: ',O6)
        WRITE(23,9150)
9150    FORMAT(' DUMP COMPARISON TO THE .REL FILE')
        WRITE(23,9160)
9160    FORMAT(' AN * MEANS THE .REL VALUE WAS SET TO ZERO ',/)
        WRITE (23,9170)
9170    FORMAT(5X,' LOC ',13X,' DUMP ',12X,' COMP ')
        E=' '
        DO 750 I=LA,INDX
        IF(BUF1(I).LT.0)GOTO 740
        IF(BUF(I).LT.0)GO TO 740
        IF(BUF(I).EQ.BUF1(I))GO TO 740
        IF(BUF1(I).EQ.0)E='*'
        WRITE(23,9180)I,BUF(I),BUF1(I),E
9180    FORMAT(5X,O6,12X,O6,12X,O6,A1)
 740    E=' '
 750    CONTINUE

C       START CRASH TABLE SETUP

C       68(DECIMAL) = 104(OCTAL)
        IF(LA.GT.68)GOTO 830
        NCRASH=BUF(68)
        IF (NCRASH.LT.1)GOTO 830
        FIRST=0
        IF (NCRASH.LE.4)GOTO 810

 800    NCRASH=NCRASH-4
        IF(NCRASH.GE.4)GOTO 800
        FIRST=NCRASH
        NCRASH=4

 810    CTAB=BUF1(3)-"30
        IF ((CTAB.LT.LA).OR.(CTAB.GT.HA-23))GOTO 830
C       25(DECIMAL) = 31(OCTAL)
        PARCRS=BUF1(25)-1
C       9(DECIMAL) = 11(OCTAL)
        POWCRS=0
        IF(LA.LE.9)POWCRS=BUF(9)-1
C
C       EXTRACT THE CRASH TABLE
C
        WRITE(23,9190)
9190    FORMAT(//,5X,'CRASH TABLE',/' LOC',4X,'CONT',3X,
     1  'A-REG',2X,'B-REG',2X,'X-REG',2X,'C-WORD')
        DO 820 I=1,NCRASH
        CL=CTAB+FIRST
        CE=CL+20
        CTYP='SOFTW'
        IF (BUF(CL).EQ.4)CTYP='MANU'
        IF (BUF(CL).EQ.PARCRS)CTYP='PARIT'
        IF (BUF(CL).EQ.POWCRS)CTYP='POWER'
        WRITE(23,9200)(BUF(J),J=CL,CE,4),CTYP
9200    FORMAT(1X,6(O6,1X),A5)
        FIRST=FIRST+1
        IF(FIRST.GE.4)FIRST=FIRST-4
 820    CONTINUE
 830    CONTINUE
        TYPE 9210
9210    FORMAT(' COMPARISON FILE WRITTEN ',/)
        GO TO 1000

*
*       INPUT READ ERROR FOR .REL FILE
*
 900    TYPE 9220,NAME5
9220    FORMAT(' ERROR WHILE READING .REL FILE ',4A5,/)


1000    CLOSE (20)
        CLOSE (21)
        CLOSE (22)
        CLOSE(23)
        CLOSE(24)
        TYPE 9230
9230    FORMAT(' HEY...IT IS FINALLY OVER!!!...BYE... ',/)
9240    FORMAT( ' UNABLE TO OPEN FILE CALLED ',4A5,/)

        CALL EXIT
        END
