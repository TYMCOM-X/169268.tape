
                     VARIAN SOFTWARE DIAGNOSTIC AIDS


THE FOLLOWING SOFTWARE DIAGNOSTIC TROUBLESHOOTING AIDS ARE PROVIDED TO MAKE
VARIAN TROUBLESHOOTING MORE ACCURATE AND RAPID, AND TO REDUCE BOARD SWAPPING.

BACKGROUND INFORMATION ON INTERRUPTS:
VARIANS TAKE INTERRUPTS FROM THE 201 CARD AND THE INTERRUPT CARD.  IT IS
EASY TO USE NODE CODE AND THE SYNCHRONOUS BOOTSTRAP TO VERIFY THAT THESE TWO
CARDS INTERRUPT AND WHETHER THE VARIAN IS HANDLING THESE INTERRUPTS COR-  
RECTLY.

INTERRUPT CARD (ASB 4-4):  AT THE PRESENT TIME VIRTUALLY ALL VARIANS HAVE
THE ASB 4-4 INTERRUPT CARD.  IT CAN BE RECOGNIZED BY THE DIP SWITCHES AND
THE CRYSTAL.  THE OLD STYLE INTERRUPT CARD EXISTS ONLY IN VERY FEW MACHINES
THE OLD STYLE  CARD IS RECOGNIZED AS NOT HAVING DIP SWITCHES.  A VARIAN
REMOTE OR TYMCOM RUNNING 1200 BAUD CODE WILL HAVE SWITCHES 1, 2, & 3 SET
TO "ON".  SWITCH 4 IS NOT CONNECTED TO ANYTHING AT THE PRESENT TIME.  
SWITCH 1 IS INTERRUPT VECTOR ADDRESS 36 AND PHASE 0 INTERRUPT, SWITCH 2
IS INTERRUPT VECTOR ADDRESS 34 AND PHASE 1 INTERRUPT, SWITCH 3 IS INTER-
RUPT VECTOR ADDRESS 32 AND PHASE 2 INTERRUPT.  IF A SWITCH IS TURNED OFF,
THAT PARTICULAR INTERRUPT IS HALTED.  EACH OF THE 3 INTERRUPTS OCCUR AT A
1200 BAUD RATE AND EACH IS SPACED 120 DEGREES FROM THE OTHER TWO.  IF A
NODE IS NOT INTENDED TO SUPPORT 1200 BAUD SERVICE, ONLY SWITCH 1
WILL BE ON.

FOR NODE CODE THAT SUPPORTS 1200 BAUD SERVICE, MEMORY LOCATIONS 36, 34, AND
32 EACH HAVE A JUMP AND MARK INSTRUCTION (2000).  THE NEXT MEMORY LOCATION
FOR EACH (I.E. 37, 35, & 33) CONTAINS THE "JUMP TO" ADDRESS OF THE THREE
DIFFERENT CODE ROUTINES THAT HANDLE EACH OF THE THREE PHASES.  THE CODE
ROUTINES APPEAR AS FOLLOWS:

               MEMORY LOC         CONTENTS
                   32               2000      JUMP AND MARK
                   33               1662      PHASE 2 ROUTINE ADDRESS
                    .                 .
                    .                 .
                    .                 .
                1662                0000      STORE "JUMP FROM" ADDRESS
                1663              102060
                 ETC.                ETC.

NO MATTER WHERE THE CODE IS RUNNING, WHEN THE PHASE 2 INTERRUPT OCCURS, THE
JUMP AND MARK (2000) IS PERFORMED AND THE ADDRESS THAT THE CODE WAS PROCESSING
AT IS WRITTEN INTO LOCATION 1662 AND CODE BEGINS TO EXECUTE AT LOCATION 1663.
 THE CODE CAN THEN REFER TO LOCATION 1662 TO ENABLE A RETURN TO THE SECTION
IT WAS AT WHEN THE INTERRUPT OCCURED.

THE FOLLOWING PROCEDURE USES THE NODE CODE TO MAKE SURE THAT THE INTERRUPT
CARD IS INTERRUPTING AND THE VARIAN IS HANDLING THE INTERRUPTS PROPERLY:
                                                                               
   1.  CHOOSE THE INTERRUPT PHASE YOU WANT TO TEST (FOR THIS EXAMPLE PICK
       PHASE 1).
                                                                             
   2.  HALT THE VARIAN AND WRITE DOWN THE ADDRESS THAT IS STORED AT LOCATION
       35.  THIS IS THE BEGINNING ADDRESS OF THE PHASE 1 INTERRUPT HANDLING
       ROUTINE.

   3.  ASSUME (FOR THIS EXAMPLE) THAT MEMORY LOCATION 35 CONTAINS "1631".
       LOCATION 1631 IS USED TO STORE THE ADDRESS THAT THE CODE JUMPED 
       FROM.

   4.  LOOK AT LOCATION 1632, WRITE DOWN ITS CONTENTS, AND CHANGE IT TO
       ZERO.  NOW DO A MANUAL RESTART FROM LOCATION ZERO.  IF THE VARIAN
       SEES A PHASE 1 INTERRUPT, IT WILL JUMP & MARK TO THIS ROUTINE, TRY TO
       EXECUTE THE INSTRUCTION AT LOCATION 1632 (WHICH IS ZERO), AND IT WILL
       HALT.  THE P REGISTER SHOULD BE 1633 WHEN IT HALTS.         

   5.  IF THE VARIAN DOES NOT HALT  AFTER THE MANUAL RESTART IT MEANS THAT 
       EITHER THE INTERRUPT PHASE BEING TESTED DID NOT INTERRUPT OR THE 
       VARIAN DID NOT HANDLE THE INTERRUPT PROPERLY.

NOTE:  ON VARIAN TYMSATS WHERE THE CODE IS CONFIGURED FOR 1200 BAUD ASYNC    
SERVICE, SWITCHES 1, 2, & 3 ON THE INTERRUPT CARD MUST BE SET TO "ON".  IF
ONLY SWITCH 1 IS ON, AND ONE OR BOTH OF THE OTHER SWITCHES IS OFF, AND CODE 
IS CONFIGURED FOR 1200 BAUD, THE NODE WILL COME UP IN THE NETWORK BUT ASYNC
COMMUNICATION WITH THE NODE IS LOST.  YOU WILL GET THE "PLEASE TYPE YOUR
TERMINAL IDENTIFIER" MESSAGE BUT THE TYMSAT WILL NOT RESPOND WITH THE "PLEASE
LOG IN" MESSAGE WHEN THE TERMINAL IDENTIFIER KEY IS PRESSED.  IT IS POSSIBLE
TO MISINTERPRET THIS SYMPTOM AS AN EIA/DIO PROBLEM.  INTERRUPT CARD PHASE
0 MUST BE OPERATING PROPERLY FOR A VARIAN TYMSAT TO COME UP IN THE NET.


ANOTHER METHOD OF TESTING IS TO USE THE FOLLOWING FAT FINGER
PROGRAM TO TEST ALL THREE PHASES OF THE 3 PHASE INTERRUPT CARD.  THIS PROGRAM
INCREMENTS SPECIFIC REGISTERS EACH TIME ONE OF THE PHASES GENERATES AN INTER-
RUPT.

       PHASE 0 (SWITCH 1, INTERRUPT VECTOR 36) INCREMENTS REGISTER X

       PHASE 1 (SWITCH 2, INTERRUPT VECTOR 34) INCREMENTS REGISTER B

       PHASE 2 (SWITCH 3, INTERRUPT VECTOR 32) INCREMENTS REGISTER A

LOAD THE FOLLOWING PROGRAM IN MEMORY, CLEAR REGISTERS A,B, & X, AND START 
FROM LOCATION ZERO.  LET THE PROGRAM RUN FOR A CERTAIN LENGTH OF TIME (ONE
MINUTE, ONE HOUR, 24 HOURS, AT THE DISCRETION OF THE TECHNICIAN ON SITE) THEN
HALT THE V72 AND EXAMINE REGISTERS A, B, & X.  THEY SHOULD ALL BE WITHIN ONE
COUNT OF EACH OTHER.  IF ONE OR MORE PHASES LAG, THIS COULD BE THE CAUSE OF
GARBLED ASYNC DATA OR START BAUD CRASHES.

           MEM LOC        INSTRUCTION
              0            100127      FOR V72'S AND V77'S ONLY
                           100177      FOR 620'S ONLY
                                       ENABLE INTERRUPT CARD INTERRUPTS
              1            5000        NO OPER.
              2            5000        NO OPER.
              3            5000        NO OPER.
              4            1000        JUMP
              5               1
              6               0
              7            5111        INCREMENT A REGISTER
             10            1000        JUMP
             11               0
             12               0
             13            5122        INCREMENT B REGISTER
             14            1000        JUMP
             15               0
             16               0
             17            5144        INCREMENT X REGISTER
             20            1000        JUMP
             21               0
     LOCATIONS 22 THROUGH 31 DO NOT AFFECT THIS PROGRAM.
             32            2000        JUMP AND MARK
             33               6
             34            2000        JUMP AND MARK
             35              12
             36            2000        JUMP AND MARK
             37              16

NOTE:  THIS TEST CAN ALSO BE USED TO VERIFY INTERRUPT CAPABILITY OF ANY 
       VARIAN AND COULD BE USED ON VARIANS SET UP WITH OLD-STYLE SINGLE
       INTERRUPT CARDS TO VECTOR TO ADDRESS 36 (EXAMINE X REGISTER).



201 CARD CHECKOUT

THE SYNCHRONOUS BOOTSTRAP CAN BE USED AS AN EXCELLENT TOOL FOR CHECKING OUT
THE 201 CARD.  THERE ARE TWO METHODS GIVEN HERE:

LOAD THE SYNCHRONOUS BOOTSTRAP PROGRAM INTO CORE.  SELECT THE 201 LINE YOU
WISH TO TEST AND MODIFY THE FIVE LOCATIONS TO SET UP THIS LINE IN THE BOOT.
AT LOCATION X7772 (WRDOUT BUFFER) PUT A "31062" WHICH IS AN OCTAL SYNC CHAR-
ACTER.  RESTART THE SYNCHRONOUS BOOTSTRAP AT LOCATION X7640 AND LISTEN FOR A
TONE AT THE PROPER PLUGBOARD HOLE.  THE TONE THAT SHOULD BE HEARD IS A STREAM
OF 31062'S.  IF THE TONE IS NOT HEARD, VERIFY THAT TRANSMIT CLOCK IS AT THE
PROPER 201 CARD BACKPLANE PIN (USE A SPEAKER OR SCOPE) AND LISTEN FOR TRANSMIT
DATA COMING OUT OF THE PROPER PIN OF THE 201 CARD BACKPLANE POSITION.  THESE
LAST TWO ACTIONS ARE FOR VERIFYING THAT AN EIA CARD IS NOT BLOCKING TRANS-
MIT CLOCK OR TRANSMIT DATA.  
IF A TONE IS HEARD, PLUG A BLACK PIGGYBACK PLUGBOARD WIRE BETWEEN TRANSMIT
DATA AND RECEIVE DATA.  HALT THE VARIAN AND EXAMINE THE MEMORY LOCATIONS FROM
X7240 AND UP 20 OR 40 LOCATIONS.  THEY SHOULD CONTAIN ONLY 31062'S.  IF THEY
DO, IT MEANS THAT THE SELECTED 201 LINE CAN TRANSMIT AND RECEIVE PROPERLY, AND
THE VARIAN IS PROCESSING INTERRUPTS FROM THE 201 CARD.
THE TEST USES THE SYNCHRONOUS BOOTSTRAP TO TRANSMIT A STREAM OF 31062'S    
AND THEN SEE IF THE BOOTSTRAP CAN READ THEM AS THEY ARE FED TO THE RECEIVE
CHANNEL.  THE BOOT LOOKS FOR THE FIRST 31062 IT SEES AND THEN LOADS EACH    
OF THE FOLLOWING CHARACTERS IN TO THE LOADER AREA OF MEMORY (X7240 & HIGHER).

THE SECOND METHOD OF TESTING THE 201 CARD IS AS FOLLOWS:
TO TEST THE TRANSMIT INTERRUPT CAPABILITY OF A SPECIFIC 201 CARD LINE, LOAD
THE SYNCHRONOUS BOOTSTRAP AND SET UP THE FIVE LOCATIONS (X7655, X7656, X7663,
X7666, AND X7770) FOR THE SPECIFIC LINE TO BE TESTED.  CHANGE LOCATION X7754
TO ZERO.  MAKE SURE THAT TRANSMIT CLOCK IS BEING SUPPLIED TO THE PROPER PIN
ON THE 201 CARD BACKPLANE SLOT CORRESPONDING TO THE LINE TO BE TESTED.  START
THE SYNCHRONOUS BOOTSTRAP FROM LOCATION X7640 AND THE VARIAN SHOULD HALT
IMMEDIATELY IF THE 201 CARD PROCESSES A TRANSMIT INTERRUPT FOR THAT SPECIFIC
LINE.  THE P REGISTER SHOULD BE X7755.  (NOTE: REMEMBER THAT THE TRANSMIT CLOCK
MUST BE SUPPLIED TO THE CORRECT 201 CARD LINE FOR THIS TEST TO WORK PROPERLY.)
TO TEST THE RECEIVE INTERRUPT CAPABILITY OF A SPECIFIC 201 CARD LINE, LOAD THE
SYNCHRONOUS BOOTSTRAP AND SET UP THE FIVE LOCATIONS (X7655, X7656, X7663,
X7666, X7770) FOR THE SPECIFIC LINE TO BE TESTED.  CHANGE LOCATION X7763 TO
ZERO.  MAKE SURE THAT BOTH RECEIVE CLOCK AND RECEIVE DATA ARE BEING SUPPLIED
TO THE PROPER PINS ON THE 201 CARD BACKPLANE SLOT CORRESPONDING TO THE LINE
TO BE TESTED.  FOR RECEIVE DATA YOU COULD USE THE INCOMING RESET 
PATTERN OR EVEN A CLOCK SOURCE.  START THE SYNCHRONOUS BOOTSTRAP FROM
LOCATION X7640 AND THE VARIAN SHOULD HALT IMMEDIATELY IF THE 201 CARD PROC-
ESSES A RECEIVE INTERRUPT FOR THAT SPECIFIC LINE.  THE P REGISTER
SHOULD BE X7764.  (NOTE:  REMEMBER THAT RECEIVE CLOCK AND RECEIVE DATA
MUST BE SUPPLIED TO THE CORRECT 201 CARD LINE FOR THIS TEST TO WORK PROPERLY.)


ANOTHER USEFUL DIAGNOSTIC IS THE E-BUS EIA/DIO EXERCISER TEST:

      MEMORY LOC      INSTRUCTION
         0             102560       INPUT TO THE A REGISTER FROM ADDR 60
         1             103177       OUTPUT TO V72 FRONT PANEL FROM A REGISTER
         2             103160       OUTPUT TO ADDR 60 FROM "A" REGISTER
         3               1000       JUMP
         4                  0

THIS SIMPLE PROGRAM RUNS IN A LOOP AND IS CAPABLE OF TESTING EIA ADDRESS
ALONG WITH THE CORRESPONDING DIO CARD.  THIS LOOP IS ESPECIALLY VALUABLE
IN THAT IT CAN TEST EVERY E-BUS BIT.
FIRST, SELECT THE ADDRESS TO BE TESTED AND MODIFY THE INSTRUCTIONS AT LOC-
ATIONS 0 AND 2 TO THAT ADDRESS.  FOR EXAMPLE, TO TEST ADDRESS 55, THESE TWO
INSTRUCTIONS WOULD BE 102555 AND 103155.

ASSUMING A V72 TYMSAT IS TO BE TESTED FOR ADDRESS 60, PROCEED AS FOLLOWS:

     1.  PUT A PLUGBOARD JUMPER WIRE INTO A +12 VOLT SOURCE ON THE PLUGBOARD
         AND PLUG THE OTHER END INTO ADDRESS 60 INPUT BIT 0 (WHICH IS HOLE
         A16 ON PLUGBOARD 1).  AT THE SAME TIME USE A VOLTMETER TO MONITOR
         HOLE A17 ON PLUGBOARD 1 WHICH IS ADDRESS 60 OUTPUT BIT 0, AND YOU
         SHOULD SEE THE VOLTAGE CHANGE FROM APPROXIMATELY -12 VOLTS TO
         APPROXIMATELY +12 VOLTS AT THE INSTANT THE +12 VOLT SOURCE IS
         PLUGGED INTO HOLE A16.  ALSO YOU WILL SEE V72 BIT LAMP 0 GO
         OUT WHILE THE OTHER BIT LAMPS STAY ON.

     2.  NEXT, PERFORM THE SAME TEST BUT PLUG THE +12 VOLT SOURCE INTO ADD-
         RESS 60 INPUT BIT 1 WHICH IS HOLE B16 ON PLUGBOARD 1.  MONITOR HOLE
         B17 AND YOU SHOULD SEE THE VOLTAGE CHANGE FROM APPROXIMATELY
         -12 VOLTS TO APPROXIMATELY +12 VOLTS AT THE INSTANT THE +12 VOLT
         SOURCE IS PLUGGED INTO HOLE B16.  ALSO YOU SHOULD SEE BIT LAMP 1
         GO OUT WHILE ALL THE OTHERS REMAIN ON.

     3.  CONTINUE TESTING UP TO PLUGBOARD 2, HOLES H16 AND H17.  WHEN THIS
         IS COMPLETED, ALL 16 BITS OF THE E-BUS WILL HAVE BEEN TESTED.  ALSO
         THE EIA CARD CORRESPONDING TO THE CHOSEN ADDRESS WILL HAVE BEEN
         EXERCISED AND THE HALF OF THE DIO CARD ASSOCIATED WITH THAT EIA CARD
         WILL HAVE BEEN EXERCISED.

     4.  THIS DIAGNOSTIC MAY BE LOCATED ANYWHERE IN MEMORY, HOWEVER THE 
         "JUMP TO" ADDRESS MUST BE SET TO THE ADDRESS OF THE FIRST INSTRU-
         CTION SO THAT THE PROGRAM WILL LOOP.  THE INSTRUCTION "103177" IS
         SPECIFICALLY FOR ADDRESSING THE SIXTEEN BIT LAMPS ON THE V72 FRONT
         PANEL, HOWEVER, IF THIS LOOP IS BEING RUN ON A V77 OR 620, THIS
         INSTRUCTION HAS NO EFFECT AND CAN STILL BE INCLUDED IN THE LOOP
         WITH NO ADVERSE EFFECT ON THE TEST RESULTS.  WITH THE VARIAN 620'S
         YOU WILL OBSERVE A SLIGHT DECREASE IN BIT LAMP INTENSITY AS EACH
         BIT IS TESTED.  THIS IS NOT DUE TO THE "103177" INSTRUCTION, BUT
         IS A FUNCTION OF HOW THE CPU INTERFACES WITH THE FRONT PANEL DURING
         PROGRAM EXECUTION.


VARIAN CLEAR MEMORY ROUTINE:

THIS SHORT PROGRAM IS USEFUL AS A QUICK CHECK OF BASIC CPU HEALTH, AND
CAN BE RUN ON ANY VARIAN.  IF THIS PROGRAM WILL NOT EXECUTE PROPERLY, IT
INDICATES AN OBVIOUS PROBLEM SOMEWHERE IN THE CPU-MEMORY AREA.  IF THE
PROGRAM EXECUTES PROPERLY, IT MAY BE ASSUMED THAT A SIGNIFICANT PORTION OF
THE CPU SECTION IS WORKING PROPERLY.

        MEM LOCATION      INSTRUCTION
            0             55000     STORE FROM THE "A" REGISTER TO MEMORY,
                                    INDEXED BY THE "X" REGISTER.
            1              5344     DECREMENT THE "X" REGISTER BY 1.
            2              1000     JUMP
            3                 0

BEFORE EXECUTION, SET THE "A" REGISTER TO ZERO, SET THE "X" REGISTER TO THE
HIGHEST ADDRESS YOU WANT TO START ZEROING CORE AT.

THE FIRST INSTRUCTION "55000" CAUSES THE PROCESSOR TO WRITE FROM THE "A"
REGISTER TO MEMORY.  THE MEMORY LOCATION IS FOUND BY ADDING THE LAST THREE
DIGITS OF THE "55000" INSTRUCTION (I.E. ZERO) TO THE CURRENT VALUE OF THE
"X" REGISTER.  THE FIRST PASS THROUGH THIS LOOP HAS THE "X" REGISTER AT THE
INITIAL VALUE SET BY THE FIELD ENGINEER.  NEXT, THE "5344" INSTRUCTION
DECREMENTS THE "X" REGISTER BY ONE. NEXT, A JUMP IS PERFORMED BACK TO THE
FIRST INSTRUCTION IN THE LOOP AND THE PROCESS IS REPEATED AGAIN. THEREFORE,
EACH SUCCESSIVELY LOWER MEMORY LOCATION IS ZEROED OUT UNTIL THE "JUMP"
INSTRUCTION IS ZEROED OUT AT LOCATION 2.  THIS CAUSES THE PROGRAM TO HALT
WITH THE "P" REGISTER AT 3 AND THE "X" REGISTER AT 1.  ANY OTHER FINAL RESULT
THAN IS GIVEN HERE IS GROUNDS FOR SUSPECTING THE OPERATION OF THE PROCESSOR. 
   